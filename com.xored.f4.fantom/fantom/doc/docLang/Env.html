<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns='http://www.w3.org/1999/xhtml'>
<head>
  <title>Env</title>
  <meta http-equiv='Content-Type' content='text/html; charset=UTF-8'/>
  <link rel='stylesheet' type='text/css' href='../doc.css'/>
  <script type='text/javascript' src='../doc.js'></script>
<!--[if lt IE 7]>
<script src='http://ie7-js.googlecode.com/svn/version/2.0(beta3)/IE7.js' type='text/javascript'></script>
<![endif]-->
</head>
<body onload='Login.check();'>
<div class='header'>
<div>
<h1><a href='/'>Fantom</a></h1>
<p id='sidewalkLogin_'>&nbsp;</p>
<form method='get' action='/sidewalk/search/'>
<p>
<input type='text' name='q' size='30' value='Search...' onfocus='if (value=="Search...") value=""' onblur='if (value=="") value="Search..."' />
</p>
</form>
<ul>
<li><a href='/'>Home</a></li>
<li class='active'><a href='../index.html'>Docs</a></li>
<li><a href='/sidewalk/blog/'>Blog</a></li>
<li><a href='/sidewalk/ticket/'>Tickets</a></li>
<li><a href='/sidewalk/topic/'>Discuss</a></li>
</ul></div>
</div>
<div class='subHeader'>
<div>
<ul>
  <li><a href='../index.html'>Doc Home</a></li>
  <li>&gt;</li>
  <li><a href='index.html'>docLang</a></li>
  <li>&gt;</li>
  <li><a href='Env.html'>Env</a></li>
</ul>
</div>
</div>
<div class='content'>
<div>
<div class='fandoc'>
<div class='prevNext'>
<div class='prev'><a href='Deployment.html'><img src='../go-previous.png' alt='prev' /></a> <a href='Deployment.html'>Deployment</a></div>
<div class='next'><a href='Serialization.html'>Serialization</a> <a href='Serialization.html'><img src='../go-next.png' alt='next' /></a></div>
</div>
<h1 class='title'>Env</h1>

<h1 id='overview'>Overview </h1>

<p>The <code><a href='../sys/Env.html'>sys::Env</a></code> class is used to access and customize the Fantom environment.  Key aspects of the runtime delegate to the currently installed environment including:</p>

<ul>
<li>standard I/O</li>

<li>home, working, and temporary directories</li>

<li><code><a href='../sys/Env.html#findPodFile'>pod</a></code> resolution</li>

<li><code><a href='../sys/Env.html#config'>config</a></code> property resolution</li>

<li><code><a href='../sys/Env.html#locale'>locale</a></code> property resolution</li>

<li>Java classloading resolution (when using JVM)</li>
</ul>

<h1 id='dirs'>Directory Structure </h1>

<p>The standard directory structure for Fantom installations is:</p>

<pre>lib/
  fan/
    podA.pod
    podB.pod
    .. other pods
  java/
    .. jar files
  dotnet/
    .. .NET DLLs
etc/
  sys/
    config.props
    ... other sys config/runtime files
  build/
    config.props
    ... other build config/runtime files
  podA/
    config.props
    ... other config/runtime files
  podB/
    config.props
    ... other config/runtime files</pre>

<p>The top level "lib" directory is used to store library files which contain code.  The directories under "lib" are organized by platform: fan, java, dotnet.  The ".pod" files themselves are stored under "lib/fan/".</p>

<p>The top level "etc" directory is used to store system wide configuration files and other files that a pod might need at runtime.  The directories under "etc" are organized by pod - each subdirectory under "etc" should match a pod name.</p>

<h1 id='boot'>BootEnv </h1>

<p>The default envirnoment used to boots up a Fantom environment is called the <em>BootEnv</em>.  The <code>homeDir</code> of the BootEnv is always relative to the location used to launch Fantom (fan.exe or fan bash script).</p>

<p>Core libraries like <code>sys</code> must be loaded out of the BootEnv.</p>

<h1 id='setting'>Setting Env </h1>

<p>You can override the default environment using the <code>FAN_ENV</code> environmental variable.  This variable should map to a qualified type name of the <code>Env</code> subclass to use.  The class must have a default no-argument constructor.</p>

<p>The BootEnv is used to load the environment class specified.  This requires that the pod defining your environment is located under "{homeDir}/lib/fan/".</p>

<h1 id='PathEnv'>PathEnv </h1>

<p>The <code><a href='../util/PathEnv.html'>util::PathEnv</a></code> is a simple env implementation that uses a search path instead of requiring all your files be located under the "fan.home". The search path is specified with the <code>FAN_ENV_PATH</code> envirnomenal variable.  For example:</p>

<pre>C:\dev\fan>set FAN_ENV=util::PathEnv
C:\dev\fan>set FAN_ENV_PATH=/dev/work/</pre>

<p>The directory specified should be structured using the standard <a href='#dirs'>conventions</a>. In the example above we would look for pods in "/dev/work/lib/fan/". You can specify more than one directory using your operating system's <code><a href='../sys/File.html#pathSep'>path separator</a></code>.  Note that the path always implicitly includes "fan.home" as the last directory in search path.</p>

<p>The list of paths is specified in <em>priority order</em>.  The first directory in the path is used for <code><a href='../sys/Env.html#workDir'>workDir</a></code>. Priority order is used to resolve pods and configuration files.  Typically you will use this mechanism to keep a pristine boot directory, and do pod development and configuration overrides in a separate working directory.</p>

<p>For example let's consider this directory structure:</p>

<pre>boot/
  lib/
    fan/
      podA.pod
      podB.pod
work/
  lib/
    fan/
      podB.pod
      podC.pod</pre>

<p>In this configuration, things would be resolved as follows:</p>

<pre>podA  =>  boot/lib/fan/podA.pod
podB  =>  work/lib/fan/podB.pod
podC  =>  work/lib/fan/podC.pod</pre>

<p>Note how work directory trumps boot for resolution of podB even though it exists in both directories.</p>

<h1 id='JarDistEnv'>JarDistEnv </h1>

<p>The JarDistEnv is a JVM only environment which is used to deploy a set of Fantom pods as a single Java JAR file.  A JarDistEnv differs from other environments in that it has no access to the standard directory structure on the file system.  Rather everything the environment might need is self contained as resources inside the JAR file.</p>

<p>The following features are not supported in the JarDistEnv:</p>

<ul>
<li><a href='#index'>indexed props</a></li>

<li>file system overrides for <code><a href='../sys/Env.html#config'>config</a></code> and <code><a href='../sys/Env.html#locale'>locale</a></code></li>

<li><code>homeDir</code>, <code>workDir</code>, <code>tempDir</code> all default to current working directory</li>
</ul>

<p>See the <code><a href='../build/JarDist.html'>build::JarDist</a></code> task and <a href='../examples/java-buildjardist.html'>example script</a> for how to build a JAR for deployment.</p>

<p>In order for the Fantom to boot itself from a JarDist, the following system properties must be configured:</p>

<ul>
<li>"fan.home": set to some directory for <code><a href='../sys/Env.html#homeDir'>sys::Env.homeDir</a></code></li>

<li>"fan.jardist": set to "true" to ensure runtime loads itself from the JAR instead of the file system</li>
</ul>

<h1 id='index'>Indexed Props </h1>

<p>One issue which plagues many software platforms is the ability to efficiently discovery what is currently installed.  For example what type should I use to handle the URI scheme "foobar"?  What plugins are registered to work with the "image/png" MIME type?</p>

<p>In Fantom building these types of discovery functions is done with <em>indexed props</em>. Indexed props are a simple mechanism where pods can define name/value pairs which are coalesced into a master index by the current environment.  You define indexed props in your pod's build script:</p>

<pre>index =
[
  // creating plugins for existing APIs like UriScheme
  "sys.uriScheme.foobar": "acme::FoobarScheme",

  // creating plugins for specific target types
  "acme.editor.sys::Bool": "acme::BoolEditor",
  "acme.editor.sys::Int": "acme::IntEditor",

  // registering types for specific functions
  "acme.theme": ["acme::JungleTheme", "acme::WaterTheme"],
]</pre>

<p>Indexed props are globally scope, so convention is to scope your key names with a pod name.  Note in the above example "acme.theme" that you can define multiple values for a single key.</p>

<p>During runtime the current environment will build master index of indexed props for all the installed pods.  This means adding new functionality requires only to drop a pod file into your lib directory.</p>

<p>You lookup index props with the <code><a href='../sys/Env.html#index'>Env.index</a></code> method.  It returns a list of values bound to a given key:</p>

<pre>// lookup the UriScheme bound to foobar
qname := Env.cur.index("sys.uriScheme.foobar").first

// find editor types responsible for editing target
qnames := Env.cur.index("acme.editor.${target.typeof}")

// find all the theme types installed
qnames := Env.cur.index("acme.theme")</pre>

<p>Using the basic mechanisms of name/value pairs, you can construct fairly sophisticated solutions for discovering the types and resources bundled in the installed pods.</p>
<div class='prevNext'>
<div class='prev'><a href='Deployment.html'><img src='../go-previous.png' alt='prev' /></a> <a href='Deployment.html'>Deployment</a></div>
<div class='next'><a href='Serialization.html'>Serialization</a> <a href='Serialization.html'><img src='../go-next.png' alt='next' /></a></div>
</div>
</div>
<div class='sidebar'>
<h2>Contents</h2>
<ul>
<li><a href='#overview'>Overview </a></li><li><a href='#dirs'>Directory Structure </a></li><li><a href='#boot'>BootEnv </a></li><li><a href='#setting'>Setting Env </a></li><li><a href='#PathEnv'>PathEnv </a></li><li><a href='#JarDistEnv'>JarDistEnv </a></li><li><a href='#index'>Indexed Props </a></li></ul>
</div>
</div>
</div>
<div class='footer'>
<div>
<p>
docLang 1.0.56
[11-Nov-2010 Thu 10:08:28AM EST]
</p>
</div>
</div>
</body>
</html>
