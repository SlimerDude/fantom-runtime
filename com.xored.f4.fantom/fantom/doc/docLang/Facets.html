<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns='http://www.w3.org/1999/xhtml'>
<head>
  <title>Facets</title>
  <meta http-equiv='Content-Type' content='text/html; charset=UTF-8'/>
  <link rel='stylesheet' type='text/css' href='../doc.css'/>
  <script type='text/javascript' src='../doc.js'></script>
<!--[if lt IE 7]>
<script src='http://ie7-js.googlecode.com/svn/version/2.0(beta3)/IE7.js' type='text/javascript'></script>
<![endif]-->
</head>
<body onload='Login.check();'>
<div class='header'>
<div>
<h1><a href='/'>Fantom</a></h1>
<p id='sidewalkLogin_'>&nbsp;</p>
<form method='get' action='/sidewalk/search/'>
<p>
<input type='text' name='q' size='30' value='Search...' onfocus='if (value=="Search...") value=""' onblur='if (value=="") value="Search..."' />
</p>
</form>
<ul>
<li><a href='/'>Home</a></li>
<li class='active'><a href='../index.html'>Docs</a></li>
<li><a href='/sidewalk/blog/'>Blog</a></li>
<li><a href='/sidewalk/ticket/'>Tickets</a></li>
<li><a href='/sidewalk/topic/'>Discuss</a></li>
</ul></div>
</div>
<div class='subHeader'>
<div>
<ul>
  <li><a href='../index.html'>Doc Home</a></li>
  <li>&gt;</li>
  <li><a href='index.html'>docLang</a></li>
  <li>&gt;</li>
  <li><a href='Facets.html'>Facets</a></li>
</ul>
</div>
</div>
<div class='content'>
<div>
<div class='fandoc'>
<div class='prevNext'>
<div class='prev'><a href='Inheritance.html'><img src='../go-previous.png' alt='prev' /></a> <a href='Inheritance.html'>Inheritance</a></div>
<div class='next'><a href='Functions.html'>Functions</a> <a href='Functions.html'><img src='../go-next.png' alt='next' /></a></div>
</div>
<h1 class='title'>Facets</h1>

<h1 id='overview'>Overview </h1>

<p>Facets are a mechanism to annotate types and slots with metadata.  Facets are similar to Java <em>annotations</em> or C# <em>attributes</em>.  A facet is a serialized instance of const class declared on a type or slot which implements the <code><a href='../sys/Facet.html'>sys::Facet</a></code> mixin.</p>

<h1 id='classes'>Facet Classes </h1>

<p>Facets are defined as normal classes using the <code>facet</code> positional keyword:</p>

<pre>// simple marker facet with no fields
facet class Indexed {}

// struct facet with one or more const fields
facet class Table
{
  const Str name := ""
  const Bool autoCreate
}</pre>

<p>All facets classes automatically inherit the <code><a href='../sys/Facet.html'>sys::Facet</a></code> mixin.  Facets are implied to be <a href='Classes.html#const'>const classes</a> which means all their fields must be const.</p>

<p>Facet classes are not allowed to define their own constructor.  Instead the compiler will generate one for you.  If your facet has fields, then it is implied to be <a href='Serialization.html'>Serializable</a> and all its fields must be serializable types.</p>

<p>The classes above will have the following synthetic definitions:</p>

<pre>// marker facet with no instance fields is singleton
const class Indexed : Facet
{
  static const Indexed defVal := Indexed()
  private new make() {}
}

// struct facet with instance fields gets it-block constructor
@Serializable
const class class Table : Facet
{
  new make(|This|? f) { f?.call(this) }
}</pre>

<h1 id='annotations'>Annotations </h1>

<p>Any type or slot can be annotated with facets using the <code>@</code> symbol:</p>

<pre>@Indexed
@Table { name = "Employees"; autoCreate = true }
class Employee {}</pre>

<p>Struct facets assign their field values inside curly braces similiar to an <a href='Closures.html#itBlocks'>it-block</a>.  Only simple literal expressions may be used in facet annotations which the compiler can determine how to serialize.</p>

<h1 id='reflection'>Reflection </h1>

<p>Facets are available at runtime via the following methods:</p>

<ul>
<li><code><a href='../sys/Type.html#facet'>Type.facet</a></code></li>

<li><code><a href='../sys/Type.html#facets'>Type.facets</a></code></li>

<li><code><a href='../sys/Type.html#hasFacet'>Type.hasFacets</a></code></li>

<li><code><a href='../sys/Slot.html#facet'>Slot.facet</a></code></li>

<li><code><a href='../sys/Slot.html#facets'>Slot.facets</a></code></li>

<li><code><a href='../sys/Slot.html#hasFacet'>Slot.hasFacets</a></code></li>
</ul>

<p>Always prefer the <code>facet</code> and <code>hasFacet</code> methods over <code>facets</code> since it is much more efficient.  Some examples:</p>

<pre>// check if a type is serializable, returns null if not
Serializable? ser := obj.typeof.facet(Serializable#, false)

// check if a field is transient
field.hasFacet(Transient#)</pre>

<h1 id='inheritance'>Inheritance </h1>

<p>You can annotate a facet class with the <code><a href='../sys/FacetMeta.html'>sys::FacetMeta</a></code> facet to declare that a type-level facet should be inherited:</p>

<pre>@FacetMeta { inherited = true }
facet class F {}

@F class A {}
class B : A {}</pre>

<p>In the example above the class <code>B</code> will inherit the facet <code>F</code>.  Facet inheritance works on any type (class or mixin) in the <code><a href='../sys/Type.html#inheritance'>inheritance hierarchy</a></code>.</p>
<div class='prevNext'>
<div class='prev'><a href='Inheritance.html'><img src='../go-previous.png' alt='prev' /></a> <a href='Inheritance.html'>Inheritance</a></div>
<div class='next'><a href='Functions.html'>Functions</a> <a href='Functions.html'><img src='../go-next.png' alt='next' /></a></div>
</div>
</div>
<div class='sidebar'>
<h2>Contents</h2>
<ul>
<li><a href='#overview'>Overview </a></li><li><a href='#classes'>Facet Classes </a></li><li><a href='#annotations'>Annotations </a></li><li><a href='#reflection'>Reflection </a></li><li><a href='#inheritance'>Inheritance </a></li></ul>
</div>
</div>
</div>
<div class='footer'>
<div>
<p>
docLang 1.0.56
[11-Nov-2010 Thu 10:08:28AM EST]
</p>
</div>
</div>
</body>
</html>
