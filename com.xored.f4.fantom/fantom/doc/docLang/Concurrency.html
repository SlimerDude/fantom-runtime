<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns='http://www.w3.org/1999/xhtml'>
<head>
  <title>Concurrency</title>
  <meta http-equiv='Content-Type' content='text/html; charset=UTF-8'/>
  <link rel='stylesheet' type='text/css' href='../doc.css'/>
  <script type='text/javascript' src='../doc.js'></script>
<!--[if lt IE 7]>
<script src='http://ie7-js.googlecode.com/svn/version/2.0(beta3)/IE7.js' type='text/javascript'></script>
<![endif]-->
</head>
<body onload='Login.check();'>
<div class='header'>
<div>
<h1><a href='/'>Fantom</a></h1>
<p id='sidewalkLogin_'>&nbsp;</p>
<form method='get' action='/sidewalk/search/'>
<p>
<input type='text' name='q' size='30' value='Search...' onfocus='if (value=="Search...") value=""' onblur='if (value=="") value="Search..."' />
</p>
</form>
<ul>
<li><a href='/'>Home</a></li>
<li class='active'><a href='../index.html'>Docs</a></li>
<li><a href='/sidewalk/blog/'>Blog</a></li>
<li><a href='/sidewalk/ticket/'>Tickets</a></li>
<li><a href='/sidewalk/topic/'>Discuss</a></li>
</ul></div>
</div>
<div class='subHeader'>
<div>
<ul>
  <li><a href='../index.html'>Doc Home</a></li>
  <li>&gt;</li>
  <li><a href='index.html'>docLang</a></li>
  <li>&gt;</li>
  <li><a href='Concurrency.html'>Concurrency</a></li>
</ul>
</div>
</div>
<div class='content'>
<div>
<div class='fandoc'>
<div class='prevNext'>
<div class='prev'><a href='Serialization.html'><img src='../go-previous.png' alt='prev' /></a> <a href='Serialization.html'>Serialization</a></div>
<div class='next'><a href='Actors.html'>Actors</a> <a href='Actors.html'><img src='../go-next.png' alt='next' /></a></div>
</div>
<h1 class='title'>Concurrency</h1>

<h1 id='overview'>Overview </h1>

<p>Fantom tackles concurrency using a very different path from Java and C#.  Java and C# use a shared memory model - all threads have access to each other's memory space.  Synchronization locks are required to ensure that threads share data in a consistent manner.  This concurrency model is quite powerful, but operates at a low level of abstraction.  As such, even skilled programmers have a hard time writing code which is free of both race conditions and deadlocks.  This model also makes it very hard to create composable systems because all system components must orchestrate their use of locking consistently.</p>

<p>The Fantom model of concurrency is based upon the following principles:</p>

<ul>
<li><strong>No Shared Mutable State</strong>: threads never share mutable state under any circumstances;</li>

<li><strong>Immutability</strong>: the notion of immutability is embedded into the language itself.  Immutable data can be efficiently and safely shared between threads (for example via a static field);</li>

<li><strong>Message Passing</strong>: the actor  API is built around the idea of <a href='Actors.html'>passing messages</a> between asynchronous workers;</li>
</ul>

<h1 id='immutability'>Immutability </h1>

<p>An object is said to be <em>immutable</em> if we can guarantee that once constructed it never changes state.  Fantom supports these types of immutable objects:</p>

<ul>
<li>Any object instance of a <a href='Classes.html#const'>const class</a></li>

<li>The result of <code><a href='../sys/Obj.html#toImmutable'>Obj.toImmutable</a></code> on a List, Map, or Func</li>
</ul>

<p>By definition a const class is immutable - the compiler verifies that all the instance fields are themselves immutable and only set in the object's constructor.</p>

<p><code>Func</code> objects are determined as mutable or immutable by the compiler depending on if the function captures mutable state from its environment.  See <a href='Functions.html#immutable'>Functions</a> for more details.</p>

<p>The <code>toImmutable</code> method supported by <code>List</code> and <code>Map</code> is a mechanism to return a readonly, deep copy of the collection which ensures all that all values and keys are themselves immutable.  The compiler will allow assignment to const List/Map fields during construction, but it implicitly makes a call to <code>toImmutable</code>.  For example to declare a const list of strings:</p>

<pre>// what you write
class SouthPark
{
  const static Str[] names := ["Stan", "Cartman", "Kenny"]
}

// what the compiler generates
class SouthPark
{
  const static Str[] names := ["Stan", "Cartman", "Kenny"]?.toImmutable
}</pre>

<p>You can check if an object is immutable via the <code><a href='../sys/Obj.html#isImmutable'>Obj.isImmutable</a></code> method.</p>

<h1 id='sharedObjects'>Shared Objects </h1>

<p>Actors allow objects to be shared between threads.  Specific APIs which will pass an object to another thread include:</p>

<ul>
<li><code><a href='../concurrent/Actor.html#send'>Actor.send</a></code></li>

<li><code><a href='../concurrent/Actor.html#sendLater'>Actor.sendLater</a></code></li>

<li><code><a href='../concurrent/Actor.html#sendWhenDone'>Actor.sendWhenDone</a></code></li>

<li><code><a href='../concurrent/Future.html#get'>Future.get</a></code></li>
</ul>

<p>All of these APIs use the same pattern to safely pass an object between threads.  If an object is immutable then we can safely pass it to another thread by reference.  Otherwise we assume the object is <a href='Serialization.html'>serializable</a> and pass a serialized copy of the object to another thread.  Both of these approaches have their pros and cons to consider in your application design:</p>

<ul>
<li>immutable:
<ul>
<li>ideal for simple structures if fast to create</li>

<li>deeply structured objects expensive to change inside a single thread</li>

<li>always extremely efficient to pass between threads</li>
</ul>
</li>

<li>serializable:
<ul>
<li>deeply structured objects can be modified efficiently in a single thread</li>

<li>moderately expensive to pass between threads</li>
</ul>
</li>
</ul>
<div class='prevNext'>
<div class='prev'><a href='Serialization.html'><img src='../go-previous.png' alt='prev' /></a> <a href='Serialization.html'>Serialization</a></div>
<div class='next'><a href='Actors.html'>Actors</a> <a href='Actors.html'><img src='../go-next.png' alt='next' /></a></div>
</div>
</div>
<div class='sidebar'>
<h2>Contents</h2>
<ul>
<li><a href='#overview'>Overview </a></li><li><a href='#immutability'>Immutability </a></li><li><a href='#sharedObjects'>Shared Objects </a></li></ul>
</div>
</div>
</div>
<div class='footer'>
<div>
<p>
docLang 1.0.56
[11-Nov-2010 Thu 10:08:28AM EST]
</p>
</div>
</div>
</body>
</html>
