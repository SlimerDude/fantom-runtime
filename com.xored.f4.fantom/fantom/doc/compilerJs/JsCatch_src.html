<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns='http://www.w3.org/1999/xhtml'>
<head>
  <title>compilerJs::JsCatch</title>
  <meta http-equiv='Content-Type' content='text/html; charset=UTF-8'/>
  <link rel='stylesheet' type='text/css' href='../doc.css'/>
  <script type='text/javascript' src='../doc.js'></script>
<!--[if lt IE 7]>
<script src='http://ie7-js.googlecode.com/svn/version/2.0(beta3)/IE7.js' type='text/javascript'></script>
<![endif]-->
</head>
<body onload='Login.check();'>
<div class='header'>
<div>
<h1><a href='/'>Fantom</a></h1>
<p id='sidewalkLogin_'>&nbsp;</p>
<form method='get' action='/sidewalk/search/'>
<p>
<input type='text' name='q' size='30' value='Search...' onfocus='if (value=="Search...") value=""' onblur='if (value=="") value="Search..."' />
</p>
</form>
<ul>
<li><a href='/'>Home</a></li>
<li class='active'><a href='../index.html'>Docs</a></li>
<li><a href='/sidewalk/blog/'>Blog</a></li>
<li><a href='/sidewalk/ticket/'>Tickets</a></li>
<li><a href='/sidewalk/topic/'>Discuss</a></li>
</ul></div>
</div>
<div class='subHeader'>
<div>
<ul>
  <li><a href='../index.html'>Doc Home</a></li>
  <li>&gt;</li>
  <li><a href='index.html'>compilerJs</a></li>
  <li>&gt;</li>
  <li><a href='JsCatch.html'>JsCatch</a></li>
</ul>
</div>
</div>
<div class='content'>
<div>
<div class='fandoc'>
<div class='type'>
<div class='overview'>
<h2>class</h2>
<h1>compilerJs::JsCatch</h1>
<pre><a href='../sys/Obj.html'>sys::Obj</a>
  <a href='JsNode.html'>compilerJs::JsNode</a>
    compilerJs::JsCatch</pre>
</div>
</div>
<div class='src'>
<pre>
<span class='y'>//</span>
<span class='y'>// Copyright (c) 2009, Brian Frank and Andy Frank</span>
<span class='y'>// Licensed under the Academic Free License version 3.0</span>
<span class='y'>//</span>
<span class='y'>// History:</span>
<span class='y'>//   11 Sep 09  Andy Frank  Creation</span>
<span class='y'>//</span>

<span class='k'>using</span> compiler

<span class='z'>**</span>
<span class='z'>** JsStmt</span>
<span class='z'>**</span>
<span class='k'>abstract</span> <span class='k'>class</span> JsStmt : JsNode
<span class='b'>{</span>
  <span class='k'>new</span> make<span class='b'>(</span>JsCompilerSupport s<span class='b'>)</span> : <span class='k'>super</span><span class='b'>(</span>s<span class='b'>)</span> <span class='b'>{}</span>

  <span class='k'>static</span> JsStmt makeFor<span class='b'>(</span>JsCompilerSupport s, Stmt stmt<span class='b'>)</span>
  <span class='b'>{</span>
    <span class='k'>switch</span> <span class='b'>(</span>stmt.id<span class='b'>)</span>
    <span class='b'>{</span>
      <span class='k'>case</span> StmtId.nop:          <span class='k'>return</span> JsNoOpStmt<span class='b'>(</span>s<span class='b'>)</span>
      <span class='k'>case</span> StmtId.expr:         <span class='k'>return</span> JsExprStmt<span class='b'>(</span>s, stmt<span class='b'>)</span>
      <span class='k'>case</span> StmtId.localDef:     <span class='k'>return</span> JsLocalDefStmt<span class='b'>(</span>s, stmt<span class='b'>)</span>
      <span class='k'>case</span> StmtId.ifStmt:       <span class='k'>return</span> JsIfStmt<span class='b'>(</span>s, stmt<span class='b'>)</span>
      <span class='k'>case</span> StmtId.returnStmt:   <span class='k'>return</span> JsReturnStmt<span class='b'>(</span>s, stmt<span class='b'>)</span>
      <span class='k'>case</span> StmtId.throwStmt:    <span class='k'>return</span> JsThrowStmt<span class='b'>(</span>s, stmt<span class='b'>)</span>
      <span class='k'>case</span> StmtId.forStmt:      <span class='k'>return</span> JsForStmt<span class='b'>(</span>s, stmt<span class='b'>)</span>
      <span class='k'>case</span> StmtId.whileStmt:    <span class='k'>return</span> JsWhileStmt<span class='b'>(</span>s, stmt<span class='b'>)</span>
      <span class='k'>case</span> StmtId.breakStmt:    <span class='k'>return</span> JsBreakStmt<span class='b'>(</span>s<span class='b'>)</span>
      <span class='k'>case</span> StmtId.continueStmt: <span class='k'>return</span> JsContinueStmt<span class='b'>(</span>s<span class='b'>)</span>
      <span class='k'>case</span> StmtId.tryStmt:      <span class='k'>return</span> JsTryStmt<span class='b'>(</span>s, stmt<span class='b'>)</span>
      <span class='k'>case</span> StmtId.switchStmt:   <span class='k'>return</span> JsSwitchStmt<span class='b'>(</span>s, stmt<span class='b'>)</span>
      <span class='k'>default</span>: <span class='k'>throw</span> s.err<span class='b'>(</span><span class='s'>"Unknown StmtId: $stmt.id"</span>, stmt.loc<span class='b'>)</span>
    <span class='b'>}</span>
  <span class='b'>}</span>
<span class='b'>}</span>

<span class='z'>**************************************************************************</span>
<span class='z'>** JsNoOpStmt</span>
<span class='z'>**************************************************************************</span>

<span class='k'>class</span> JsNoOpStmt : JsStmt
<span class='b'>{</span>
  <span class='k'>new</span> make<span class='b'>(</span>JsCompilerSupport s<span class='b'>)</span> : <span class='k'>super</span><span class='b'>(</span>s<span class='b'>)</span> <span class='b'>{}</span>
  <span class='k'>override</span> Void write<span class='b'>(</span>JsWriter out<span class='b'>)</span> <span class='b'>{}</span>
<span class='b'>}</span>

<span class='z'>**************************************************************************</span>
<span class='z'>** JsExprStmt</span>
<span class='z'>**************************************************************************</span>

<span class='k'>class</span> JsExprStmt : JsStmt
<span class='b'>{</span>
  <span class='k'>new</span> make<span class='b'>(</span>JsCompilerSupport s, ExprStmt stmt<span class='b'>)</span> : <span class='k'>super</span><span class='b'>(</span>s<span class='b'>)</span>
  <span class='b'>{</span>
    <span class='k'>this</span>.expr = JsExpr.makeFor<span class='b'>(</span>s, stmt.expr<span class='b'>)</span>
  <span class='b'>}</span>
  <span class='k'>override</span> Void write<span class='b'>(</span>JsWriter out<span class='b'>)</span>
  <span class='b'>{</span>
    expr.write<span class='b'>(</span>out<span class='b'>)</span>
  <span class='b'>}</span>
  JsExpr expr
<span class='b'>}</span>

<span class='z'>**************************************************************************</span>
<span class='z'>** JsLocalDefStmt</span>
<span class='z'>**************************************************************************</span>

<span class='k'>class</span> JsLocalDefStmt : JsStmt
<span class='b'>{</span>
  <span class='k'>new</span> make<span class='b'>(</span>JsCompilerSupport s, LocalDefStmt lds<span class='b'>)</span> : <span class='k'>super</span><span class='b'>(</span>s<span class='b'>)</span>
  <span class='b'>{</span>
    <span class='k'>this</span>.name = lds.name
    <span class='k'>this</span>.init = <span class='b'>(</span>lds.init != <span class='k'>null</span><span class='b'>)</span> ? JsExpr.makeFor<span class='b'>(</span>s, lds.init<span class='b'>)</span> : <span class='k'>null</span>
  <span class='b'>}</span>
  <span class='k'>override</span> Void write<span class='b'>(</span>JsWriter out<span class='b'>)</span>
  <span class='b'>{</span>
    out.w<span class='b'>(</span><span class='s'>"var "</span><span class='b'>)</span>
    <span class='k'>if</span> <span class='b'>(</span>init == <span class='k'>null</span><span class='b'>)</span> out.w<span class='b'>(</span>name<span class='b'>)</span>
    <span class='k'>else</span> init.write<span class='b'>(</span>out<span class='b'>)</span>
  <span class='b'>}</span>
  Str name
  JsExpr? init
<span class='b'>}</span>

<span class='z'>**************************************************************************</span>
<span class='z'>** JsIfStmt</span>
<span class='z'>**************************************************************************</span>

<span class='k'>class</span> JsIfStmt : JsStmt
<span class='b'>{</span>
  <span class='k'>new</span> make<span class='b'>(</span>JsCompilerSupport s, IfStmt fs<span class='b'>)</span> : <span class='k'>super</span><span class='b'>(</span>s<span class='b'>)</span>
  <span class='b'>{</span>
    <span class='k'>this</span>.cond = JsExpr.makeFor<span class='b'>(</span>s, fs.condition<span class='b'>)</span>
    <span class='k'>this</span>.trueBlock  = JsBlock<span class='b'>(</span>s, fs.trueBlock<span class='b'>)</span>
    <span class='k'>this</span>.falseBlock = <span class='b'>(</span>fs.falseBlock != <span class='k'>null</span><span class='b'>)</span> ? JsBlock<span class='b'>(</span>s, fs.falseBlock<span class='b'>)</span> : <span class='k'>null</span>
  <span class='b'>}</span>

  <span class='k'>override</span> Void write<span class='b'>(</span>JsWriter out<span class='b'>)</span>
  <span class='b'>{</span>
    out.w<span class='b'>(</span><span class='s'>"if ("</span><span class='b'>)</span>; cond.write<span class='b'>(</span>out<span class='b'>)</span>; out.w<span class='b'>(</span><span class='s'>")"</span><span class='b'>)</span>.nl
    out.w<span class='b'>(</span><span class='s'>"{"</span><span class='b'>)</span>.nl
    out.indent
    trueBlock.write<span class='b'>(</span>out<span class='b'>)</span>
    out.unindent
    out.w<span class='b'>(</span><span class='s'>"}"</span><span class='b'>)</span>.nl
    <span class='k'>if</span> <span class='b'>(</span>falseBlock != <span class='k'>null</span><span class='b'>)</span>
    <span class='b'>{</span>
      out.w<span class='b'>(</span><span class='s'>"else"</span><span class='b'>)</span>.nl
      out.w<span class='b'>(</span><span class='s'>"{"</span><span class='b'>)</span>.nl
      out.indent
      falseBlock.write<span class='b'>(</span>out<span class='b'>)</span>
      out.unindent
      out.w<span class='b'>(</span><span class='s'>"}"</span><span class='b'>)</span>.nl
    <span class='b'>}</span>
  <span class='b'>}</span>

  JsExpr cond
  JsBlock trueBlock
  JsBlock? falseBlock
<span class='b'>}</span>

<span class='z'>**************************************************************************</span>
<span class='z'>** JsReturnStmt</span>
<span class='z'>**************************************************************************</span>

<span class='k'>class</span> JsReturnStmt : JsStmt
<span class='b'>{</span>
  <span class='k'>new</span> make<span class='b'>(</span>JsCompilerSupport s, ReturnStmt rs<span class='b'>)</span> : <span class='k'>super</span><span class='b'>(</span>s<span class='b'>)</span>
  <span class='b'>{</span>
    expr = <span class='b'>(</span>rs.expr != <span class='k'>null</span><span class='b'>)</span> ? JsExpr.makeFor<span class='b'>(</span>s, rs.expr<span class='b'>)</span> : <span class='k'>null</span>
  <span class='b'>}</span>
  <span class='k'>override</span> Void write<span class='b'>(</span>JsWriter out<span class='b'>)</span>
  <span class='b'>{</span>
    out.w<span class='b'>(</span><span class='s'>"return"</span><span class='b'>)</span>
    <span class='k'>if</span> <span class='b'>(</span>expr != <span class='k'>null</span><span class='b'>)</span>
    <span class='b'>{</span>
      out.w<span class='b'>(</span><span class='s'>" "</span><span class='b'>)</span>
      expr.write<span class='b'>(</span>out<span class='b'>)</span>
    <span class='b'>}</span>
  <span class='b'>}</span>
  JsExpr? expr
<span class='b'>}</span>

<span class='z'>**************************************************************************</span>
<span class='z'>** JsThrowStmt</span>
<span class='z'>**************************************************************************</span>

<span class='k'>class</span> JsThrowStmt : JsStmt
<span class='b'>{</span>
  <span class='k'>new</span> make<span class='b'>(</span>JsCompilerSupport s, ThrowStmt ts<span class='b'>)</span> : <span class='k'>super</span><span class='b'>(</span>s<span class='b'>)</span>
  <span class='b'>{</span>
    <span class='k'>this</span>.expr = JsExpr.makeFor<span class='b'>(</span>s, ts.exception<span class='b'>)</span>
  <span class='b'>}</span>
  <span class='k'>override</span> Void write<span class='b'>(</span>JsWriter out<span class='b'>)</span>
  <span class='b'>{</span>
    out.w<span class='b'>(</span><span class='s'>"throw "</span><span class='b'>)</span>
    expr.write<span class='b'>(</span>out<span class='b'>)</span>
  <span class='b'>}</span>
  JsExpr? expr
<span class='b'>}</span>

<span class='z'>**************************************************************************</span>
<span class='z'>** JsForStmt</span>
<span class='z'>**************************************************************************</span>

<span class='k'>class</span> JsForStmt : JsStmt
<span class='b'>{</span>
  <span class='k'>new</span> make<span class='b'>(</span>JsCompilerSupport s, ForStmt fs<span class='b'>)</span> : <span class='k'>super</span><span class='b'>(</span>s<span class='b'>)</span>
  <span class='b'>{</span>
    <span class='k'>this</span>.init   = <span class='b'>(</span>fs.init != <span class='k'>null</span><span class='b'>)</span> ? JsStmt.makeFor<span class='b'>(</span>s, fs.init<span class='b'>)</span> : <span class='k'>null</span>
    <span class='k'>this</span>.cond   = <span class='b'>(</span>fs.condition != <span class='k'>null</span><span class='b'>)</span> ? JsExpr.makeFor<span class='b'>(</span>s, fs.condition<span class='b'>)</span> : <span class='k'>null</span>
    <span class='k'>this</span>.update = <span class='b'>(</span>fs.update != <span class='k'>null</span><span class='b'>)</span> ? JsExpr.makeFor<span class='b'>(</span>s, fs.update<span class='b'>)</span> : <span class='k'>null</span>
    <span class='k'>this</span>.block  = <span class='b'>(</span>fs.block != <span class='k'>null</span><span class='b'>)</span> ? JsBlock<span class='b'>(</span>s, fs.block<span class='b'>)</span> : <span class='k'>null</span>
  <span class='b'>}</span>

  <span class='k'>override</span> Void write<span class='b'>(</span>JsWriter out<span class='b'>)</span>
  <span class='b'>{</span>
    out.w<span class='b'>(</span><span class='s'>"for ("</span><span class='b'>)</span>; init?.write<span class='b'>(</span>out<span class='b'>)</span>; out.w<span class='b'>(</span><span class='s'>"; "</span><span class='b'>)</span>
      cond?.write<span class='b'>(</span>out<span class='b'>)</span>; out.w<span class='b'>(</span><span class='s'>"; "</span><span class='b'>)</span>
      update?.write<span class='b'>(</span>out<span class='b'>)</span>; out.w<span class='b'>(</span><span class='s'>")"</span><span class='b'>)</span>.nl
    out.w<span class='b'>(</span><span class='s'>"{"</span><span class='b'>)</span>.nl
    out.indent
    block?.write<span class='b'>(</span>out<span class='b'>)</span>
    out.unindent
    out.w<span class='b'>(</span><span class='s'>"}"</span><span class='b'>)</span>.nl
  <span class='b'>}</span>

  JsStmt? init
  JsExpr? cond
  JsExpr? update
  JsBlock? block
<span class='b'>}</span>

<span class='z'>**************************************************************************</span>
<span class='z'>** JsWhileStmt</span>
<span class='z'>**************************************************************************</span>

<span class='k'>class</span> JsWhileStmt : JsStmt
<span class='b'>{</span>
  <span class='k'>new</span> make<span class='b'>(</span>JsCompilerSupport s, WhileStmt ws<span class='b'>)</span> : <span class='k'>super</span><span class='b'>(</span>s<span class='b'>)</span>
  <span class='b'>{</span>
    <span class='k'>this</span>.cond  = JsExpr.makeFor<span class='b'>(</span>s, ws.condition<span class='b'>)</span>
    <span class='k'>this</span>.block = JsBlock<span class='b'>(</span>s, ws.block<span class='b'>)</span>
  <span class='b'>}</span>

  <span class='k'>override</span> Void write<span class='b'>(</span>JsWriter out<span class='b'>)</span>
  <span class='b'>{</span>
    out.w<span class='b'>(</span><span class='s'>"while ("</span><span class='b'>)</span>; cond.write<span class='b'>(</span>out<span class='b'>)</span>; out.w<span class='b'>(</span><span class='s'>")"</span><span class='b'>)</span>.nl
    out.w<span class='b'>(</span><span class='s'>"{"</span><span class='b'>)</span>.nl
    out.indent
    block.write<span class='b'>(</span>out<span class='b'>)</span>
    out.unindent
    out.w<span class='b'>(</span><span class='s'>"}"</span><span class='b'>)</span>.nl
  <span class='b'>}</span>

  JsExpr cond
  JsBlock block
<span class='b'>}</span>

<span class='z'>**************************************************************************</span>
<span class='z'>** JsBreakStmt</span>
<span class='z'>**************************************************************************</span>

<span class='k'>class</span> JsBreakStmt : JsStmt
<span class='b'>{</span>
  <span class='k'>new</span> make<span class='b'>(</span>JsCompilerSupport s<span class='b'>)</span> : <span class='k'>super</span><span class='b'>(</span>s<span class='b'>)</span> <span class='b'>{}</span>
  <span class='k'>override</span> Void write<span class='b'>(</span>JsWriter out<span class='b'>)</span> <span class='b'>{</span> out.w<span class='b'>(</span><span class='s'>"break"</span><span class='b'>)</span> <span class='b'>}</span>
<span class='b'>}</span>

<span class='z'>**************************************************************************</span>
<span class='z'>** JsContinueStmt</span>
<span class='z'>**************************************************************************</span>

<span class='k'>class</span> JsContinueStmt : JsStmt
<span class='b'>{</span>
  <span class='k'>new</span> make<span class='b'>(</span>JsCompilerSupport s<span class='b'>)</span> : <span class='k'>super</span><span class='b'>(</span>s<span class='b'>)</span> <span class='b'>{}</span>
  <span class='k'>override</span> Void write<span class='b'>(</span>JsWriter out<span class='b'>)</span> <span class='b'>{</span> out.w<span class='b'>(</span><span class='s'>"continue"</span><span class='b'>)</span> <span class='b'>}</span>
<span class='b'>}</span>

<span class='z'>**************************************************************************</span>
<span class='z'>** JsTryStmt</span>
<span class='z'>**************************************************************************</span>

<span class='k'>class</span> JsTryStmt : JsStmt
<span class='b'>{</span>
  <span class='k'>new</span> make<span class='b'>(</span>JsCompilerSupport s, TryStmt ts<span class='b'>)</span> : <span class='k'>super</span><span class='b'>(</span>s<span class='b'>)</span>
  <span class='b'>{</span>
    <span class='k'>this</span>.block  = <span class='b'>(</span>ts.block != <span class='k'>null</span><span class='b'>)</span> ? JsBlock<span class='b'>(</span>s, ts.block<span class='b'>)</span> : <span class='k'>null</span>
    <span class='k'>this</span>.catches = ts.catches.map |c-&gt;JsCatch| <span class='b'>{</span> JsCatch<span class='b'>(</span>s, c<span class='b'>)</span> <span class='b'>}</span>
    <span class='k'>this</span>.finallyBlock = <span class='b'>(</span>ts.finallyBlock != <span class='k'>null</span><span class='b'>)</span> ? JsBlock<span class='b'>(</span>s, ts.finallyBlock<span class='b'>)</span> : <span class='k'>null</span>
  <span class='b'>}</span>

  <span class='k'>override</span> Void write<span class='b'>(</span>JsWriter out<span class='b'>)</span>
  <span class='b'>{</span>
    out.w<span class='b'>(</span><span class='s'>"try"</span><span class='b'>)</span>.nl
    out.w<span class='b'>(</span><span class='s'>"{"</span><span class='b'>)</span>.nl
    out.indent
    block?.write<span class='b'>(</span>out<span class='b'>)</span>
    out.unindent
    out.w<span class='b'>(</span><span class='s'>"}"</span><span class='b'>)</span>.nl

    <span class='k'>if</span> <span class='b'>(</span>!catches.isEmpty<span class='b'>)</span> writeCatches<span class='b'>(</span>out<span class='b'>)</span>

    <span class='k'>if</span> <span class='b'>(</span>finallyBlock != <span class='k'>null</span><span class='b'>)</span>
    <span class='b'>{</span>
      out.w<span class='b'>(</span><span class='s'>"finally"</span><span class='b'>)</span>.nl
      out.w<span class='b'>(</span><span class='s'>"{"</span><span class='b'>)</span>.nl
      out.indent
      finallyBlock.write<span class='b'>(</span>out<span class='b'>)</span>
      out.unindent
      out.w<span class='b'>(</span><span class='s'>"}"</span><span class='b'>)</span>.nl
    <span class='b'>}</span>
  <span class='b'>}</span>

  <span class='k'>private</span> Void writeCatches<span class='b'>(</span>JsWriter out<span class='b'>)</span>
  <span class='b'>{</span>
    var := support.unique
    hasTyped    := catches.any |c| <span class='b'>{</span> c.qname != <span class='k'>null</span> <span class='b'>}</span>
    hasCatchAll := catches.any |c| <span class='b'>{</span> c.qname == <span class='k'>null</span> <span class='b'>}</span>

    out.w<span class='b'>(</span><span class='s'>"catch ($var)"</span><span class='b'>)</span>.nl
    out.w<span class='b'>(</span><span class='s'>"{"</span><span class='b'>)</span>.nl
    out.indent
    <span class='k'>if</span> <span class='b'>(</span>hasTyped<span class='b'>)</span> out.w<span class='b'>(</span><span class='s'>"$var = fan.sys.Err.make($var);"</span><span class='b'>)</span>.nl

    doElse := <span class='k'>false</span>
    catches.each |c|
    <span class='b'>{</span>
      <span class='k'>if</span> <span class='b'>(</span>c.qname != <span class='k'>null</span><span class='b'>)</span>
      <span class='b'>{</span>
        <span class='k'>if</span> <span class='b'>(</span>doElse<span class='b'>)</span> out.w<span class='b'>(</span><span class='s'>"else "</span><span class='b'>)</span>
        <span class='k'>else</span> doElse = <span class='k'>true</span>

        out.w<span class='b'>(</span><span class='s'>"if ($var instanceof $c.qname)"</span><span class='b'>)</span>.nl
        out.w<span class='b'>(</span><span class='s'>"{"</span><span class='b'>)</span>.nl
        out.indent
        out.w<span class='b'>(</span><span class='s'>"var $c.var = $var;"</span><span class='b'>)</span>.nl
        c.write<span class='b'>(</span>out<span class='b'>)</span>
        out.unindent
        out.w<span class='b'>(</span><span class='s'>"}"</span><span class='b'>)</span>.nl
      <span class='b'>}</span>
      <span class='k'>else</span>
      <span class='b'>{</span>
        hasElse := catches.size &gt; 1
        <span class='k'>if</span> <span class='b'>(</span>hasElse<span class='b'>)</span>
        <span class='b'>{</span>
          out.w<span class='b'>(</span><span class='s'>"else"</span><span class='b'>)</span>.nl
          out.w<span class='b'>(</span><span class='s'>"{"</span><span class='b'>)</span>.nl
          out.indent
        <span class='b'>}</span>
        c.write<span class='b'>(</span>out<span class='b'>)</span>
        <span class='k'>if</span> <span class='b'>(</span>hasElse<span class='b'>)</span>
        <span class='b'>{</span>
          out.unindent
          out.w<span class='b'>(</span><span class='s'>"}"</span><span class='b'>)</span>.nl
        <span class='b'>}</span>
      <span class='b'>}</span>
    <span class='b'>}</span>

    <span class='k'>if</span> <span class='b'>(</span>!hasCatchAll<span class='b'>)</span>
    <span class='b'>{</span>
      out.w<span class='b'>(</span><span class='s'>"else"</span><span class='b'>)</span>.nl
      out.w<span class='b'>(</span><span class='s'>"{"</span><span class='b'>)</span>.nl
      out.indent
      out.w<span class='b'>(</span><span class='s'>"throw $var;"</span><span class='b'>)</span>.nl
      out.unindent
      out.w<span class='b'>(</span><span class='s'>"}"</span><span class='b'>)</span>.nl
    <span class='b'>}</span>
    out.unindent
    out.w<span class='b'>(</span><span class='s'>"}"</span><span class='b'>)</span>.nl
  <span class='b'>}</span>

  JsBlock? block         <span class='y'>// try block</span>
  JsCatch<span class='b'>[]</span> catches      <span class='y'>// catch blocks</span>
  JsBlock? finallyBlock  <span class='y'>// finally block</span>
<span class='b'>}</span>

<span class='z'>**************************************************************************</span>
<span class='z'>** JsCatch</span>
<span class='z'>**************************************************************************</span>

<span class='k'>class</span> JsCatch : JsNode
<span class='b'>{</span>
  <span class='k'>new</span> <span id='make'>make</span><span class='b'>(</span>JsCompilerSupport s, Catch c<span class='b'>)</span> : <span class='k'>super</span><span class='b'>(</span>s<span class='b'>)</span>
  <span class='b'>{</span>
    <span class='k'>this</span>.var   = c.errVariable ?: support.unique
    <span class='k'>this</span>.qname = <span class='b'>(</span>c.errType != <span class='k'>null</span><span class='b'>)</span> ? qnameToJs<span class='b'>(</span>c.errType<span class='b'>)</span> : <span class='k'>null</span>
    <span class='k'>this</span>.block = <span class='b'>(</span>c.block != <span class='k'>null</span><span class='b'>)</span> ? JsBlock<span class='b'>(</span>s, c.block<span class='b'>)</span> : <span class='k'>null</span>
  <span class='b'>}</span>
  <span class='k'>override</span> Void <span id='write'>write</span><span class='b'>(</span>JsWriter out<span class='b'>)</span>
  <span class='b'>{</span>
    block?.write<span class='b'>(</span>out<span class='b'>)</span>
  <span class='b'>}</span>
  Str <span id='var'>var</span>          <span class='y'>// name of expection variable</span>
  Str? <span id='qname'>qname</span>       <span class='y'>// qname of err type</span>
  JsBlock? <span id='block'>block</span>   <span class='y'>// catch block</span>
<span class='b'>}</span>

<span class='z'>**************************************************************************</span>
<span class='z'>** JsSwitchStmt</span>
<span class='z'>**************************************************************************</span>

<span class='k'>class</span> JsSwitchStmt : JsStmt
<span class='b'>{</span>
  <span class='k'>new</span> make<span class='b'>(</span>JsCompilerSupport s, SwitchStmt ss<span class='b'>)</span> : <span class='k'>super</span><span class='b'>(</span>s<span class='b'>)</span>
  <span class='b'>{</span>
    <span class='k'>this</span>.cond  = JsExpr.makeFor<span class='b'>(</span>s, ss.condition<span class='b'>)</span>
    <span class='k'>this</span>.cases = ss.cases.map |c-&gt;JsCase| <span class='b'>{</span> JsCase<span class='b'>(</span>s, c<span class='b'>)</span> <span class='b'>}</span>
    <span class='k'>this</span>.defBlock = <span class='b'>(</span>ss.defaultBlock != <span class='k'>null</span><span class='b'>)</span> ? JsBlock<span class='b'>(</span>s, ss.defaultBlock<span class='b'>)</span> : <span class='k'>null</span>
  <span class='b'>}</span>

  <span class='k'>override</span> Void write<span class='b'>(</span>JsWriter out<span class='b'>)</span>
  <span class='b'>{</span>
    var := support.unique
    out.w<span class='b'>(</span><span class='s'>"var $var = "</span><span class='b'>)</span>; cond.write<span class='b'>(</span>out<span class='b'>)</span>; out.w<span class='b'>(</span><span class='s'>";"</span><span class='b'>)</span>.nl
    cases.each |c, i|
    <span class='b'>{</span>
      <span class='k'>if</span> <span class='b'>(</span>i &gt; 0<span class='b'>)</span> out.w<span class='b'>(</span><span class='s'>"else "</span><span class='b'>)</span>
      out.w<span class='b'>(</span><span class='s'>"if ("</span><span class='b'>)</span>
      c.cases.each |e, j|
      <span class='b'>{</span>
        <span class='k'>if</span> <span class='b'>(</span>j &gt; 0<span class='b'>)</span> out.w<span class='b'>(</span><span class='s'>" || "</span><span class='b'>)</span>
        out.w<span class='b'>(</span><span class='s'>"fan.sys.ObjUtil.equals($var,"</span><span class='b'>)</span>; e.write<span class='b'>(</span>out<span class='b'>)</span>; out.w<span class='b'>(</span><span class='s'>")"</span><span class='b'>)</span>
      <span class='b'>}</span>
      out.w<span class='b'>(</span><span class='s'>")"</span><span class='b'>)</span>.nl
      out.w<span class='b'>(</span><span class='s'>"{"</span><span class='b'>)</span>.nl
      out.indent
      c.block?.write<span class='b'>(</span>out<span class='b'>)</span>
      out.unindent
      out.w<span class='b'>(</span><span class='s'>"}"</span><span class='b'>)</span>.nl
    <span class='b'>}</span>
    <span class='k'>if</span> <span class='b'>(</span>defBlock != <span class='k'>null</span><span class='b'>)</span>
    <span class='b'>{</span>
      <span class='k'>if</span> <span class='b'>(</span>!cases.isEmpty<span class='b'>)</span>
      <span class='b'>{</span>
        out.w<span class='b'>(</span><span class='s'>"else"</span><span class='b'>)</span>.nl
        out.w<span class='b'>(</span><span class='s'>"{"</span><span class='b'>)</span>.nl
        out.indent
        defBlock.write<span class='b'>(</span>out<span class='b'>)</span>
        out.unindent
        out.w<span class='b'>(</span><span class='s'>"}"</span><span class='b'>)</span>.nl
      <span class='b'>}</span>
      <span class='k'>else</span> <span class='b'>{</span> defBlock.write<span class='b'>(</span>out<span class='b'>)</span> <span class='b'>}</span>
    <span class='b'>}</span>
  <span class='b'>}</span>

  JsExpr cond         <span class='y'>// switch condition</span>
  JsCase<span class='b'>[]</span> cases      <span class='y'>// case stmts</span>
  JsBlock? defBlock   <span class='y'>// default case</span>

<span class='b'>}</span>

<span class='z'>**************************************************************************</span>
<span class='z'>** JsCase</span>
<span class='z'>**************************************************************************</span>

<span class='k'>class</span> JsCase : JsNode
<span class='b'>{</span>
  <span class='k'>new</span> make<span class='b'>(</span>JsCompilerSupport s, Case c<span class='b'>)</span> : <span class='k'>super</span><span class='b'>(</span>s<span class='b'>)</span>
  <span class='b'>{</span>
    <span class='k'>this</span>.cases = c.cases.map |ex-&gt;JsExpr| <span class='b'>{</span> JsExpr.makeFor<span class='b'>(</span>s, ex<span class='b'>)</span> <span class='b'>}</span>
    <span class='k'>this</span>.block = <span class='b'>(</span>c.block != <span class='k'>null</span><span class='b'>)</span> ? JsBlock<span class='b'>(</span>s, c.block<span class='b'>)</span> : <span class='k'>null</span>
  <span class='b'>}</span>
  <span class='k'>override</span> Void write<span class='b'>(</span>JsWriter out<span class='b'>)</span>
  <span class='b'>{</span>
    block?.write<span class='b'>(</span>out<span class='b'>)</span>
  <span class='b'>}</span>
  JsExpr<span class='b'>[]</span> cases
  JsBlock? block
<span class='b'>}</span>

</pre>
</div>
</div>
<div class='sidebar'>
<h2>More Info</h2>
<ul class='clean'>
  <li><a href='JsCatch.html'>View Fandoc</a></li>
</ul>
<div class='slots'>
<div class='overview'>
<h2>Slots</h2>
<ul class='clean'>
  <li style='display: block;'><a href='#block'>block</a></li>
  <li style='display: block;'><a href='#make'>make</a></li>
  <li style='display: block;'><a href='#qname'>qname</a></li>
  <li style='display: block;'><a href='#var'>var</a></li>
  <li style='display: block;'><a href='#write'>write</a></li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='footer'>
<div>
<p>
compilerJs 1.0.56
[11-Nov-2010 Thu 10:08:18AM EST]
</p>
</div>
</div>
</body>
</html>
