<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns='http://www.w3.org/1999/xhtml'>
<head>
  <title>obix::ObixObj</title>
  <meta http-equiv='Content-Type' content='text/html; charset=UTF-8'/>
  <link rel='stylesheet' type='text/css' href='../doc.css'/>
  <script type='text/javascript' src='../doc.js'></script>
<!--[if lt IE 7]>
<script src='http://ie7-js.googlecode.com/svn/version/2.0(beta3)/IE7.js' type='text/javascript'></script>
<![endif]-->
</head>
<body onload='Login.check();'>
<div class='header'>
<div>
<h1><a href='/'>Fantom</a></h1>
<p id='sidewalkLogin_'>&nbsp;</p>
<form method='get' action='/sidewalk/search/'>
<p>
<input type='text' name='q' size='30' value='Search...' onfocus='if (value=="Search...") value=""' onblur='if (value=="") value="Search..."' />
</p>
</form>
<ul>
<li><a href='/'>Home</a></li>
<li class='active'><a href='../index.html'>Docs</a></li>
<li><a href='/sidewalk/blog/'>Blog</a></li>
<li><a href='/sidewalk/ticket/'>Tickets</a></li>
<li><a href='/sidewalk/topic/'>Discuss</a></li>
</ul></div>
</div>
<div class='subHeader'>
<div>
<ul>
  <li><a href='../index.html'>Doc Home</a></li>
  <li>&gt;</li>
  <li><a href='index.html'>obix</a></li>
  <li>&gt;</li>
  <li><a href='ObixObj.html'>ObixObj</a></li>
</ul>
</div>
</div>
<div class='content'>
<div>
<div class='fandoc'>
<div class='type'>
<div class='overview'>
<h2>class</h2>
<h1>obix::ObixObj</h1>
<pre><a href='../sys/Obj.html'>sys::Obj</a>
  obix::ObixObj</pre>
</div>
</div>
<div class='src'>
<pre>
<span class='y'>//</span>
<span class='y'>// Copyright (c) 2009, Brian Frank and Andy Frank</span>
<span class='y'>// Licensed under the Academic Free License version 3.0</span>
<span class='y'>//</span>
<span class='y'>// History:</span>
<span class='y'>//   10 Jan 09  Brian Frank  Creation</span>
<span class='y'>//</span>

<span class='z'>**</span>
<span class='z'>** ObixObj models an 'obix:obj' element.</span>
<span class='z'>**</span>
<span class='k'>class</span> ObixObj
<span class='b'>{</span>

<span class='y'>//////////////////////////////////////////////////////////////////////////</span>
<span class='y'>// Identity</span>
<span class='y'>//////////////////////////////////////////////////////////////////////////</span>

  <span class='z'>**</span>
  <span class='z'>** Programatic name of the object which defines role of</span>
  <span class='z'>** this object in its parent.  Throw UnsupportedErr if an</span>
  <span class='z'>** attempt is made to set the name once mounted under a parent.</span>
  <span class='z'>**</span>
  Str? <span id='name'>name</span>
  <span class='b'>{</span>
    set
    <span class='b'>{</span>
      <span class='k'>if</span> <span class='b'>(</span>parent != <span class='k'>null</span><span class='b'>)</span> <span class='k'>throw</span> UnsupportedErr<span class='b'>(</span><span class='s'>"cannot set name while parented"</span><span class='b'>)</span>
      <span class='k'>this</span>.&amp;name = it
    <span class='b'>}</span>
  <span class='b'>}</span>

  <span class='z'>**</span>
  <span class='z'>** URI of this object. The root object of a document must have</span>
  <span class='z'>** an absolute URI, other objects may have a URI relative to</span>
  <span class='z'>** the document root.  See `normalizedHref` to get this href</span>
  <span class='z'>** normalized against the root object.</span>
  <span class='z'>**</span>
  Uri? <span id='href'>href</span>

  <span class='z'>**</span>
  <span class='z'>** Get this objects `href` normalized against the root object's</span>
  <span class='z'>** URI.  Return null no href defined.</span>
  <span class='z'>**</span>
  Uri? <span id='normalizedHref'>normalizedHref</span><span class='b'>()</span>
  <span class='b'>{</span>
    <span class='k'>if</span> <span class='b'>(</span>href == <span class='k'>null</span><span class='b'>)</span> <span class='k'>return</span> <span class='k'>null</span>
    r := root
    <span class='k'>if</span> <span class='b'>(</span>r.href == <span class='k'>null</span><span class='b'>)</span> <span class='k'>return</span> <span class='k'>null</span>
    <span class='k'>return</span> r.href + href
  <span class='b'>}</span>

  <span class='z'>**</span>
  <span class='z'>** The XML element name to use for this object.  If not</span>
  <span class='z'>** one of the valid oBIX element names then throw ArgErr.</span>
  <span class='z'>** Valid element names are:</span>
  <span class='z'>**   obj, bool, int, real, str, enum, uri, abstime,</span>
  <span class='z'>**   reltime, date, time, list, op, feed, ref, err</span>
  <span class='z'>**</span>
  Str <span id='elemName'>elemName</span> := <span class='s'>"obj"</span>
  <span class='b'>{</span>
    set
    <span class='b'>{</span>
      <span class='k'>if</span> <span class='b'>(</span>!ObixUtil.elemNames<span class='b'>[</span>it<span class='b'>])</span> <span class='k'>throw</span> ArgErr<span class='b'>(</span><span class='s'>"Invalid elemName: $it"</span><span class='b'>)</span>
      <span class='k'>this</span>.&amp;elemName = it
    <span class='b'>}</span>
  <span class='b'>}</span>

  <span class='z'>**</span>
  <span class='z'>** Return string representation.</span>
  <span class='z'>**</span>
  <span class='k'>override</span> Str <span id='toStr'>toStr</span><span class='b'>()</span>
  <span class='b'>{</span>
    s := StrBuf<span class='b'>()</span>
    s.add<span class='b'>(</span><span class='s'>"&lt;"</span><span class='b'>)</span>.add<span class='b'>(</span>elemName<span class='b'>)</span>
    <span class='k'>if</span> <span class='b'>(</span>name != <span class='k'>null</span><span class='b'>)</span> s.add<span class='b'>(</span><span class='s'>" name='"</span><span class='b'>)</span>.add<span class='b'>(</span>name<span class='b'>)</span>.add<span class='b'>(</span><span class='s'>"'"</span><span class='b'>)</span>
    <span class='k'>if</span> <span class='b'>(</span>href != <span class='k'>null</span><span class='b'>)</span> s.add<span class='b'>(</span><span class='s'>" href='"</span><span class='b'>)</span>.add<span class='b'>(</span>href<span class='b'>)</span>.add<span class='b'>(</span><span class='s'>"'"</span><span class='b'>)</span>
    <span class='k'>if</span> <span class='b'>(</span>val != <span class='k'>null</span><span class='b'>)</span>  s.add<span class='b'>(</span><span class='s'>" val='"</span><span class='b'>)</span>.add<span class='b'>(</span>ObixUtil.valToStr<span class='b'>(</span>val<span class='b'>))</span>.add<span class='b'>(</span><span class='s'>"'"</span><span class='b'>)</span>
    s.add<span class='b'>(</span><span class='s'>"&gt;"</span><span class='b'>)</span>;
    <span class='k'>return</span> s.toStr
  <span class='b'>}</span>

<span class='y'>//////////////////////////////////////////////////////////////////////////</span>
<span class='y'>// Contracts</span>
<span class='y'>//////////////////////////////////////////////////////////////////////////</span>

  <span class='z'>**</span>
  <span class='z'>** The list of contract URIs this object implemented</span>
  <span class='z'>** as specified by 'is' attribute.</span>
  <span class='z'>**</span>
  Contract <span id='contract'>contract</span> := Contract.empty

  <span class='z'>**</span>
  <span class='z'>** The 'of' contract for lists and feeds.</span>
  <span class='z'>**</span>
  Contract? <span id='of'>of</span>

  <span class='z'>**</span>
  <span class='z'>** The 'in' contract for operations and feeds.</span>
  <span class='z'>**</span>
  Contract? <span id='in'>in</span>

  <span class='z'>**</span>
  <span class='z'>** The 'out' contract for operations.</span>
  <span class='z'>**</span>
  Contract? <span id='out'>out</span>

<span class='y'>//////////////////////////////////////////////////////////////////////////</span>
<span class='y'>// Value</span>
<span class='y'>//////////////////////////////////////////////////////////////////////////</span>

  <span class='z'>**</span>
  <span class='z'>** The null flag indicates the absense of a value.</span>
  <span class='z'>**</span>
  Bool <span id='isNull'>isNull</span>

  <span class='z'>**</span>
  <span class='z'>** Object value for value object types:</span>
  <span class='z'>**   - obix:bool    =&gt; sys::Bool</span>
  <span class='z'>**   - obix:int     =&gt; sys::Int</span>
  <span class='z'>**   - obix:real    =&gt; sys::Float</span>
  <span class='z'>**   - obix:str     =&gt; sys::Str</span>
  <span class='z'>**   - obix:enum    =&gt; sys::Str</span>
  <span class='z'>**   - obix:uri     =&gt; sys::Uri</span>
  <span class='z'>**   - obix:abstime =&gt; sys::DateTime</span>
  <span class='z'>**   - obix:reltime =&gt; sys::Duration</span>
  <span class='z'>**   - obix:date    =&gt; sys::Date</span>
  <span class='z'>**   - obix:time    =&gt; sys::Time</span>
  <span class='z'>**</span>
  <span class='z'>** If the value is not one of the types listed above, then ArgErr is</span>
  <span class='z'>** thrown.  If the value is set to non-null, then the `elemName` is</span>
  <span class='z'>** automatically updated.</span>
  <span class='z'>**</span>
  Obj? <span id='val'>val</span>
  <span class='b'>{</span>
    set
    <span class='b'>{</span>
      <span class='y'>// TODO: clean this up</span>
      <span class='k'>if</span> <span class='b'>(</span>elemName == <span class='s'>"enum"</span> &amp;&amp; it <span class='k'>is</span> Str<span class='b'>)</span> <span class='b'>{</span> &amp;val = it; <span class='k'>return</span> <span class='b'>}</span>
      <span class='k'>if</span> <span class='b'>(</span>it != <span class='k'>null</span><span class='b'>)</span>
      <span class='b'>{</span>
        elem := ObixUtil.valTypeToElemName<span class='b'>[</span>Type.of<span class='b'>(</span>it<span class='b'>)]</span>
        <span class='k'>if</span> <span class='b'>(</span>elem == <span class='k'>null</span><span class='b'>)</span> <span class='k'>throw</span> ArgErr<span class='b'>(</span><span class='s'>"Invalid val type: ${Type.of(it)}"</span><span class='b'>)</span>
        <span class='k'>this</span>.&amp;elemName = elem
        <span class='k'>if</span> <span class='b'>(</span>it <span class='k'>is</span> DateTime &amp;&amp; tz == <span class='k'>null</span><span class='b'>)</span>
        <span class='b'>{</span>
          tz := <span class='b'>((</span>DateTime<span class='b'>)</span>it<span class='b'>)</span>.tz
          <span class='k'>if</span> <span class='b'>(</span>!tz.fullName.startsWith<span class='b'>(</span><span class='s'>"Etc/"</span><span class='b'>))</span> <span class='k'>this</span>.tz = tz
        <span class='b'>}</span>
      <span class='b'>}</span>
      &amp;val = it
    <span class='b'>}</span>
  <span class='b'>}</span>

  <span class='z'>**</span>
  <span class='z'>** Get the value encoded as a string.  The string is *not*</span>
  <span class='z'>** XML escaped.  If value is null return "null".</span>
  <span class='z'>**</span>
  Str <span id='valToStr'>valToStr</span><span class='b'>()</span>
  <span class='b'>{</span>
    <span class='k'>return</span> ObixUtil.valToStr<span class='b'>(</span>val<span class='b'>)</span>
  <span class='b'>}</span>

<span class='y'>//////////////////////////////////////////////////////////////////////////</span>
<span class='y'>// Parent/Child Tree</span>
<span class='y'>//////////////////////////////////////////////////////////////////////////</span>

  <span class='z'>**</span>
  <span class='z'>** Get the root ancestor of this object, or</span>
  <span class='z'>** return 'this' if no parent.</span>
  <span class='z'>**</span>
  ObixObj <span id='root'>root</span><span class='b'>()</span>
  <span class='b'>{</span>
    x := <span class='k'>this</span>
    <span class='k'>while</span> <span class='b'>(</span>x.parent != <span class='k'>null</span><span class='b'>)</span> x = x.parent
    <span class='k'>return</span> x
  <span class='b'>}</span>

  <span class='z'>**</span>
  <span class='z'>** Parent object or null if unparented.</span>
  <span class='z'>**</span>
  <span class='k'>readonly</span> ObixObj? <span id='parent'>parent</span>

  <span class='z'>**</span>
  <span class='z'>** Return is size is zero.</span>
  <span class='z'>**</span>
  Bool <span id='isEmpty'>isEmpty</span><span class='b'>()</span> <span class='b'>{</span> <span class='k'>return</span> kidsCount == 0 <span class='b'>}</span>

  <span class='z'>**</span>
  <span class='z'>** Return number of child objects.</span>
  <span class='z'>**</span>
  Int <span id='size'>size</span><span class='b'>()</span> <span class='b'>{</span> <span class='k'>return</span> kidsCount <span class='b'>}</span>

  <span class='z'>**</span>
  <span class='z'>** Return if there is child object by the specified name.</span>
  <span class='z'>**</span>
  Bool <span id='has'>has</span><span class='b'>(</span>Str name<span class='b'>)</span>
  <span class='b'>{</span>
    <span class='k'>if</span> <span class='b'>(</span>kidsByName == <span class='k'>null</span><span class='b'>)</span> <span class='k'>return</span> <span class='k'>false</span>
    <span class='k'>return</span> kidsByName.containsKey<span class='b'>(</span>name<span class='b'>)</span>
  <span class='b'>}</span>

  <span class='z'>**</span>
  <span class='z'>** Get a child by name.  If not found and checked is true</span>
  <span class='z'>** then throw NameErr, otherwise null.</span>
  <span class='z'>**</span>
  @Operator ObixObj? <span id='get'>get</span><span class='b'>(</span>Str name, Bool checked := <span class='k'>true</span><span class='b'>)</span>
  <span class='b'>{</span>
    child := kidsByName?.get<span class='b'>(</span>name<span class='b'>)</span>
    <span class='k'>if</span> <span class='b'>(</span>child != <span class='k'>null</span><span class='b'>)</span> <span class='k'>return</span> child
    <span class='k'>if</span> <span class='b'>(</span>checked<span class='b'>)</span> <span class='k'>throw</span> NameErr<span class='b'>(</span><span class='s'>"Missing obix child '$name'"</span><span class='b'>)</span>
    <span class='k'>return</span> <span class='k'>null</span>
  <span class='b'>}</span>

  <span class='z'>**</span>
  <span class='z'>** If the name maps to a child object, then return that</span>
  <span class='z'>** child's value.  Otherwise route to 'Obj.trap'.</span>
  <span class='z'>**</span>
  <span class='k'>override</span> Obj? <span id='trap'>trap</span><span class='b'>(</span>Str name, Obj?<span class='b'>[]</span>? args<span class='b'>)</span>
  <span class='b'>{</span>
    child := kidsByName?.get<span class='b'>(</span>name<span class='b'>)</span>
    <span class='k'>if</span> <span class='b'>(</span>child != <span class='k'>null</span><span class='b'>)</span> <span class='k'>return</span> child.val
    <span class='k'>return</span> <span class='k'>super</span>.trap<span class='b'>(</span>name, args<span class='b'>)</span>
  <span class='b'>}</span>

  <span class='z'>**</span>
  <span class='z'>** Get a readonly list of the children objects or empty</span>
  <span class='z'>** list if no children.  If iterating the children it is</span>
  <span class='z'>** more efficient to use `each`.</span>
  <span class='z'>**</span>
  ObixObj<span class='b'>[]</span> <span id='list'>list</span><span class='b'>()</span>
  <span class='b'>{</span>
    <span class='k'>if</span> <span class='b'>(</span>kidsCount == 0<span class='b'>)</span> <span class='k'>return</span> noChildren
    list := ObixObj<span class='b'>[</span>,<span class='b'>]</span> <span class='b'>{</span> capacity = kidsCount <span class='b'>}</span>
    <span class='k'>for</span> <span class='b'>(</span>ObixObj? p := kidsHead; p != <span class='k'>null</span>; p = p.next<span class='b'>)</span> list.add<span class='b'>(</span>p<span class='b'>)</span>
    <span class='k'>return</span> list.ro
  <span class='b'>}</span>

  <span class='z'>**</span>
  <span class='z'>** Get the first child returned by `list` or null.</span>
  <span class='z'>**</span>
  ObixObj? <span id='first'>first</span><span class='b'>()</span> <span class='b'>{</span> kidsHead <span class='b'>}</span>

  <span class='z'>**</span>
  <span class='z'>** Get the last child returned by `list` or null.</span>
  <span class='z'>**</span>
  ObixObj? <span id='last'>last</span><span class='b'>()</span> <span class='b'>{</span> kidsTail <span class='b'>}</span>

  <span class='z'>**</span>
  <span class='z'>** Iterate each of the children objects.</span>
  <span class='z'>**</span>
  Void <span id='each'>each</span><span class='b'>(</span>|ObixObj child| f<span class='b'>)</span>
  <span class='b'>{</span>
    <span class='k'>for</span> <span class='b'>(</span>ObixObj? p := kidsHead; p != <span class='k'>null</span>; p = p.next<span class='b'>)</span> f<span class='b'>(</span>p<span class='b'>)</span>
  <span class='b'>}</span>

  <span class='z'>**</span>
  <span class='z'>** Add a child object.  Throw ArgErr if this child is</span>
  <span class='z'>** already parented or has a duplicate name.  Return this.</span>
  <span class='z'>**</span>
  This <span id='add'>add</span><span class='b'>(</span>ObixObj kid<span class='b'>)</span>
  <span class='b'>{</span>
    <span class='y'>// sanity checks</span>
    <span class='k'>if</span> <span class='b'>(</span>kid.parent != <span class='k'>null</span> || kid.prev != <span class='k'>null</span> || kid.next != <span class='k'>null</span><span class='b'>)</span>
      <span class='k'>throw</span> ArgErr<span class='b'>(</span><span class='s'>"Child is already parented"</span><span class='b'>)</span>
    <span class='k'>if</span> <span class='b'>(</span>kid.name != <span class='k'>null</span> &amp;&amp; kidsByName != <span class='k'>null</span> &amp;&amp; kidsByName.containsKey<span class='b'>(</span>kid.name<span class='b'>)</span> &amp;&amp; elemName != <span class='s'>"list"</span><span class='b'>)</span>
      <span class='k'>throw</span> ArgErr<span class='b'>(</span><span class='s'>"Duplicate child name '$kid.name'"</span><span class='b'>)</span>

    <span class='y'>// if named, add to name map</span>
    <span class='k'>if</span> <span class='b'>(</span>kid.name != <span class='k'>null</span><span class='b'>)</span>
    <span class='b'>{</span>
      <span class='k'>if</span> <span class='b'>(</span>kidsByName == <span class='k'>null</span><span class='b'>)</span> kidsByName = Str:ObixObj<span class='b'>[</span>:<span class='b'>]</span>
      kidsByName<span class='b'>[</span>kid.name<span class='b'>]</span> = kid
    <span class='b'>}</span>

    <span class='y'>// add to ordered linked list</span>
    <span class='k'>if</span> <span class='b'>(</span>kidsTail == <span class='k'>null</span><span class='b'>)</span> <span class='b'>{</span> kidsHead = kidsTail = kid <span class='b'>}</span>
    <span class='k'>else</span> <span class='b'>{</span> kidsTail.next = kid; kid.prev = kidsTail; kidsTail = kid <span class='b'>}</span>

    <span class='y'>// update kid's references and count</span>
    kidsCount++
    kid.parent = <span class='k'>this</span>
    <span class='k'>return</span> <span class='k'>this</span>
  <span class='b'>}</span>

  <span class='z'>**</span>
  <span class='z'>** Remove the specified child object by reference.</span>
  <span class='z'>** Throw ArgErr if not my child.  Return this</span>
  <span class='z'>**</span>
  This <span id='remove'>remove</span><span class='b'>(</span>ObixObj kid<span class='b'>)</span>
  <span class='b'>{</span>
    <span class='y'>// sanity checks</span>
    <span class='k'>if</span> <span class='b'>(</span>kid.parent != <span class='k'>this</span><span class='b'>)</span> <span class='k'>throw</span> ArgErr<span class='b'>(</span><span class='s'>"Not parented by me"</span><span class='b'>)</span>

    <span class='y'>// remove from name map if applicable</span>
    <span class='k'>if</span> <span class='b'>(</span>kid.name != <span class='k'>null</span><span class='b'>)</span> kidsByName.remove<span class='b'>(</span>kid.name<span class='b'>)</span>

    <span class='y'>// remove from linked list</span>
    <span class='k'>if</span> <span class='b'>(</span>kidsHead == kid<span class='b'>)</span> <span class='b'>{</span> kidsHead = kid.next <span class='b'>}</span>
    <span class='k'>else</span> <span class='b'>{</span> kid.prev.next = kid.next <span class='b'>}</span>
    <span class='k'>if</span> <span class='b'>(</span>kidsTail == kid<span class='b'>)</span> <span class='b'>{</span> kidsTail = kid.prev <span class='b'>}</span>
    <span class='k'>else</span> <span class='b'>{</span> kid.next.prev = kid.prev <span class='b'>}</span>

    <span class='y'>// clear kid's references and count</span>
    kidsCount--
    kid.parent = <span class='k'>null</span>
    kid.prev   = <span class='k'>null</span>
    kid.next   = <span class='k'>null</span>
    <span class='k'>return</span> <span class='k'>this</span>
  <span class='b'>}</span>

  <span class='z'>**</span>
  <span class='z'>** Remove all children objects.  Return this.</span>
  <span class='z'>**</span>
  This <span id='clear'>clear</span><span class='b'>()</span>
  <span class='b'>{</span>
    ObixObj? p := kidsHead
    <span class='k'>while</span> <span class='b'>(</span>p != <span class='k'>null</span><span class='b'>)</span>
    <span class='b'>{</span>
      x := p.next
      p.parent = p.prev = p.next = <span class='k'>null</span>
      p = x
    <span class='b'>}</span>

    kidsByName.clear
    kidsHead = kidsTail = <span class='k'>null</span>
    kidsCount = 0
    <span class='k'>return</span> <span class='k'>this</span>
  <span class='b'>}</span>

<span class='y'>//////////////////////////////////////////////////////////////////////////</span>
<span class='y'>// Facets</span>
<span class='y'>//////////////////////////////////////////////////////////////////////////</span>

  <span class='z'>**</span>
  <span class='z'>** Localized human readable version of the name attribute.</span>
  <span class='z'>**</span>
  Str? <span id='displayName'>displayName</span>

  <span class='z'>**</span>
  <span class='z'>** Localized human readable string summary of the object.</span>
  <span class='z'>**</span>
  Str? <span id='display'>display</span>

  <span class='z'>**</span>
  <span class='z'>** Reference to the graphical icon.</span>
  <span class='z'>**</span>
  Uri? <span id='icon'>icon</span>

  <span class='z'>**</span>
  <span class='z'>** Inclusive minium for value.</span>
  <span class='z'>**</span>
  Obj? <span id='min'>min</span>

  <span class='z'>**</span>
  <span class='z'>** Inclusive maximum for value.</span>
  <span class='z'>**</span>
  Obj? <span id='max'>max</span>

  <span class='z'>**</span>
  <span class='z'>** Number of decimal places to use for a real value.</span>
  <span class='z'>**</span>
  Int? <span id='precision'>precision</span>

  <span class='z'>**</span>
  <span class='z'>** Reference to the range definition of an enum or bool value.</span>
  <span class='z'>**</span>
  Uri? <span id='range'>range</span>

  <span class='z'>**</span>
  <span class='z'>** Status facet indicates quality and state.</span>
  <span class='z'>**</span>
  Status <span id='status'>status</span> := Status.ok

  <span class='z'>**</span>
  <span class='z'>** TimeZone facet assocaited with abstime, date, and time objects.</span>
  <span class='z'>** This field is automatically updated when `val` is assigned a</span>
  <span class='z'>** DateTime unless its timezone is UTC or starts with "Etc/".  After</span>
  <span class='z'>** decoding this field is set only if an explicit "tz" attribute was</span>
  <span class='z'>** specified.</span>
  <span class='z'>**</span>
  TimeZone? <span id='tz'>tz</span>

  <span class='z'>**</span>
  <span class='z'>** Unit of measurement for int and real values.  We only support units</span>
  <span class='z'>** which are predefind in the oBIX unit database and specified using the</span>
  <span class='z'>** URI "obix:units/".  These units are mapped to the `sys::Unit` API.</span>
  <span class='z'>** If an unknown unit URI is decoded, then it is silently ignored and</span>
  <span class='z'>** this field will be null.</span>
  <span class='z'>**</span>
  Unit? <span id='unit'>unit</span>

  <span class='z'>**</span>
  <span class='z'>** Specifies is this object can be written, or false if readonly.</span>
  <span class='z'>**</span>
  Bool <span id='writable'>writable</span>

<span class='y'>//////////////////////////////////////////////////////////////////////////</span>
<span class='y'>// IO</span>
<span class='y'>//////////////////////////////////////////////////////////////////////////</span>

  <span class='z'>**</span>
  <span class='z'>** Parse an XML document into memory as a tree of ObixObj.</span>
  <span class='z'>** If close is true, then the input stream is guaranteed to</span>
  <span class='z'>** be closed.</span>
  <span class='z'>**</span>
  <span class='k'>static</span> ObixObj <span id='readXml'>readXml</span><span class='b'>(</span>InStream in, Bool close := <span class='k'>true</span><span class='b'>)</span>
  <span class='b'>{</span>
    <span class='k'>return</span> ObixXmlParser<span class='b'>(</span>in<span class='b'>)</span>.parse<span class='b'>(</span>close<span class='b'>)</span>
  <span class='b'>}</span>

  <span class='z'>**</span>
  <span class='z'>** Write this ObixObj as an XML document to the specified stream.</span>
  <span class='z'>** No XML prolog is specified so that this method can used to</span>
  <span class='z'>** write a snippet of the overall document.</span>
  <span class='z'>**</span>
  <span class='k'>virtual</span> Void <span id='writeXml'>writeXml</span><span class='b'>(</span>OutStream out, Int indent := 0<span class='b'>)</span>
  <span class='b'>{</span>
    <span class='y'>// identity</span>
    out.print<span class='b'>(</span>Str.spaces<span class='b'>(</span>indent<span class='b'>))</span>.print<span class='b'>(</span><span class='s'>"&lt;"</span><span class='b'>)</span>.print<span class='b'>(</span>elemName<span class='b'>)</span>
    <span class='k'>if</span> <span class='b'>(</span>name != <span class='k'>null</span><span class='b'>)</span> out.print<span class='b'>(</span><span class='s'>" name='"</span><span class='b'>)</span>.writeXml<span class='b'>(</span>name, xmlEsc<span class='b'>)</span>.print<span class='b'>(</span><span class='s'>"'"</span><span class='b'>)</span>
    <span class='k'>if</span> <span class='b'>(</span>href != <span class='k'>null</span><span class='b'>)</span> out.print<span class='b'>(</span><span class='s'>" href='"</span><span class='b'>)</span>.print<span class='b'>(</span>href.encode<span class='b'>)</span>.print<span class='b'>(</span><span class='s'>"'"</span><span class='b'>)</span>

    <span class='y'>// contracts</span>
    <span class='k'>if</span> <span class='b'>(</span>!contract.isEmpty<span class='b'>)</span> out.print<span class='b'>(</span><span class='s'>" is='"</span><span class='b'>)</span>.print<span class='b'>(</span>contract<span class='b'>)</span>.print<span class='b'>(</span><span class='s'>"'"</span><span class='b'>)</span>
    <span class='k'>if</span> <span class='b'>(</span>of != <span class='k'>null</span> &amp;&amp; !of.isEmpty<span class='b'>)</span> out.print<span class='b'>(</span><span class='s'>" of='"</span><span class='b'>)</span>.print<span class='b'>(</span>of<span class='b'>)</span>.print<span class='b'>(</span><span class='s'>"'"</span><span class='b'>)</span>
    <span class='k'>if</span> <span class='b'>(</span>in != <span class='k'>null</span> &amp;&amp; !in.isEmpty<span class='b'>)</span> out.print<span class='b'>(</span><span class='s'>" in='"</span><span class='b'>)</span>.print<span class='b'>(</span>in<span class='b'>)</span>.print<span class='b'>(</span><span class='s'>"'"</span><span class='b'>)</span>
    <span class='k'>if</span> <span class='b'>(</span><span class='k'>this</span>.out != <span class='k'>null</span> &amp;&amp; !<span class='k'>this</span>.out.isEmpty<span class='b'>)</span> out.print<span class='b'>(</span><span class='s'>" out='"</span><span class='b'>)</span>.print<span class='b'>(</span><span class='k'>this</span>.out<span class='b'>)</span>.print<span class='b'>(</span><span class='s'>"'"</span><span class='b'>)</span>

    <span class='y'>// value</span>
    <span class='k'>if</span> <span class='b'>(</span>val != <span class='k'>null</span><span class='b'>)</span> out.print<span class='b'>(</span><span class='s'>" val='"</span><span class='b'>)</span>.writeXml<span class='b'>(</span>valToStr, xmlEsc<span class='b'>)</span>.print<span class='b'>(</span><span class='s'>"'"</span><span class='b'>)</span>
    <span class='k'>if</span> <span class='b'>(</span>isNull<span class='b'>)</span> out.print<span class='b'>(</span><span class='s'>" isNull='true'"</span><span class='b'>)</span>

    <span class='y'>// facets</span>
    <span class='k'>if</span> <span class='b'>(</span>displayName != <span class='k'>null</span><span class='b'>)</span> out.print<span class='b'>(</span><span class='s'>" displayName='"</span><span class='b'>)</span>.writeXml<span class='b'>(</span>displayName, xmlEsc<span class='b'>)</span>.print<span class='b'>(</span><span class='s'>"'"</span><span class='b'>)</span>
    <span class='k'>if</span> <span class='b'>(</span>display != <span class='k'>null</span><span class='b'>)</span> out.print<span class='b'>(</span><span class='s'>" display='"</span><span class='b'>)</span>.writeXml<span class='b'>(</span>display, xmlEsc<span class='b'>)</span>.print<span class='b'>(</span><span class='s'>"'"</span><span class='b'>)</span>
    <span class='k'>if</span> <span class='b'>(</span>icon != <span class='k'>null</span><span class='b'>)</span> out.print<span class='b'>(</span><span class='s'>" icon='"</span><span class='b'>)</span>.print<span class='b'>(</span>icon.encode<span class='b'>)</span>.print<span class='b'>(</span><span class='s'>"'"</span><span class='b'>)</span>
    <span class='k'>if</span> <span class='b'>(</span>min != <span class='k'>null</span><span class='b'>)</span> out.print<span class='b'>(</span><span class='s'>" min='"</span><span class='b'>)</span>.print<span class='b'>(</span>ObixUtil.valToStr<span class='b'>(</span>min<span class='b'>))</span>.print<span class='b'>(</span><span class='s'>"'"</span><span class='b'>)</span>
    <span class='k'>if</span> <span class='b'>(</span>max != <span class='k'>null</span><span class='b'>)</span> out.print<span class='b'>(</span><span class='s'>" max='"</span><span class='b'>)</span>.print<span class='b'>(</span>ObixUtil.valToStr<span class='b'>(</span>max<span class='b'>))</span>.print<span class='b'>(</span><span class='s'>"'"</span><span class='b'>)</span>
    <span class='k'>if</span> <span class='b'>(</span>precision != <span class='k'>null</span><span class='b'>)</span> out.print<span class='b'>(</span><span class='s'>" precision='"</span><span class='b'>)</span>.print<span class='b'>(</span>precision<span class='b'>)</span>.print<span class='b'>(</span><span class='s'>"'"</span><span class='b'>)</span>
    <span class='k'>if</span> <span class='b'>(</span>range != <span class='k'>null</span><span class='b'>)</span> out.print<span class='b'>(</span><span class='s'>" range='"</span><span class='b'>)</span>.print<span class='b'>(</span>range.encode<span class='b'>)</span>.print<span class='b'>(</span><span class='s'>"'"</span><span class='b'>)</span>
    <span class='k'>if</span> <span class='b'>(</span>status !== Status.ok<span class='b'>)</span> out.print<span class='b'>(</span><span class='s'>" status='"</span><span class='b'>)</span>.print<span class='b'>(</span>status<span class='b'>)</span>.print<span class='b'>(</span><span class='s'>"'"</span><span class='b'>)</span>
    <span class='k'>if</span> <span class='b'>(</span>status !== Status.ok<span class='b'>)</span> out.print<span class='b'>(</span><span class='s'>" status='"</span><span class='b'>)</span>.print<span class='b'>(</span>status<span class='b'>)</span>.print<span class='b'>(</span><span class='s'>"'"</span><span class='b'>)</span>
    <span class='k'>if</span> <span class='b'>(</span>tz != <span class='k'>null</span><span class='b'>)</span> out.print<span class='b'>(</span><span class='s'>" tz='"</span><span class='b'>)</span>.print<span class='b'>(</span>tz.fullName<span class='b'>)</span>.print<span class='b'>(</span><span class='s'>"'"</span><span class='b'>)</span>
    <span class='k'>if</span> <span class='b'>(</span>unit != <span class='k'>null</span><span class='b'>)</span> out.print<span class='b'>(</span><span class='s'>" unit='obix:units/"</span><span class='b'>)</span>.print<span class='b'>(</span>unit.name<span class='b'>)</span>.print<span class='b'>(</span><span class='s'>"'"</span><span class='b'>)</span>
    <span class='k'>if</span> <span class='b'>(</span>writable<span class='b'>)</span> out.print<span class='b'>(</span><span class='s'>" writable='true'"</span><span class='b'>)</span>

    <span class='y'>// children</span>
    <span class='k'>if</span> <span class='b'>(</span>isEmpty<span class='b'>)</span> out.print<span class='b'>(</span><span class='s'>"/&gt;\n"</span><span class='b'>)</span>
    <span class='k'>else</span>
    <span class='b'>{</span>
      out.print<span class='b'>(</span><span class='s'>"&gt;\n"</span><span class='b'>)</span>
      each |ObixObj kid| <span class='b'>{</span> kid.writeXml<span class='b'>(</span>out, indent+1<span class='b'>)</span> <span class='b'>}</span>
      out.print<span class='b'>(</span>Str.spaces<span class='b'>(</span>indent<span class='b'>))</span>.print<span class='b'>(</span><span class='s'>"&lt;/"</span><span class='b'>)</span>.print<span class='b'>(</span>elemName<span class='b'>)</span>.print<span class='b'>(</span><span class='s'>"&gt;\n"</span><span class='b'>)</span>
    <span class='b'>}</span>
    <span class='k'>if</span> <span class='b'>(</span>parent == <span class='k'>null</span><span class='b'>)</span> out.flush
  <span class='b'>}</span>

<span class='y'>//////////////////////////////////////////////////////////////////////////</span>
<span class='y'>// Fields</span>
<span class='y'>//////////////////////////////////////////////////////////////////////////</span>

  <span class='k'>internal</span> <span class='k'>static</span> <span class='k'>const</span> Uri<span class='b'>[]</span> <span id='noUris'>noUris</span> := Uri<span class='b'>[</span>,<span class='b'>]</span>
  <span class='k'>internal</span> <span class='k'>static</span> <span class='k'>const</span> ObixObj<span class='b'>[]</span> <span id='noChildren'>noChildren</span> := ObixObj<span class='b'>[</span>,<span class='b'>]</span>
  <span class='k'>internal</span> <span class='k'>static</span> <span class='k'>const</span> Int <span id='xmlEsc'>xmlEsc</span> := OutStream.xmlEscNewlines.or<span class='b'>(</span>OutStream.xmlEscQuotes<span class='b'>)</span>

  <span class='k'>private</span> <span class='b'>[</span>Str:ObixObj<span class='b'>]</span>? <span id='kidsByName'>kidsByName</span> <span class='y'>// map of children by name</span>
  <span class='k'>private</span> ObixObj? <span id='kidsHead'>kidsHead</span>         <span class='y'>// children linked list</span>
  <span class='k'>private</span> ObixObj? <span id='kidsTail'>kidsTail</span>         <span class='y'>// children linked list</span>
  <span class='k'>private</span> Int <span id='kidsCount'>kidsCount</span>             <span class='y'>// children linked list</span>
  <span class='k'>private</span> ObixObj? <span id='prev'>prev</span>             <span class='y'>// sibling in parents linked list</span>
  <span class='k'>private</span> ObixObj? <span id='next'>next</span>             <span class='y'>// sibling in parents linked list</span>

<span class='b'>}</span></pre>
</div>
</div>
<div class='sidebar'>
<h2>More Info</h2>
<ul class='clean'>
  <li><a href='ObixObj.html'>View Fandoc</a></li>
</ul>
<div class='slots'>
<div class='overview'>
<h2>Slots</h2>
<ul class='clean'>
  <li style='display: block;'><a href='#add'>add</a></li>
  <li style='display: block;'><a href='#clear'>clear</a></li>
  <li style='display: block;'><a href='#contract'>contract</a></li>
  <li style='display: block;'><a href='#display'>display</a></li>
  <li style='display: block;'><a href='#displayName'>displayName</a></li>
  <li style='display: block;'><a href='#each'>each</a></li>
  <li style='display: block;'><a href='#elemName'>elemName</a></li>
  <li style='display: block;'><a href='#first'>first</a></li>
  <li style='display: block;'><a href='#get'>get</a></li>
  <li style='display: block;'><a href='#has'>has</a></li>
  <li style='display: block;'><a href='#href'>href</a></li>
  <li style='display: block;'><a href='#icon'>icon</a></li>
  <li style='display: block;'><a href='#in'>in</a></li>
  <li style='display: block;'><a href='#isEmpty'>isEmpty</a></li>
  <li style='display: block;'><a href='#isNull'>isNull</a></li>
  <li class='hidden' style='display: block;'><a href='#kidsByName'>kidsByName</a></li>
  <li class='hidden' style='display: block;'><a href='#kidsCount'>kidsCount</a></li>
  <li class='hidden' style='display: block;'><a href='#kidsHead'>kidsHead</a></li>
  <li class='hidden' style='display: block;'><a href='#kidsTail'>kidsTail</a></li>
  <li style='display: block;'><a href='#last'>last</a></li>
  <li style='display: block;'><a href='#list'>list</a></li>
  <li style='display: block;'><a href='#max'>max</a></li>
  <li style='display: block;'><a href='#min'>min</a></li>
  <li style='display: block;'><a href='#name'>name</a></li>
  <li class='hidden' style='display: block;'><a href='#next'>next</a></li>
  <li class='hidden' style='display: block;'><a href='#noChildren'>noChildren</a></li>
  <li class='hidden' style='display: block;'><a href='#noUris'>noUris</a></li>
  <li style='display: block;'><a href='#normalizedHref'>normalizedHref</a></li>
  <li style='display: block;'><a href='#of'>of</a></li>
  <li style='display: block;'><a href='#out'>out</a></li>
  <li style='display: block;'><a href='#parent'>parent</a></li>
  <li style='display: block;'><a href='#precision'>precision</a></li>
  <li class='hidden' style='display: block;'><a href='#prev'>prev</a></li>
  <li style='display: block;'><a href='#range'>range</a></li>
  <li style='display: block;'><a href='#readXml'>readXml</a></li>
  <li style='display: block;'><a href='#remove'>remove</a></li>
  <li style='display: block;'><a href='#root'>root</a></li>
  <li style='display: block;'><a href='#size'>size</a></li>
  <li style='display: block;'><a href='#status'>status</a></li>
  <li style='display: block;'><a href='#toStr'>toStr</a></li>
  <li style='display: block;'><a href='#trap'>trap</a></li>
  <li style='display: block;'><a href='#tz'>tz</a></li>
  <li style='display: block;'><a href='#unit'>unit</a></li>
  <li style='display: block;'><a href='#val'>val</a></li>
  <li style='display: block;'><a href='#valToStr'>valToStr</a></li>
  <li style='display: block;'><a href='#writable'>writable</a></li>
  <li style='display: block;'><a href='#writeXml'>writeXml</a></li>
  <li class='hidden' style='display: block;'><a href='#xmlEsc'>xmlEsc</a></li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='footer'>
<div>
<p>
obix 1.0.56
[11-Nov-2010 Thu 10:08:27AM EST]
</p>
</div>
</div>
</body>
</html>
