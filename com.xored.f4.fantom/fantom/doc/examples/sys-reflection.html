<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns='http://www.w3.org/1999/xhtml'>
<head>
  <title>reflection_6::Reflection</title>
  <meta http-equiv='Content-Type' content='text/html; charset=UTF-8'/>
  <link rel='stylesheet' type='text/css' href='../doc.css'/>
  <script type='text/javascript' src='../doc.js'></script>
<!--[if lt IE 7]>
<script src='http://ie7-js.googlecode.com/svn/version/2.0(beta3)/IE7.js' type='text/javascript'></script>
<![endif]-->
</head>
<body onload='Login.check();'>
<div class='header'>
<div>
<h1><a href='/'>Fantom</a></h1>
<p id='sidewalkLogin_'>&nbsp;</p>
<form method='get' action='/sidewalk/search/'>
<p>
<input type='text' name='q' size='30' value='Search...' onfocus='if (value=="Search...") value=""' onblur='if (value=="") value="Search..."' />
</p>
</form>
<ul>
<li><a href='/'>Home</a></li>
<li class='active'><a href='../index.html'>Docs</a></li>
<li><a href='/sidewalk/blog/'>Blog</a></li>
<li><a href='/sidewalk/ticket/'>Tickets</a></li>
<li><a href='/sidewalk/topic/'>Discuss</a></li>
</ul></div>
</div>
<div class='subHeader'>
<div>
<ul>
  <li><a href='../index.html'>Doc Home</a></li>
  <li>&gt;</li>
  <li><a href='index.html'>examples</a></li>
  <li>&gt;</li>
  <li><a href='Reflection.html'>sys-reflection.html</a></li>
</ul>
</div>
</div>
<div class='content'>
<div>
<div class='fandoc'>
<div class='src'>
<pre>
<span>#! /usr/bin/env fan
</span><span class='y'>//</span>
<span class='y'>// Copyright (c) 2008, Brian Frank and Andy Frank</span>
<span class='y'>// Licensed under the Academic Free License version 3.0</span>
<span class='y'>//</span>
<span class='y'>// History:</span>
<span class='y'>//   26 Mar 08  Brian Frank  Creation</span>
<span class='y'>//   08 Sep 09  Brian Frank  Rework fandoc -&gt; example</span>
<span class='y'>//</span>

<span class='k'>using</span> fwt

<span class='z'>**</span>
<span class='z'>** Working with Pod, Type, Slot, Field, Method, and Symbol</span>
<span class='z'>** reflection APIs.</span>
<span class='z'>**</span>
<span class='k'>class</span> Reflection
<span class='b'>{</span>
  Void <span id='main'>main</span><span class='b'>()</span>
  <span class='b'>{</span>
    pods
    types
    slots
    methods
    fields
  <span class='b'>}</span>

  Void <span id='pods'>pods</span><span class='b'>()</span>
  <span class='b'>{</span>
    echo<span class='b'>(</span><span class='s'>"\n--- pods ---"</span><span class='b'>)</span>
    p := Pod.find<span class='b'>(</span><span class='s'>"compiler"</span><span class='b'>)</span>
    show<span class='b'>(</span>Pod.list,                     <span class='s'>"list the pods installed"</span><span class='b'>)</span>
    show<span class='b'>(</span>Pod.find<span class='b'>(</span><span class='s'>"compiler"</span><span class='b'>)</span>,         <span class='s'>"find a pod (throws err if not found)"</span><span class='b'>)</span>
    show<span class='b'>(</span>Pod.find<span class='b'>(</span><span class='s'>"bad"</span>, <span class='k'>false</span><span class='b'>)</span>,       <span class='s'>"find a pod (returns null if not found)"</span><span class='b'>)</span>
    show<span class='b'>(</span>p.name,                       <span class='s'>"pod name"</span><span class='b'>)</span>
    show<span class='b'>(</span>p.version,                    <span class='s'>"pod version"</span><span class='b'>)</span>
    show<span class='b'>(</span>p.meta,                       <span class='s'>"all pod meta name/value metadata pairs"</span><span class='b'>)</span>
    show<span class='b'>(</span>p.meta<span class='b'>[</span><span class='s'>"build.time"</span><span class='b'>]</span>,         <span class='s'>"lookup a pod metadata key"</span><span class='b'>)</span>
    show<span class='b'>(</span>p.file<span class='b'>(</span><span class='u'>`/img/icon.png`</span>, <span class='k'>false</span><span class='b'>)</span>, <span class='s'>"lookup a resource file in myPod"</span><span class='b'>)</span>
  <span class='b'>}</span>

  Void <span id='types'>types</span><span class='b'>()</span>
  <span class='b'>{</span>
    echo<span class='b'>(</span><span class='s'>"\n--- types ---"</span><span class='b'>)</span>
    pod := Pod.find<span class='b'>(</span><span class='s'>"fwt"</span><span class='b'>)</span>
    t := pod.type<span class='b'>(</span><span class='s'>"Button"</span><span class='b'>)</span>
    show<span class='b'>(</span><span class='s'>"foo"</span>.typeof,                   <span class='s'>"get the type of the an object"</span><span class='b'>)</span>
    show<span class='b'>(</span>pod.types,                      <span class='s'>"list the types in myPod"</span><span class='b'>)</span>
    show<span class='b'>(</span>pod.type<span class='b'>(</span><span class='s'>"Button"</span><span class='b'>)</span>,             <span class='s'>"find a type in pod by simple name"</span><span class='b'>)</span>
    show<span class='b'>(</span>pod.type<span class='b'>(</span><span class='s'>"Foo"</span>, <span class='k'>false</span><span class='b'>)</span>,         <span class='s'>"returns null if type not found"</span><span class='b'>)</span>
    show<span class='b'>(</span>Type.find<span class='b'>(</span><span class='s'>"fwt::Label"</span><span class='b'>)</span>,        <span class='s'>"lookup a type by its qualified name"</span><span class='b'>)</span>
    show<span class='b'>(</span>Type.find<span class='b'>(</span><span class='s'>"fwt::Foo"</span>, <span class='k'>false</span><span class='b'>)</span>,   <span class='s'>"returns null if type not found"</span><span class='b'>)</span>
    show<span class='b'>(</span>Int#,                           <span class='s'>"type literal for sys::Int"</span><span class='b'>)</span>
    show<span class='b'>(</span>Int?<span class='b'>[]</span>#,                        <span class='s'>"type literal for sys::Int?[]"</span><span class='b'>)</span>
    show<span class='b'>(</span>t.fits<span class='b'>(</span>Num#<span class='b'>)</span>,                   <span class='s'>"reflective is/instanceof operator"</span><span class='b'>)</span>
    show<span class='b'>(</span>t.pod,                          <span class='s'>"get the pod of a type"</span><span class='b'>)</span>
    show<span class='b'>(</span>t.qname,                        <span class='s'>"qualified name of type"</span><span class='b'>)</span>
    show<span class='b'>(</span>t.name,                         <span class='s'>"simple unqualified name of type"</span><span class='b'>)</span>
    show<span class='b'>(</span>t.base,                         <span class='s'>"type's base class"</span><span class='b'>)</span>
    show<span class='b'>(</span>t.mixins,                       <span class='s'>"type's mixins or empty list"</span><span class='b'>)</span>
    show<span class='b'>(</span>t.inheritance,                  <span class='s'>"all the types inherited"</span><span class='b'>)</span>
    show<span class='b'>(</span>t.signature,                    <span class='s'>"formal type signature"</span><span class='b'>)</span>
    show<span class='b'>(</span>t.make,                         <span class='s'>"make an obj of type t"</span><span class='b'>)</span>
    show<span class='b'>(</span>t.facets,                       <span class='s'>"list of all declared facets"</span><span class='b'>)</span>
    show<span class='b'>(</span>t.facet<span class='b'>(</span>Serializable#, <span class='k'>false</span><span class='b'>)</span>,  <span class='s'>"lookup facet"</span><span class='b'>)</span>
    show<span class='b'>(</span>t.hasFacet<span class='b'>(</span>Serializable#<span class='b'>)</span>,      <span class='s'>"check if facet defined"</span><span class='b'>)</span>
  <span class='b'>}</span>

  Void <span id='slots'>slots</span><span class='b'>()</span>
  <span class='b'>{</span>
    echo<span class='b'>(</span><span class='s'>"\n--- slots ---"</span><span class='b'>)</span>
    t := Type.find<span class='b'>(</span><span class='s'>"fwt::Widget"</span><span class='b'>)</span>
    s := t.slot<span class='b'>(</span><span class='s'>"onFocus"</span><span class='b'>)</span>
    show<span class='b'>(</span>t.slot<span class='b'>(</span><span class='s'>"relayout"</span><span class='b'>)</span>,           <span class='s'>"lookup the slot called xyz on someType"</span><span class='b'>)</span>
    show<span class='b'>(</span>t.slots,                      <span class='s'>"list all the slots on someType"</span><span class='b'>)</span>
    show<span class='b'>(</span>Slot.find<span class='b'>(</span><span class='s'>"fwt::Widget.enabled"</span><span class='b'>)</span>,    <span class='s'>"looukp a slot by its qualified name"</span><span class='b'>)</span>
    show<span class='b'>(</span>Slot.find<span class='b'>(</span><span class='s'>"fwt::Widget.foo"</span>, <span class='k'>false</span><span class='b'>)</span>, <span class='s'>"returns null if slot not found"</span><span class='b'>)</span>
    show<span class='b'>(</span>Widget#enabled,               <span class='s'>"slot literal"</span><span class='b'>)</span>
    show<span class='b'>(</span>#main,                        <span class='s'>"slot literal (in enclosing class)"</span><span class='b'>)</span>
    show<span class='b'>(</span>s.qname,                      <span class='s'>"qualified name"</span><span class='b'>)</span>
    show<span class='b'>(</span>s.name,                       <span class='s'>"unqualified simple name"</span><span class='b'>)</span>
    show<span class='b'>(</span>s.parent,                     <span class='s'>"declaring type"</span><span class='b'>)</span>
    show<span class='b'>(</span>s.signature,                  <span class='s'>"full signature of field or method"</span><span class='b'>)</span>
    show<span class='b'>(</span>s.facets,                     <span class='s'>"map of all facets"</span><span class='b'>)</span>
    show<span class='b'>(</span>s.facet<span class='b'>(</span>Transient#, <span class='k'>false</span><span class='b'>)</span>,   <span class='s'>"lookup facet"</span><span class='b'>)</span>
    show<span class='b'>(</span>s.hasFacet<span class='b'>(</span>Transient#<span class='b'>)</span>,       <span class='s'>"check if facet defined"</span><span class='b'>)</span>
  <span class='b'>}</span>

  Void <span id='methods'>methods</span><span class='b'>()</span>
  <span class='b'>{</span>
    echo<span class='b'>(</span><span class='s'>"\n--- methods ---"</span><span class='b'>)</span>
    t  := Str#
    m  := Str#toInt
    ms := Str#spaces
    show<span class='b'>(</span>t.method<span class='b'>(</span><span class='s'>"split"</span><span class='b'>)</span>,            <span class='s'>"lookup the method called xyz on someType"</span><span class='b'>)</span>
    show<span class='b'>(</span>t.method<span class='b'>(</span><span class='s'>"foo"</span>, <span class='k'>false</span><span class='b'>)</span>,       <span class='s'>"returns null if method not found"</span><span class='b'>)</span>
    show<span class='b'>(</span>t.methods,                    <span class='s'>"list all the methods on someType"</span><span class='b'>)</span>
    show<span class='b'>(</span>Slot.findMethod<span class='b'>(</span><span class='s'>"sys::Str.split"</span><span class='b'>)</span>,      <span class='s'>"looukp a method by its qualified name"</span><span class='b'>)</span>
    show<span class='b'>(</span>Slot.findMethod<span class='b'>(</span><span class='s'>"sys::Str.foo"</span>, <span class='k'>false</span><span class='b'>)</span>, <span class='s'>"returns null if method not found"</span><span class='b'>)</span>
    show<span class='b'>(</span>m.returns,                    <span class='s'>"return type of method"</span><span class='b'>)</span>
    show<span class='b'>(</span>m.params,                     <span class='s'>"list of parameters"</span><span class='b'>)</span>
    show<span class='b'>(</span>ms.callList<span class='b'>([</span>3<span class='b'>])</span>-&gt;toCode,     <span class='s'>"invoke static method using reflection"</span><span class='b'>)</span>
    show<span class='b'>(</span>ms.call<span class='b'>(</span>3<span class='b'>)</span>-&gt;toCode,           <span class='s'>"same as above"</span><span class='b'>)</span>
    show<span class='b'>(</span>m.callOn<span class='b'>(</span><span class='s'>"100"</span>, <span class='b'>[</span>16<span class='b'>])</span>,        <span class='s'>"invoke instance method using reflection"</span><span class='b'>)</span>
    show<span class='b'>(</span>m.call<span class='b'>(</span><span class='s'>"100"</span>, 16<span class='b'>)</span>,            <span class='s'>"same as above"</span><span class='b'>)</span>
    show<span class='b'>(</span>m.func,                       <span class='s'>"the function which implements the method"</span><span class='b'>)</span>
  <span class='b'>}</span>

  Void <span id='fields'>fields</span><span class='b'>()</span>
  <span class='b'>{</span>
    echo<span class='b'>(</span><span class='s'>"\n--- fields ---"</span><span class='b'>)</span>
    t   := Type.find<span class='b'>(</span><span class='s'>"fwt::Label"</span><span class='b'>)</span>
    obj := t.make
    f   := t.field<span class='b'>(</span><span class='s'>"text"</span><span class='b'>)</span>
    show<span class='b'>(</span>t.field<span class='b'>(</span><span class='s'>"onBlur"</span><span class='b'>)</span>,            <span class='s'>"lookup the field called xyz on someType"</span><span class='b'>)</span>
    show<span class='b'>(</span>t.field<span class='b'>(</span><span class='s'>"x"</span>, <span class='k'>false</span><span class='b'>)</span>,          <span class='s'>"returns null if field not found"</span><span class='b'>)</span>
    show<span class='b'>(</span>t.fields,                     <span class='s'>"list all the fields on someType"</span><span class='b'>)</span>
    show<span class='b'>(</span>Slot.findField<span class='b'>(</span><span class='s'>"fwt::Label.text"</span><span class='b'>)</span>,       <span class='s'>"looukp a field by its qualified name"</span><span class='b'>)</span>
    show<span class='b'>(</span>Slot.findField<span class='b'>(</span><span class='s'>"fwt::Label.foo"</span>, <span class='k'>false</span><span class='b'>)</span>,  <span class='s'>"returns null if field not found"</span><span class='b'>)</span>
    show<span class='b'>(</span>f.type,                       <span class='s'>"type of field"</span><span class='b'>)</span>
    f.set<span class='b'>(</span>obj, <span class='s'>"hi"</span><span class='b'>)</span>                   <span class='y'>// set instance field</span>
    show<span class='b'>(</span>f.get<span class='b'>(</span>obj<span class='b'>)</span>,                   <span class='s'>"get instance field"</span><span class='b'>)</span>
    show<span class='b'>(</span>Float#pi.get,                 <span class='s'>"get static field"</span><span class='b'>)</span>
  <span class='b'>}</span>

  Void <span id='show'>show</span><span class='b'>(</span>Obj? result, Str what<span class='b'>)</span>
  <span class='b'>{</span>
    resultStr := <span class='s'>""</span> + result
    <span class='k'>if</span> <span class='b'>(</span>resultStr.size &gt; 40<span class='b'>)</span> resultStr = resultStr<span class='b'>[</span>0..40<span class='b'>]</span> + <span class='s'>"..."</span>
    echo<span class='b'>(</span>what.padr<span class='b'>(</span>40<span class='b'>)</span> + <span class='s'>" =&gt; "</span> + resultStr<span class='b'>)</span>
  <span class='b'>}</span>
<span class='b'>}</span>




</pre>
</div>
</div>
<div class='sidebar'>
<div class='slots'>
<div class='overview'>
<h2>Slots</h2>
<ul class='clean'>
  <li style='display: block;'><a href='#fields'>fields</a></li>
  <li style='display: block;'><a href='#main'>main</a></li>
  <li style='display: block;'><a href='#methods'>methods</a></li>
  <li style='display: block;'><a href='#pods'>pods</a></li>
  <li style='display: block;'><a href='#show'>show</a></li>
  <li style='display: block;'><a href='#slots'>slots</a></li>
  <li style='display: block;'><a href='#types'>types</a></li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='footer'>
<div>
<p>
[11-Nov-2010 Thu 10:09:02AM EST]
</p>
</div>
</div>
</body>
</html>
