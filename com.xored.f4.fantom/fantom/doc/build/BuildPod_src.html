<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns='http://www.w3.org/1999/xhtml'>
<head>
  <title>build::BuildPod</title>
  <meta http-equiv='Content-Type' content='text/html; charset=UTF-8'/>
  <link rel='stylesheet' type='text/css' href='../doc.css'/>
  <script type='text/javascript' src='../doc.js'></script>
<!--[if lt IE 7]>
<script src='http://ie7-js.googlecode.com/svn/version/2.0(beta3)/IE7.js' type='text/javascript'></script>
<![endif]-->
</head>
<body onload='Login.check();'>
<div class='header'>
<div>
<h1><a href='/'>Fantom</a></h1>
<p id='sidewalkLogin_'>&nbsp;</p>
<form method='get' action='/sidewalk/search/'>
<p>
<input type='text' name='q' size='30' value='Search...' onfocus='if (value=="Search...") value=""' onblur='if (value=="") value="Search..."' />
</p>
</form>
<ul>
<li><a href='/'>Home</a></li>
<li class='active'><a href='../index.html'>Docs</a></li>
<li><a href='/sidewalk/blog/'>Blog</a></li>
<li><a href='/sidewalk/ticket/'>Tickets</a></li>
<li><a href='/sidewalk/topic/'>Discuss</a></li>
</ul></div>
</div>
<div class='subHeader'>
<div>
<ul>
  <li><a href='../index.html'>Doc Home</a></li>
  <li>&gt;</li>
  <li><a href='index.html'>build</a></li>
  <li>&gt;</li>
  <li><a href='BuildPod.html'>BuildPod</a></li>
</ul>
</div>
</div>
<div class='content'>
<div>
<div class='fandoc'>
<div class='type'>
<div class='overview'>
<h2>abstract class</h2>
<h1>build::BuildPod</h1>
<pre><a href='../sys/Obj.html'>sys::Obj</a>
  <a href='BuildScript.html'>build::BuildScript</a>
    build::BuildPod</pre>
</div>
</div>
<div class='src'>
<pre>
<span class='y'>//</span>
<span class='y'>// Copyright (c) 2006, Brian Frank and Andy Frank</span>
<span class='y'>// Licensed under the Academic Free License version 3.0</span>
<span class='y'>//</span>
<span class='y'>// History:</span>
<span class='y'>//   3 Nov 06  Brian Frank  Creation</span>
<span class='y'>//</span>

<span class='k'>using</span> compiler

<span class='z'>**</span>
<span class='z'>** BuildPod is the base class for build scripts used to manage</span>
<span class='z'>** building a Fantom source code and resources into a Fantom pod.</span>
<span class='z'>**</span>
<span class='z'>** See `docTools::Build` for details.</span>
<span class='z'>**</span>
<span class='k'>abstract</span> <span class='k'>class</span> BuildPod : BuildScript
<span class='b'>{</span>

<span class='y'>//////////////////////////////////////////////////////////////////////////</span>
<span class='y'>// Env</span>
<span class='y'>//////////////////////////////////////////////////////////////////////////</span>

  <span class='z'>**</span>
  <span class='z'>** Required name of the pod.</span>
  <span class='z'>**</span>
  Str? <span id='podName'>podName</span> := <span class='k'>null</span>

  <span class='z'>**</span>
  <span class='z'>** Required summary description of pod.</span>
  <span class='z'>**</span>
  Str? <span id='summary'>summary</span> := <span class='k'>null</span>

  <span class='z'>**</span>
  <span class='z'>** Version of the pod - default is set to `config` prop 'buildVersion'.</span>
  <span class='z'>**</span>
  Version <span id='version'>version</span> := Version<span class='b'>(</span>config<span class='b'>(</span><span class='s'>"buildVersion"</span>, <span class='s'>"0"</span><span class='b'>))</span>

  <span class='z'>**</span>
  <span class='z'>** List of dependencies for pod formatted as `sys::Depend`.</span>
  <span class='z'>**</span>
  Str<span class='b'>[]</span> <span id='depends'>depends</span> := Str<span class='b'>[</span>,<span class='b'>]</span>

  <span class='z'>**</span>
  <span class='z'>** Pod meta-data name/value pairs to compile into pod.  See `sys::Pod.meta`.</span>
  <span class='z'>**</span>
  Str:Str <span id='meta'>meta</span> := Str:Str<span class='b'>[</span>:<span class='b'>]</span> <span class='b'>{</span> ordered = <span class='k'>true</span> <span class='b'>}</span>

  <span class='z'>**</span>
  <span class='z'>** Pod index name/value pairs to compile into pod.  See `sys::Env.index`.</span>
  <span class='z'>** The index values can be a single Str or a Str[] if there are</span>
  <span class='z'>** multiple values mapped to one key.</span>
  <span class='z'>**</span>
  Str:Obj <span id='index'>index</span> := Str:Obj<span class='b'>[</span>:<span class='b'>]</span>

  <span class='z'>**</span>
  <span class='z'>** Indicates if if fandoc API should be included in the documentation.</span>
  <span class='z'>** By default API *is* included.</span>
  <span class='z'>**</span>
  Bool <span id='docApi'>docApi</span> := <span class='k'>true</span>

  <span class='z'>**</span>
  <span class='z'>** Indicates if if source code should be included in the documentation.</span>
  <span class='z'>** By default source code it *not* included.</span>
  <span class='z'>**</span>
  Bool <span id='docSrc'>docSrc</span> := <span class='k'>false</span>

  <span class='z'>**</span>
  <span class='z'>** List of Uris relative to build script of directories containing</span>
  <span class='z'>** the Fan source files to compile.</span>
  <span class='z'>**</span>
  Uri<span class='b'>[]</span>? <span id='srcDirs'>srcDirs</span>

  <span class='z'>**</span>
  <span class='z'>** List of Uris relative to build script of directories of resources</span>
  <span class='z'>** files to package into pod zip file.  Optional.</span>
  <span class='z'>**</span>
  Uri<span class='b'>[]</span>? <span id='resDirs'>resDirs</span>

  <span class='z'>**</span>
  <span class='z'>** List of Uris relative to build script of directories containing</span>
  <span class='z'>** the Java source files to compile for Java native methods.</span>
  <span class='z'>**</span>
  Uri<span class='b'>[]</span>? <span id='javaDirs'>javaDirs</span>

  <span class='z'>**</span>
  <span class='z'>** List of Uris relative to build script of directories containing</span>
  <span class='z'>** the C# source files to compile for .NET native methods.</span>
  <span class='z'>**</span>
  Uri<span class='b'>[]</span>? <span id='dotnetDirs'>dotnetDirs</span>

  <span class='z'>**</span>
  <span class='z'>** List of Uris relative to build script of directories containing</span>
  <span class='z'>** the JavaScript source files to compile for JavaScript native methods.</span>
  <span class='z'>**</span>
  Uri<span class='b'>[]</span>? <span id='jsDirs'>jsDirs</span>

  <span class='z'>**</span>
  <span class='z'>** The directory to look in for the dependency pod file (and</span>
  <span class='z'>** potentially their recursive dependencies).  If null then we</span>
  <span class='z'>** use the compiler's own pod definitions via reflection (which</span>
  <span class='z'>** is more efficient).  As a general rule you shouldn't mess</span>
  <span class='z'>** with this field - it is used by the 'build' and 'compiler'</span>
  <span class='z'>** build scripts for bootstrap build.</span>
  <span class='z'>**</span>
  Uri? <span id='dependsDir'>dependsDir</span> := <span class='k'>null</span>

  <span class='z'>**</span>
  <span class='z'>** Directory to write pod file.  By default it goes into</span>
  <span class='z'>** "{Env.cur.workDir}/lib/fan/"</span>
  <span class='z'>**</span>
  Uri <span id='outDir'>outDir</span> := Env.cur.workDir.plus<span class='b'>(</span><span class='u'>`lib/fan/`</span><span class='b'>)</span>.uri

<span class='y'>//////////////////////////////////////////////////////////////////////////</span>
<span class='y'>// Validate</span>
<span class='y'>//////////////////////////////////////////////////////////////////////////</span>

  <span class='k'>private</span> Void <span id='validate'>validate</span><span class='b'>()</span>
  <span class='b'>{</span>
    <span class='k'>if</span> <span class='b'>(</span>podName == <span class='k'>null</span><span class='b'>)</span> <span class='k'>throw</span> fatal<span class='b'>(</span><span class='s'>"Must set BuildPod.podName"</span><span class='b'>)</span>
    <span class='k'>if</span> <span class='b'>(</span>summary == <span class='k'>null</span><span class='b'>)</span> <span class='k'>throw</span> fatal<span class='b'>(</span><span class='s'>"Must set BuildPod.summary"</span><span class='b'>)</span>

    <span class='y'>// boot strap checking</span>
    <span class='k'>if</span> <span class='b'>([</span><span class='s'>"sys"</span>, <span class='s'>"build"</span>, <span class='s'>"compiler"</span>, <span class='s'>"compilerJava"</span><span class='b'>]</span>.contains<span class='b'>(</span>podName<span class='b'>))</span>
    <span class='b'>{</span>
      <span class='k'>if</span> <span class='b'>(</span>Env.cur.homeDir == devHomeDir<span class='b'>)</span>
        <span class='k'>throw</span> fatal<span class='b'>(</span><span class='s'>"Must update 'devHome' for bootstrap build"</span><span class='b'>)</span>
    <span class='b'>}</span>
  <span class='b'>}</span>

<span class='y'>//////////////////////////////////////////////////////////////////////////</span>
<span class='y'>// Compile</span>
<span class='y'>//////////////////////////////////////////////////////////////////////////</span>

  <span class='z'>**</span>
  <span class='z'>** Compile the source into a pod file and all associated</span>
  <span class='z'>** natives.  See `compileFan`, `compileJava`, and `compileDotnet`.</span>
  <span class='z'>**</span>
  @Target <span class='b'>{</span> help = <span class='s'>"Compile to pod file and associated natives"</span> <span class='b'>}</span>
  <span class='k'>virtual</span> Void compile<span class='b'>()</span>
  <span class='b'>{</span>
    validate

    log.info<span class='b'>(</span><span class='s'>"compile [$podName]"</span><span class='b'>)</span>
    log.indent

    compileFan
    compileJava
<span class='y'>// TODO-FACET</span>
<span class='y'>//    compileDotnet</span>
    log.unindent
  <span class='b'>}</span>

<span class='y'>//////////////////////////////////////////////////////////////////////////</span>
<span class='y'>// Compile Fan</span>
<span class='y'>//////////////////////////////////////////////////////////////////////////</span>

  <span class='z'>**</span>
  <span class='z'>** Compile Fan code into pod file</span>
  <span class='z'>**</span>
  <span class='k'>virtual</span> Void <span id='compileFan'>compileFan</span><span class='b'>()</span>
  <span class='b'>{</span>
    <span class='y'>// add my own meta</span>
    meta := <span class='k'>this</span>.meta.dup
    meta<span class='b'>[</span><span class='s'>"pod.docApi"</span><span class='b'>]</span> = docApi.toStr
    meta<span class='b'>[</span><span class='s'>"pod.docSrc"</span><span class='b'>]</span> = docSrc.toStr
    meta<span class='b'>[</span><span class='s'>"pod.native.java"</span><span class='b'>]</span>   = <span class='b'>(</span>javaDirs   != <span class='k'>null</span> &amp;&amp; !javaDirs.isEmpty<span class='b'>)</span>.toStr
    meta<span class='b'>[</span><span class='s'>"pod.native.dotnet"</span><span class='b'>]</span> = <span class='b'>(</span>dotnetDirs != <span class='k'>null</span> &amp;&amp; !dotnetDirs.isEmpty<span class='b'>)</span>.toStr
    meta<span class='b'>[</span><span class='s'>"pod.native.js"</span><span class='b'>]</span>     = <span class='b'>(</span>jsDirs     != <span class='k'>null</span> &amp;&amp; !jsDirs.isEmpty<span class='b'>)</span>.toStr

    <span class='y'>// map my config to CompilerInput structure</span>
    ci := CompilerInput<span class='b'>()</span>
    ci.inputLoc    = Loc.makeFile<span class='b'>(</span>scriptFile<span class='b'>)</span>
    ci.podName     = podName
    ci.summary     = summary
    ci.version     = version
    ci.depends     = depends.map |s-&gt;Depend| <span class='b'>{</span> Depend<span class='b'>(</span>s<span class='b'>)</span> <span class='b'>}</span>
    ci.meta        = meta
    ci.index       = index
    ci.baseDir     = scriptDir
    ci.srcFiles    = srcDirs
    ci.resFiles    = resDirs
    ci.jsFiles     = jsDirs
    ci.log         = log
    ci.includeDoc  = docApi
    ci.mode        = CompilerInputMode.file
    ci.outDir      = outDir.toFile
    ci.output      = CompilerOutputMode.podFile

    <span class='k'>if</span> <span class='b'>(</span>dependsDir != <span class='k'>null</span><span class='b'>)</span>
    <span class='b'>{</span>
      f := dependsDir.toFile
      <span class='k'>if</span> <span class='b'>(</span>!f.exists<span class='b'>)</span> <span class='k'>throw</span> fatal<span class='b'>(</span><span class='s'>"Invalid dependsDir: $f"</span><span class='b'>)</span>
      ci.ns = FPodNamespace<span class='b'>(</span>f<span class='b'>)</span>
    <span class='b'>}</span>

    <span class='k'>try</span>
    <span class='b'>{</span>
      Compiler<span class='b'>(</span>ci<span class='b'>)</span>.compile
    <span class='b'>}</span>
    <span class='k'>catch</span> <span class='b'>(</span>CompilerErr err<span class='b'>)</span>
     <span class='b'>{</span>
      <span class='y'>// all errors should already be logged by Compiler</span>
      <span class='k'>throw</span> FatalBuildErr<span class='b'>()</span>
    <span class='b'>}</span>
    <span class='k'>catch</span> <span class='b'>(</span>Err err<span class='b'>)</span>
    <span class='b'>{</span>
      log.err<span class='b'>(</span><span class='s'>"Internal compiler error"</span><span class='b'>)</span>
      err.trace
      <span class='k'>throw</span> FatalBuildErr.make
    <span class='b'>}</span>
  <span class='b'>}</span>

<span class='y'>//////////////////////////////////////////////////////////////////////////</span>
<span class='y'>// Compile Java</span>
<span class='y'>//////////////////////////////////////////////////////////////////////////</span>

  <span class='z'>**</span>
  <span class='z'>** Compile native Java jar file if podJavaDirs is configured</span>
  <span class='z'>**</span>
  <span class='k'>virtual</span> Void <span id='compileJava'>compileJava</span><span class='b'>()</span>
  <span class='b'>{</span>
    <span class='k'>if</span> <span class='b'>(</span><span class='k'>this</span>.javaDirs == <span class='k'>null</span><span class='b'>)</span> <span class='k'>return</span>
    javaDirs := resolveDirs<span class='b'>(</span><span class='k'>this</span>.javaDirs<span class='b'>)</span>

    log.info<span class='b'>(</span><span class='s'>"javaNative [$podName]"</span><span class='b'>)</span>
    log.indent

    <span class='y'>// env</span>
    jtemp    := scriptDir + <span class='u'>`temp-java/`</span>
    jstub    := jtemp + <span class='s'>"${podName}.jar"</span>.toUri
    jdk      := JdkTask<span class='b'>(</span><span class='k'>this</span><span class='b'>)</span>
    javaExe  := jdk.javaExe
    jarExe   := jdk.jarExe
    libJava  := devHomeDir + <span class='u'>`lib/java/`</span>
    curPod   := devHomeDir + <span class='u'>`lib/fan/${podName}.pod`</span>
    curJar   := devHomeDir + <span class='u'>`lib/java/${podName}.jar`</span>
    depends  := <span class='b'>(</span>Depend<span class='b'>[])</span><span class='k'>this</span>.depends.map |s-&gt;Depend| <span class='b'>{</span> Depend<span class='b'>(</span>s<span class='b'>)</span> <span class='b'>}</span>

    <span class='y'>// if there are no javaDirs we only only stubbing</span>
    stubOnly := javaDirs.isEmpty

    <span class='y'>// start with a clean directory</span>
    Delete<span class='b'>(</span><span class='k'>this</span>, jtemp<span class='b'>)</span>.run
    <span class='k'>if</span> <span class='b'>(</span>!stubOnly<span class='b'>)</span> CreateDir<span class='b'>(</span><span class='k'>this</span>, jtemp<span class='b'>)</span>.run

    <span class='y'>// stub the pods fan classes into Java classfiles</span>
    <span class='y'>// by calling the JStub tool in the jsys runtime</span>
    stubDir := stubOnly ? libJava : jtemp
    Exec<span class='b'>(</span><span class='k'>this</span>, <span class='b'>[</span>javaExe,
                <span class='s'>"-cp"</span>, <span class='b'>(</span>libJava + <span class='u'>`sys.jar`</span><span class='b'>)</span>.osPath,
                <span class='s'>"-Dfan.home=$Env.cur.workDir.osPath"</span>,
                <span class='s'>"fanx.tools.Jstub"</span>,
                <span class='s'>"-d"</span>, stubDir.osPath,
                podName<span class='b'>])</span>.run

    <span class='y'>// if there are no javaDirs we only only stubbing</span>
    <span class='k'>if</span> <span class='b'>(</span>stubOnly<span class='b'>)</span> <span class='k'>return</span>

    <span class='y'>// compile</span>
    javac := CompileJava<span class='b'>(</span><span class='k'>this</span><span class='b'>)</span>
    javac.outDir = jtemp
    javac.cp.add<span class='b'>(</span>jtemp+<span class='s'>"${podName}.jar"</span>.toUri<span class='b'>)</span>
    javac.cpAddExtJars
    depends.each |Depend d| <span class='b'>{</span> javac.cp.add<span class='b'>(</span>libJava+<span class='u'>`${d.name}.jar`</span><span class='b'>)</span> <span class='b'>}</span>
    javac.src = javaDirs
    javac.run

    <span class='y'>// extract stub jar into the temp directory</span>
    Exec<span class='b'>(</span><span class='k'>this</span>, <span class='b'>[</span>jarExe, <span class='s'>"-xf"</span>, jstub.osPath<span class='b'>]</span>, jtemp<span class='b'>)</span>.run

    <span class='y'>// now we can nuke the stub jar (and manifest)</span>
    Delete<span class='b'>(</span><span class='k'>this</span>, jstub<span class='b'>)</span>.run
    Delete<span class='b'>(</span><span class='k'>this</span>, jtemp + <span class='u'>`meta-inf/`</span><span class='b'>)</span>.run

    <span class='y'>// jar everything back up to lib/java/{pod}.jar</span>
    Exec<span class='b'>(</span><span class='k'>this</span>, <span class='b'>[</span>jarExe, <span class='s'>"cf"</span>, curJar.osPath, <span class='s'>"-C"</span>, jtemp.osPath, <span class='s'>"."</span><span class='b'>]</span>, jtemp<span class='b'>)</span>.run

    <span class='y'>// append files to the pod zip (we use java's jar tool)</span>
    Exec<span class='b'>(</span><span class='k'>this</span>, <span class='b'>[</span>jarExe, <span class='s'>"-fu"</span>, curPod.osPath, <span class='s'>"-C"</span>, jtemp.osPath, <span class='s'>"."</span><span class='b'>]</span>, jtemp<span class='b'>)</span>.run

    <span class='y'>// cleanup temp</span>
    Delete<span class='b'>(</span><span class='k'>this</span>, jtemp<span class='b'>)</span>.run

    log.unindent
  <span class='b'>}</span>

<span class='y'>//////////////////////////////////////////////////////////////////////////</span>
<span class='y'>// DotnetNative</span>
<span class='y'>//////////////////////////////////////////////////////////////////////////</span>

  <span class='z'>**</span>
  <span class='z'>** Compile native .NET assembly is podDotnetDirs configured</span>
  <span class='z'>**</span>
  <span class='k'>virtual</span> Void <span id='compileDotnet'>compileDotnet</span><span class='b'>()</span>
  <span class='b'>{</span>
    <span class='k'>if</span> <span class='b'>(</span>dotnetDirs == <span class='k'>null</span><span class='b'>)</span> <span class='k'>return</span>

    <span class='k'>if</span> <span class='b'>(</span>Env.cur.os != <span class='s'>"win32"</span><span class='b'>)</span>
    <span class='b'>{</span>
      log.info<span class='b'>(</span><span class='s'>"dotnetNative skipping [$podName]"</span><span class='b'>)</span>
      <span class='k'>return</span>
    <span class='b'>}</span>

    log.info<span class='b'>(</span><span class='s'>"dotnetNative [$podName]"</span><span class='b'>)</span>
    log.indent

    <span class='y'>// env</span>
    ntemp := scriptDir + <span class='u'>`temp-dotnet/`</span>
    nstub := ntemp + <span class='u'>`${podName}.dll`</span>
    nout  := ntemp + <span class='u'>`${podName}Native_.dll`</span>
    ndirs := resolveDirs<span class='b'>(</span>dotnetDirs<span class='b'>)</span>
    nlibs := <span class='b'>[</span>devHomeDir+<span class='u'>`lib/dotnet/sys.dll`</span>, nstub<span class='b'>]</span>
    nstubExe := devHomeDir + <span class='u'>`bin/nstub`</span>

    <span class='y'>// start with a clean directory</span>
    Delete<span class='b'>(</span><span class='k'>this</span>, ntemp<span class='b'>)</span>.run
    CreateDir<span class='b'>(</span><span class='k'>this</span>, ntemp<span class='b'>)</span>.run

    <span class='y'>// stub the pods fan classes into Java classfiles</span>
    <span class='y'>// by calling the JStub tool in the jsys runtime</span>
    Exec<span class='b'>(</span><span class='k'>this</span>, <span class='b'>[</span>nstubExe.osPath, <span class='s'>"-d"</span>, ntemp.osPath, podName<span class='b'>])</span>.run

    <span class='y'>// compile</span>
    csc := CompileCs<span class='b'>(</span><span class='k'>this</span><span class='b'>)</span>
    csc.output = nout
    csc.targetType = <span class='s'>"library"</span>
    csc.src  = ndirs
    csc.libs = nlibs
    csc.run

    <span class='y'>// append files to the pod zip (we use java's jar tool)</span>
    jdk    := JdkTask<span class='b'>(</span><span class='k'>this</span><span class='b'>)</span>
    jarExe := jdk.jarExe
    curPod := devHomeDir + <span class='u'>`lib/fan/${podName}.pod`</span>
    Exec<span class='b'>(</span><span class='k'>this</span>, <span class='b'>[</span>jarExe, <span class='s'>"-fu"</span>, curPod.osPath, <span class='s'>"-C"</span>, ntemp.osPath,
      <span class='s'>"${podName}Native_.dll"</span>, <span class='s'>"${podName}Native_.pdb"</span><span class='b'>]</span>, ntemp<span class='b'>)</span>.run

    <span class='y'>// cleanup temp</span>
    Delete<span class='b'>(</span><span class='k'>this</span>, ntemp<span class='b'>)</span>.run

    log.unindent
  <span class='b'>}</span>

<span class='y'>//////////////////////////////////////////////////////////////////////////</span>
<span class='y'>// Clean</span>
<span class='y'>//////////////////////////////////////////////////////////////////////////</span>

  <span class='z'>**</span>
  <span class='z'>** Delete all intermediate and target files</span>
  <span class='z'>**</span>
  @Target <span class='b'>{</span> help = <span class='s'>"Delete all intermediate and target files"</span> <span class='b'>}</span>
  <span class='k'>virtual</span> Void clean<span class='b'>()</span>
  <span class='b'>{</span>
    log.info<span class='b'>(</span><span class='s'>"clean [$podName]"</span><span class='b'>)</span>
    log.indent
    Delete<span class='b'>(</span><span class='k'>this</span>, devHomeDir+<span class='u'>`lib/fan/${podName}.pod`</span><span class='b'>)</span>.run
    Delete<span class='b'>(</span><span class='k'>this</span>, devHomeDir+<span class='u'>`lib/java/${podName}.jar`</span><span class='b'>)</span>.run
    Delete<span class='b'>(</span><span class='k'>this</span>, devHomeDir+<span class='u'>`lib/dotnet/${podName}.dll`</span><span class='b'>)</span>.run
    Delete<span class='b'>(</span><span class='k'>this</span>, devHomeDir+<span class='u'>`lib/dotnet/${podName}.pdb`</span><span class='b'>)</span>.run
    Delete<span class='b'>(</span><span class='k'>this</span>, devHomeDir+<span class='u'>`lib/tmp/${podName}.dll`</span><span class='b'>)</span>.run
    Delete<span class='b'>(</span><span class='k'>this</span>, devHomeDir+<span class='u'>`lib/tmp/${podName}.pdb`</span><span class='b'>)</span>.run
    Delete<span class='b'>(</span><span class='k'>this</span>, scriptDir+<span class='u'>`temp-java/`</span><span class='b'>)</span>.run
    Delete<span class='b'>(</span><span class='k'>this</span>, scriptDir+<span class='u'>`temp-dotnet/`</span><span class='b'>)</span>.run
    log.unindent
  <span class='b'>}</span>

<span class='y'>//////////////////////////////////////////////////////////////////////////</span>
<span class='y'>// Doc</span>
<span class='y'>//////////////////////////////////////////////////////////////////////////</span>

  <span class='z'>**</span>
  <span class='z'>** Build the HTML documentation</span>
  <span class='z'>**</span>
  @Target <span class='b'>{</span> help = <span class='s'>"Build the HTML documentation"</span> <span class='b'>}</span>
  <span class='k'>virtual</span> Void doc<span class='b'>()</span>
  <span class='b'>{</span>
    <span class='y'>// use docCompiler reflectively</span>
    docCompiler := Type.find<span class='b'>(</span><span class='s'>"docCompiler::Main"</span><span class='b'>)</span>.make
    docCompiler-&gt;d    = devHomeDir + <span class='u'>`doc/`</span>
    docCompiler-&gt;src  = scriptDir
    docCompiler-&gt;pods = <span class='b'>[</span>podName<span class='b'>]</span>
    Int r := docCompiler-&gt;run
    <span class='k'>if</span> <span class='b'>(</span>r != 0<span class='b'>)</span> fatal<span class='b'>(</span><span class='s'>"Cannot doc compiler '$podName'"</span><span class='b'>)</span>
  <span class='b'>}</span>

<span class='y'>//////////////////////////////////////////////////////////////////////////</span>
<span class='y'>// Test</span>
<span class='y'>//////////////////////////////////////////////////////////////////////////</span>

  <span class='z'>**</span>
  <span class='z'>** Run the unit tests using 'fant' for this pod</span>
  <span class='z'>**</span>
  @Target <span class='b'>{</span> help = <span class='s'>"Run the pod unit tests via fant"</span> <span class='b'>}</span>
  <span class='k'>virtual</span> Void test<span class='b'>()</span>
  <span class='b'>{</span>
    log.info<span class='b'>(</span><span class='s'>"test [$podName]"</span><span class='b'>)</span>
    log.indent

    fant := Exec.exePath<span class='b'>(</span>devHomeDir + <span class='u'>`bin/fant`</span><span class='b'>)</span>
    Exec<span class='b'>(</span><span class='k'>this</span>, <span class='b'>[</span>fant, podName<span class='b'>])</span>.run

    log.unindent
  <span class='b'>}</span>

<span class='y'>//////////////////////////////////////////////////////////////////////////</span>
<span class='y'>// Full</span>
<span class='y'>//////////////////////////////////////////////////////////////////////////</span>

  <span class='z'>**</span>
  <span class='z'>** Run clean, compile, and test</span>
  <span class='z'>**</span>
  @Target <span class='b'>{</span> help = <span class='s'>"Run clean, compile, and test"</span> <span class='b'>}</span>
  <span class='k'>virtual</span> Void full<span class='b'>()</span>
  <span class='b'>{</span>
    clean
    compile
    test
  <span class='b'>}</span>
<span class='b'>}</span></pre>
</div>
</div>
<div class='sidebar'>
<h2>More Info</h2>
<ul class='clean'>
  <li><a href='BuildPod.html'>View Fandoc</a></li>
</ul>
<div class='slots'>
<div class='overview'>
<h2>Slots</h2>
<ul class='clean'>
  <li style='display: block;'><a href='#clean'>clean</a></li>
  <li style='display: block;'><a href='#compile'>compile</a></li>
  <li style='display: block;'><a href='#compileDotnet'>compileDotnet</a></li>
  <li style='display: block;'><a href='#compileFan'>compileFan</a></li>
  <li style='display: block;'><a href='#compileJava'>compileJava</a></li>
  <li style='display: block;'><a href='#depends'>depends</a></li>
  <li style='display: block;'><a href='#dependsDir'>dependsDir</a></li>
  <li style='display: block;'><a href='#doc'>doc</a></li>
  <li style='display: block;'><a href='#docApi'>docApi</a></li>
  <li style='display: block;'><a href='#docSrc'>docSrc</a></li>
  <li style='display: block;'><a href='#dotnetDirs'>dotnetDirs</a></li>
  <li style='display: block;'><a href='#full'>full</a></li>
  <li style='display: block;'><a href='#index'>index</a></li>
  <li style='display: block;'><a href='#javaDirs'>javaDirs</a></li>
  <li style='display: block;'><a href='#jsDirs'>jsDirs</a></li>
  <li style='display: block;'><a href='#meta'>meta</a></li>
  <li style='display: block;'><a href='#outDir'>outDir</a></li>
  <li style='display: block;'><a href='#podName'>podName</a></li>
  <li style='display: block;'><a href='#resDirs'>resDirs</a></li>
  <li style='display: block;'><a href='#srcDirs'>srcDirs</a></li>
  <li style='display: block;'><a href='#summary'>summary</a></li>
  <li style='display: block;'><a href='#test'>test</a></li>
  <li class='hidden' style='display: block;'><a href='#validate'>validate</a></li>
  <li style='display: block;'><a href='#version'>version</a></li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='footer'>
<div>
<p>
build 1.0.56
[11-Nov-2010 Thu 10:08:18AM EST]
</p>
</div>
</div>
</body>
</html>
