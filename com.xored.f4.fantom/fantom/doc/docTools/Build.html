<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns='http://www.w3.org/1999/xhtml'>
<head>
  <title>Build</title>
  <meta http-equiv='Content-Type' content='text/html; charset=UTF-8'/>
  <link rel='stylesheet' type='text/css' href='../doc.css'/>
  <script type='text/javascript' src='../doc.js'></script>
<!--[if lt IE 7]>
<script src='http://ie7-js.googlecode.com/svn/version/2.0(beta3)/IE7.js' type='text/javascript'></script>
<![endif]-->
</head>
<body onload='Login.check();'>
<div class='header'>
<div>
<h1><a href='/'>Fantom</a></h1>
<p id='sidewalkLogin_'>&nbsp;</p>
<form method='get' action='/sidewalk/search/'>
<p>
<input type='text' name='q' size='30' value='Search...' onfocus='if (value=="Search...") value=""' onblur='if (value=="") value="Search..."' />
</p>
</form>
<ul>
<li><a href='/'>Home</a></li>
<li class='active'><a href='../index.html'>Docs</a></li>
<li><a href='/sidewalk/blog/'>Blog</a></li>
<li><a href='/sidewalk/ticket/'>Tickets</a></li>
<li><a href='/sidewalk/topic/'>Discuss</a></li>
</ul></div>
</div>
<div class='subHeader'>
<div>
<ul>
  <li><a href='../index.html'>Doc Home</a></li>
  <li>&gt;</li>
  <li><a href='index.html'>docTools</a></li>
  <li>&gt;</li>
  <li><a href='Build.html'>Build</a></li>
</ul>
</div>
</div>
<div class='content'>
<div>
<div class='fandoc'>
<div class='prevNext'>
<div class='prev'><a href='Fanp.html'><img src='../go-previous.png' alt='prev' /></a> <a href='Fanp.html'>Fanp</a></div>
<div class='next'><a href='Bootstrap.html'>Bootstrap</a> <a href='Bootstrap.html'><img src='../go-next.png' alt='next' /></a></div>
</div>
<h1 class='title'>Build</h1>

<h1 id='overview'>Overview </h1>

<p>Fantom comes bundled with its own standard build engine to promote consistency and make sharing code easy.  Build scripts are normal <a href='Fan.html#scripts'>Fantom scripts</a> which subclass from <code><a href='../build/BuildScript.html'>build::BuildScript</a></code>. Characteristics of build scripts:</p>

<ul>
<li><code>BuildScript</code> base class handles common functions like command line parsing, environment setup, and logging</li>

<li>Subclasses define <em>targets</em> which are things the build script can do such as "compile", "clean", or "test"</li>

<li>Targets are implemented as normal Fantom methods which can execute any procedural code needed using the APIs installed</li>

<li>The <code>build</code> pod provides libraries of <em>tasks</em> which are designed to provide common chunks of functionality which can be composed to define targets</li>

<li>The <code>build</code> pod provides a library of predefined <code>BuildScript</code> classes to handle common scripts - one you will use all the time is <code><a href='../build/BuildPod.html'>BuildPod</a></code> used to build Fantom pods.</li>
</ul>

<p>The build toolkit is designed to provide a consistent way to organize build scripts - it doesn't provide a comprehensive library of everything you might need to perform a build.  But by predefining common scripts such as <code><a href='../build/BuildPod.html'>BuildPod</a></code> it reduces most scripts down to purely declarative information.  When you do need the power of custom code, you can implement it cleanly as normal Fantom code.</p>

<h1 id='example'>Example </h1>

<p>Let's create a build script called "buildtest.fan":</p>

<pre>using build

class Build : BuildScript
{
  @Target { help = "Compile everything" }
  Void compile() { log.info("Compile away!") }

  @Target { help = "Clean it all up" }
  Void clean() { log.info("Clean away!") }
}</pre>

<p>The script above defines two targets: compile and clean.  The targets are annotated with the <code><a href='../build/Target.html'>@Target</a></code> facet. Set the help field to a short summary.  To print the usage of this script use "-?":</p>

<pre>C:\dev\fan\src>buildtest -?
usage:
  build [options] &lt;target>*
options:
  -? -help       Print usage summary
  -v             Verbose debug logging
  -dumpEnv       Debug dump of script env
targets:
  compile*       Compile everything
  clean          Clean it all up</pre>

<p>Note that the "compile" target is marked with an asterisk indicating it is the default target because it is the first one declared. If we invoke the script with no arguments the "compile" target is executed:</p>

<pre>C:\dev\fan\src>buildtest
Compile away!
BUILD SUCCESS [3ms]!</pre>

<p>Or we can pass one or more targets as arguments:</p>

<pre>C:\dev\fan\src>buildtest clean
Clean away!
BUILD SUCCESS [2ms]!

C:\dev\fan\src>buildtest clean compile
Clean away!
Compile away!
BUILD SUCCESS [2ms]!</pre>

<p>Note: see <a href='Setup.html'>Setup</a> to configure your environment to run scripts using just the script filename.</p>

<h1 id='BuildScript'>BuildScript </h1>

<p>The <code><a href='../build/BuildScript.html'>BuildScript</a></code> is the base class for all build scripts.  It provides many useful slots you will find handy:</p>

<ul>
<li><code><a href='../build/BuildScript.html#log'>log</a></code>: standardized logging</li>

<li><code><a href='../build/BuildScript.html#scriptFile'>scriptFile</a></code>: the file of the script itself</li>

<li><code><a href='../build/BuildScript.html#scriptDir'>scriptDir</a></code>: the directory containing the script</li>

<li><code><a href='../build/BuildScript.html#devHomeDir'>devHomeDir</a></code>: home directory of your development Fantom environment</li>
</ul>

<h1 id='lifecycle'>Lifecycle </h1>

<p>A build script lifecycle is composed of these steps:</p>

<ol style='list-style-type:decimal'>
<li>Base class constructor is run and will immediately setup the environment variables such as <code><a href='../build/BuildScript.html#log'>log</a></code> and <code><a href='../build/BuildScript.html#scriptFile'>scriptFile</a></code>.</li>

<li>Your subclass constructor is run, which is where you can configure your own scripts fields.</li>

<li>The <code><a href='../build/BuildScript.html#targets'>targets</a></code> callback is invoked to get the list of targets - most often you will let the default implementation build this list by searching for methods which implement the <code>@Target</code> facet.</li>

<li>Command line parsed to find all the specified targets, if no targets specified then we use the first target from the <code>targets</code> method..</li>

<li>Each target method is invoked in the order specified</li>

<li>If an exception is raised, the script fails and returns -1, otherwise 0 is returned.</li>
</ol>

<p>Problems during the script should be reported via the <code><a href='../build/BuildScript.html#log'>BuildScript.log</a></code>.  If an error is encountered which should terminate the script, then throw a <code><a href='../build/FatalBuildErr.html'>FatalBuildErr</a></code> via this pattern:</p>

<pre>throw fatal("I just can't go on!")</pre>

<h1 id='buildPod'>BuildPod </h1>

<p><code><a href='../build/BuildPod.html'>BuildPod</a></code> is the base class for build scripts which build a Fantom pod.  The <code>BuildPod</code> script defines a bunch of fields to be filled in. Plus it predefines several targets ready to use:</p>

<ul>
<li><code><a href='../build/BuildPod.html#compile'>compile</a></code>: recompiles Fantom code into a pod file along with all associated natives (JavaScript, Java, .NET)</li>

<li><code><a href='../build/BuildPod.html#clean'>clean</a></code>: deletes all the intermediate and derived target files</li>

<li><code><a href='../build/BuildPod.html#doc'>doc</a></code>: compile fandoc to HTML</li>

<li><code><a href='../build/BuildPod.html#test'>test</a></code>: runs all tests declared by the pod</li>

<li><code><a href='../build/BuildPod.html#full'>full</a></code>: clean, compile, test</li>
</ul>

<p>By convention pod source directories are organized as follows:</p>

<pre>foo/
  build.fan
  fan/
    ClassAlpha.fan
    ClassBeta.fan
  java/
    ClassAlphaPeer.java
  js/
    ClassAlphaPeer.js
  dotnet/
    ClassAlphaPeer.cs
  test/
    TestClassAlpha.fan
    TestClassBeta.fan
  res/
    icon.png
    resource-file.txt</pre>

<p>If you don't have tests or native code, then those directories aren't included.  The build script for our directory structure above would look like:</p>

<pre>// build.fan
using build
class Build : BuildPod
{
  new make()
  {
    podName    = "foo"
    summary    = "Description of foo pod.  Foo is good."
    depends    = ["sys 1.0+", "bar 1.1+"]
    srcDirs    = [`fan/`, `test/`]
    javaDirs   = [`java/`]
    jsDirs     = [`js/`]
    dotnetDirs = [`dotnet/`]
    resDirs    = [`res/`]
  }
}</pre>

<p>Note that all the directories are specified as Uris relative to the script directory.  If you don't have native code, you can omit the <code>javaDirs</code>, <code>dotnetDirs</code>, and <code>jsDirs</code> settings. If you don't have resource files you can omit <code>resDirs</code>.  See <a href='../docIntro/HelloWorld.html#pod'>HelloWorld</a> for a simpler example.</p>

<p>Typically the pod's version is set by the build script's <code><a href='../build/BuildPod.html#version'>version</a></code> field.  By default this is set to the config property <code>buildVersion</code> configured in "etc/build/config.props".</p>
<div class='prevNext'>
<div class='prev'><a href='Fanp.html'><img src='../go-previous.png' alt='prev' /></a> <a href='Fanp.html'>Fanp</a></div>
<div class='next'><a href='Bootstrap.html'>Bootstrap</a> <a href='Bootstrap.html'><img src='../go-next.png' alt='next' /></a></div>
</div>
</div>
<div class='sidebar'>
<h2>Contents</h2>
<ul>
<li><a href='#overview'>Overview </a></li><li><a href='#example'>Example </a></li><li><a href='#BuildScript'>BuildScript </a></li><li><a href='#lifecycle'>Lifecycle </a></li><li><a href='#buildPod'>BuildPod </a></li></ul>
</div>
</div>
</div>
<div class='footer'>
<div>
<p>
docTools 1.0.56
[11-Nov-2010 Thu 10:08:29AM EST]
</p>
</div>
</div>
</body>
</html>
