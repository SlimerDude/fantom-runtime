<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns='http://www.w3.org/1999/xhtml'>
<head>
  <title>webmod PodDoc</title>
  <meta http-equiv='Content-Type' content='text/html; charset=UTF-8'/>
  <link rel='stylesheet' type='text/css' href='../doc.css'/>
  <script type='text/javascript' src='../doc.js'></script>
<!--[if lt IE 7]>
<script src='http://ie7-js.googlecode.com/svn/version/2.0(beta3)/IE7.js' type='text/javascript'></script>
<![endif]-->
</head>
<body onload='Login.check();'>
<div class='header'>
<div>
<h1><a href='/'>Fantom</a></h1>
<p id='sidewalkLogin_'>&nbsp;</p>
<form method='get' action='/sidewalk/search/'>
<p>
<input type='text' name='q' size='30' value='Search...' onfocus='if (value=="Search...") value=""' onblur='if (value=="") value="Search..."' />
</p>
</form>
<ul>
<li><a href='/'>Home</a></li>
<li class='active'><a href='../index.html'>Docs</a></li>
<li><a href='/sidewalk/blog/'>Blog</a></li>
<li><a href='/sidewalk/ticket/'>Tickets</a></li>
<li><a href='/sidewalk/topic/'>Discuss</a></li>
</ul></div>
</div>
<div class='subHeader'>
<div>
<ul>
  <li><a href='../index.html'>Doc Home</a></li>
  <li>&gt;</li>
  <li><a href='index.html'>webmod</a></li>
  <li>&gt;</li>
  <li><a href='pod-doc.html'>webmod PodDoc</a></li>
</ul>
</div>
</div>
<div class='content'>
<div>
<div class='fandoc'>
<div class='type'>
 <div class='overview'>
  <h2>pod</h2>
  <h1>webmod</h1>
 </div>
</div>

<h1 id='overview'>Overview </h1>

<p>The <a href='index.html'>webmod</a> pod defines a library for web modules which may be composed together:</p>

<ul>
<li><a href='#file'>FileMod</a>: publish static files</li>

<li><a href='#route'>RouteMap</a>: route to a sub-module based on a URI path name</li>

<li><a href='#pipeline'>PipelineMod</a>: run through a serial list of sub-modules</li>

<li><a href='#log'>LogMod</a>: logs using W3C extended log format</li>
</ul>

<h1 id='file'>FileMod </h1>

<p><code><a href='FileMod.html'>FileMod</a></code> is a simple way to publish static files under a base URI.  FileMod may be used with a single file or with a directory.  If using FileMod with a directory, then any request which maps to a directory which does not end in slash is redirected to include a trailing slash.  Requests to directories are mapped to "index.html" in that directory.</p>

<p>Let's assume we have the following file structure:</p>

<pre>pub/
  index.html
  alpha.html
  icon.png
  foo/
    index.html
    beta.html</pre>

<p>Let's assume this top level route mapping:</p>

<pre>RouteMod
{
  routes =
  [
    "favicon.ico": `pub/icon.png`,
    "stuff":       `pub/`
  ]
}</pre>

<p>Single file modules map directly to the file:</p>

<pre>/favicon.ico     =>  pub/icon.png
/favicon.ico?q   =>  pub/icon.png  // queries ignored
/favicon.ico/foo =>  404           // deeper paths return 404</pre>

<p>Directories map files based on <code><a href='../web/WebReq.html#modRel'>WebReq.modRel</a></code>:</p>

<pre>/stuff                =>  redirect /stuff/
/stuff/               =>  /stuff/index.html
/stuff/index.html     =>  /stuff/index.html
/stuff/alpha.html     =>  /stuff/alpha.html
/stuff/foo            =>  redirect /stuff/foo/
/stuff/foo/           =>  /stuff/foo/index.html
/stuff/foo/beta.html  =>  /stuff/foo/beta.html</pre>

<h1 id='route'>RouteMod </h1>

<p><code><a href='RouteMod.html'>RouteMod</a></code> is a composition module used to route path names in a URI to sub-modules.  RouteMod maps the first path name in <code><a href='../web/WebReq.html#modRel'>WebReq.modRel</a></code> to a sub module via the <code>routes</code> map.  If <code>modRel</code> is the empty path, then RouteMod will route to the name "index".</p>

<p>Example configuration with nested routes:</p>

<pre>root =  RouteMod
{
  routes =
  [
    "index": top,
    "foo":   foo,
    "bar":   RouteMod
    {
      routes =
      [
        "index": bar,
        "alpha": alpha,
      ]
    }
  ]
}</pre>

<p>Request uri to module mappings:</p>

<pre>/             =>  top
/index/       =>  top
/index/x      =>  top
/foo          =>  foo
/foo/index    =>  foo
/foo/a/b      =>  foo
/bar          =>  bar
/bar/         =>  bar
/bar/alpha    =>  alpha
/bar/alpha/x  =>  alpha</pre>

<h1 id='pipeline'>PipelineMod </h1>

<p><code><a href='PipelineMod.html'>PipelineMod</a></code> is a composition module used to run a request through a series of sub-modules.  The lifecycle of a PipelineMod request:</p>

<ol style='list-style-type:decimal'>
<li>Call each module in <code>before</code></li>

<li>Call each module in <code>steps</code> as long as <code>WebRes.isDone</code> returns false</li>

<li>Call each module in <code>after</code></li>
</ol>

<p>The before, steps, and after lists are processed in their declaration order. Every module declared in before and after is called for every request regardless of the <code>WebRes.isDone</code> state.  But the modules declared steps are only processed as long as <code>WebRes.isDone</code> is false.</p>

<h1 id='log'>LogMod </h1>

<p><code><a href='LogMod.html'>LogMod</a></code> class is used to generate a server log file for all HTTP requests in the <a href='http://www.w3.org/TR/WD-logfile.html'>W3C Extended Log File Format</a>.  Logging is best done a step in the <code>WebPipleine.after</code>.  See <code><a href='../util/FileLogger.html'>util::FileLogger</a></code> to configure datetime patterns for your log files.</p>

<p>The <code>fields</code> property configures the format of the log records. It is a string of field names separated by a space.  The following field names are supported:</p>

<ul>
<li><strong>date</strong>: UTC date as DD-MM-YYYY</li>

<li><strong>time</strong>: UTC time as hh:mm:ss</li>

<li><strong>c-ip</strong>: the numeric IP address of the remote client socket</li>

<li><strong>c-port</strong>: the IP port of the remote client socket</li>

<li><strong>cs-method</strong>: the request method such as GET</li>

<li><strong>cs-uri</strong>: the encoded request uri (path and query)</li>

<li><strong>cs-uri-stem</strong>: the encoded path of the request uri</li>

<li><strong>cs-uri-query</strong>: the encoded query of the request uri</li>

<li><strong>sc-status</strong>: the return status code</li>

<li><strong>time-taken</strong>: the time taken to process request in milliseconds</li>

<li><strong>cs(HeaderName)</strong>: request header value such <code>User-Agent</code></li>
</ul>

<p>If any unknown fields are specified or not available then "-" is logged. The default format is:</p>

<pre>date time c-ip cs-method cs-uri-stem cs-uri-query
  sc-status time-taken cs(User-Agent) cs(Referer)</pre>

<p>Example log record with this format:</p>

<pre>18-04-2008 01:42:54 127.0.0.1 GET / - 304 1 "Mozilla/5.0 (Windows; U;
  Windows NT 5.1; en-US; rv:1.8.1.13) Gecko/20080311 Firefox/2.0.0.13"
  "http://localhost:8080/dir/index.html"</pre>
</div>
<div class='sidebar'>
<h2>Contents</h2>
<ul>
<li><a href='#overview'>Overview </a></li><li><a href='#file'>FileMod </a></li><li><a href='#route'>RouteMod </a></li><li><a href='#pipeline'>PipelineMod </a></li><li><a href='#log'>LogMod </a></li></ul>
</div>
</div>
</div>
<div class='footer'>
<div>
<p>
webmod 1.0.56
[11-Nov-2010 Thu 10:08:21AM EST]
</p>
</div>
</div>
</body>
</html>
