<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns='http://www.w3.org/1999/xhtml'>
<head>
  <title>sys::Env</title>
  <meta http-equiv='Content-Type' content='text/html; charset=UTF-8'/>
  <link rel='stylesheet' type='text/css' href='../doc.css'/>
  <script type='text/javascript' src='../doc.js'></script>
<!--[if lt IE 7]>
<script src='http://ie7-js.googlecode.com/svn/version/2.0(beta3)/IE7.js' type='text/javascript'></script>
<![endif]-->
</head>
<body onload='Login.check();'>
<div class='header'>
<div>
<h1><a href='/'>Fantom</a></h1>
<p id='sidewalkLogin_'>&nbsp;</p>
<form method='get' action='/sidewalk/search/'>
<p>
<input type='text' name='q' size='30' value='Search...' onfocus='if (value=="Search...") value=""' onblur='if (value=="") value="Search..."' />
</p>
</form>
<ul>
<li><a href='/'>Home</a></li>
<li class='active'><a href='../index.html'>Docs</a></li>
<li><a href='/sidewalk/blog/'>Blog</a></li>
<li><a href='/sidewalk/ticket/'>Tickets</a></li>
<li><a href='/sidewalk/topic/'>Discuss</a></li>
</ul></div>
</div>
<div class='subHeader'>
<div>
<ul>
  <li><a href='../index.html'>Doc Home</a></li>
  <li>&gt;</li>
  <li><a href='index.html'>sys</a></li>
  <li>&gt;</li>
  <li><a href='Env.html'>Env</a></li>
</ul>
</div>
</div>
<div class='content'>
<div>
<div class='fandoc'>
<div class='type'>
<div class='overview'>
<h2>abstract const class</h2>
<h1>sys::Env</h1>
<pre><a href='Obj.html'>sys::Obj</a>
  sys::Env</pre>
</div>
</div>
<div class='src'>
<pre>
<span class='y'>//</span>
<span class='y'>// Copyright (c) 2006, Brian Frank and Andy Frank</span>
<span class='y'>// Licensed under the Academic Free License version 3.0</span>
<span class='y'>//</span>
<span class='y'>// History:</span>
<span class='y'>//    9 Jan 06  Brian Frank  Creation</span>
<span class='y'>//   27 Jan 10  Brian Frank  Rename Sys to Env</span>
<span class='y'>//</span>

<span class='z'>**</span>
<span class='z'>** Env defines a pluggable class used boot and manage a Fantom</span>
<span class='z'>** runtime environment.</span>
<span class='z'>**</span>
<span class='k'>abstract</span> <span class='k'>const</span> <span class='k'>class</span> Env
<span class='b'>{</span>

<span class='y'>//////////////////////////////////////////////////////////////////////////</span>
<span class='y'>// Construction</span>
<span class='y'>//////////////////////////////////////////////////////////////////////////</span>

  <span class='z'>**</span>
  <span class='z'>** Get the current runtime environment</span>
  <span class='z'>**</span>
  <span class='k'>static</span> Env <span id='cur'>cur</span><span class='b'>()</span>

  <span class='z'>**</span>
  <span class='z'>** Subclasses are constructed from a parent environment.</span>
  <span class='z'>**</span>
  <span class='k'>protected</span> <span class='k'>new</span> <span id='make'>make</span><span class='b'>(</span>Env parent := Env.cur<span class='b'>)</span>

<span class='y'>//////////////////////////////////////////////////////////////////////////</span>
<span class='y'>// Non-Virtuals</span>
<span class='y'>//////////////////////////////////////////////////////////////////////////</span>

  <span class='z'>**</span>
  <span class='z'>** Get the parent environment or null if this is the bootstrap</span>
  <span class='z'>** environment.  Many virtual methods delegate to their parent by</span>
  <span class='z'>** default.</span>
  <span class='z'>**</span>
  Env? <span id='parent'>parent</span><span class='b'>()</span>

  <span class='z'>**</span>
  <span class='z'>** Name of the host platform as a string formatted</span>
  <span class='z'>** as "&lt;os&gt;-&lt;arch&gt;".  See `os` and `arch`.</span>
  <span class='z'>**</span>
  Str <span id='platform'>platform</span><span class='b'>()</span>

  <span class='z'>**</span>
  <span class='z'>** Operating system name as one of the following constants:</span>
  <span class='z'>**   - "win32"</span>
  <span class='z'>**   - "macosx"</span>
  <span class='z'>**   - "linux"</span>
  <span class='z'>**   - "aix"</span>
  <span class='z'>**   - "solaris"</span>
  <span class='z'>**   - "hpux"</span>
  <span class='z'>**   - "qnx"</span>
  <span class='z'>**</span>
  Str <span id='os'>os</span><span class='b'>()</span>

  <span class='z'>**</span>
  <span class='z'>** Microprocessor architecture name as one of the following constants:</span>
  <span class='z'>**   - "x86"</span>
  <span class='z'>**   - "x86_64"</span>
  <span class='z'>**   - "ppc"</span>
  <span class='z'>**   - "sparc"</span>
  <span class='z'>**   - "ia64"</span>
  <span class='z'>**   - "ia64_32"</span>
  <span class='z'>**</span>
  Str <span id='arch'>arch</span><span class='b'>()</span>

  <span class='z'>**</span>
  <span class='z'>** Virtual machine runtime as one of the following constants:</span>
  <span class='z'>**   - "java"</span>
  <span class='z'>**   - "dotnet"</span>
  <span class='z'>**   - "js"</span>
  <span class='z'>**</span>
  Str <span id='runtime'>runtime</span><span class='b'>()</span>

  <span class='z'>**</span>
  <span class='z'>** Return the default hash code of `Obj.hash` for the</span>
  <span class='z'>** specified object regardless of whether the object</span>
  <span class='z'>** has overridden the 'hash' method.  If null then</span>
  <span class='z'>** return 0.</span>
  <span class='z'>**</span>
  Int <span id='idHash'>idHash</span><span class='b'>(</span>Obj? obj<span class='b'>)</span>

<span class='y'>//////////////////////////////////////////////////////////////////////////</span>
<span class='y'>// Virtuals</span>
<span class='y'>//////////////////////////////////////////////////////////////////////////</span>

  <span class='z'>**</span>
  <span class='z'>** Get the command line arguments used to run the fan process</span>
  <span class='z'>** as an immutable List of strings.  Default implementation</span>
  <span class='z'>** delegates to `parent`.</span>
  <span class='z'>**</span>
  <span class='k'>virtual</span> Str<span class='b'>[]</span> <span id='args'>args</span><span class='b'>()</span>

  <span class='z'>**</span>
  <span class='z'>** Get the environment variables as a case insensitive, immutable</span>
  <span class='z'>** map of Str name/value pairs.  The environment map is initialized</span>
  <span class='z'>** from the following sources from lowest priority to highest priority:</span>
  <span class='z'>**   1. shell environment variables</span>
  <span class='z'>**   2. Java system properties (Java VM only obviously)</span>
  <span class='z'>**</span>
  <span class='z'>** Default implementation delegates to `parent`.</span>
  <span class='z'>**</span>
  <span class='k'>virtual</span> Str:Str <span id='vars'>vars</span><span class='b'>()</span>

  <span class='z'>**</span>
  <span class='z'>** Poll for a platform dependent map of diagnostics name/value</span>
  <span class='z'>** pairs for the current state of the VM.  Java platforms return</span>
  <span class='z'>** key values from the 'java.lang.management' interface.</span>
  <span class='z'>** Default implementation delegates to `parent`.</span>
  <span class='z'>**</span>
  <span class='k'>virtual</span> Str:Obj <span id='diagnostics'>diagnostics</span><span class='b'>()</span>

  <span class='z'>**</span>
  <span class='z'>** Run the garbage collector.  No guarantee is made</span>
  <span class='z'>** to what the VM will actually do.  Default implementation</span>
  <span class='z'>** delegates to `parent`.</span>
  <span class='z'>**</span>
  <span class='k'>virtual</span> Void <span id='gc'>gc</span><span class='b'>()</span>

  <span class='z'>**</span>
  <span class='z'>** Get the local host name of the machine running the</span>
  <span class='z'>** virtual machine process.  Default implementation</span>
  <span class='z'>** delegates to `parent`.</span>
  <span class='z'>**</span>
  <span class='k'>virtual</span> Str <span id='host'>host</span><span class='b'>()</span>

  <span class='z'>**</span>
  <span class='z'>** Get the user name of the user account used to run the</span>
  <span class='z'>** virtual machine process.  Default implementation</span>
  <span class='z'>** delegates to `parent`.</span>
  <span class='z'>**</span>
  <span class='k'>virtual</span> Str <span id='user'>user</span><span class='b'>()</span>

  <span class='z'>**</span>
  <span class='z'>** Terminate the current virtual machine.</span>
  <span class='z'>** Default implementation delegates to `parent`.</span>
  <span class='z'>**</span>
  <span class='k'>virtual</span> Void <span id='exit'>exit</span><span class='b'>(</span>Int status := 0<span class='b'>)</span>

  <span class='z'>**</span>
  <span class='z'>** Standard input stream.</span>
  <span class='z'>** Default implementation delegates to `parent`.</span>
  <span class='z'>**</span>
  <span class='k'>virtual</span> InStream <span id='in'>in</span><span class='b'>()</span>

  <span class='z'>**</span>
  <span class='z'>** Standard output stream.</span>
  <span class='z'>** Default implementation delegates to `parent`.</span>
  <span class='z'>**</span>
  <span class='k'>virtual</span> OutStream <span id='out'>out</span><span class='b'>()</span>

  <span class='z'>**</span>
  <span class='z'>** Standard error output stream.</span>
  <span class='z'>** Default implementation delegates to `parent`.</span>
  <span class='z'>**</span>
  <span class='k'>virtual</span> OutStream <span id='err'>err</span><span class='b'>()</span>

  <span class='z'>**</span>
  <span class='z'>** Get the home directory of Fantom installation.</span>
  <span class='z'>** Default implementation delegates to `parent`.</span>
  <span class='z'>**</span>
  <span class='k'>virtual</span> File <span id='homeDir'>homeDir</span><span class='b'>()</span>

  <span class='z'>**</span>
  <span class='z'>** Get the working directory to use for saving compiled</span>
  <span class='z'>** pods and configuration information.  Default implementation</span>
  <span class='z'>** delegates to `parent`.</span>
  <span class='z'>**</span>
  <span class='k'>virtual</span> File <span id='workDir'>workDir</span><span class='b'>()</span>

  <span class='z'>**</span>
  <span class='z'>** Get the temp directory to use for scratch files.</span>
  <span class='z'>** Default implementation delegates to `parent`.</span>
  <span class='z'>**</span>
  <span class='k'>virtual</span> File <span id='tempDir'>tempDir</span><span class='b'>()</span>

<span class='y'>//////////////////////////////////////////////////////////////////////////</span>
<span class='y'>// Resolution</span>
<span class='y'>//////////////////////////////////////////////////////////////////////////</span>

  <span class='z'>**</span>
  <span class='z'>** Find a file in the environment using a relative path such</span>
  <span class='z'>** as "etc/foo/config.props".  If the URI is not relative then</span>
  <span class='z'>** throw ArgErr.  If the file is not found in the environment</span>
  <span class='z'>** then throw UnresolvedErr or return null based on checked flag.  If</span>
  <span class='z'>** `findAllFiles` would return multiple matches, then this method</span>
  <span class='z'>** should always return the file with the highest priority.</span>
  <span class='z'>** Default implementation delegates to `parent`.</span>
  <span class='z'>**</span>
  <span class='k'>virtual</span> File? <span id='findFile'>findFile</span><span class='b'>(</span>Uri uri, Bool checked := <span class='k'>true</span><span class='b'>)</span>

  <span class='z'>**</span>
  <span class='z'>** Find all the files in the environment which match a relative</span>
  <span class='z'>** path such as "etc/foo/config.props".  It is possible to have</span>
  <span class='z'>** multiple matches if the environment uses a search path model.</span>
  <span class='z'>** If the list contains more than one item, then the first file</span>
  <span class='z'>** has the highest priority and the last item has the lowest</span>
  <span class='z'>** priority.  If the URI is not relative then throw ArgErr.</span>
  <span class='z'>** Return empty list if the file is not found in environment.</span>
  <span class='z'>** Default implementation delegates to `parent`.</span>
  <span class='z'>**</span>
  <span class='k'>virtual</span> File<span class='b'>[]</span> <span id='findAllFiles'>findAllFiles</span><span class='b'>(</span>Uri uri<span class='b'>)</span>

  <span class='z'>**</span>
  <span class='z'>** Resolve the pod file for the given pod name.  If the</span>
  <span class='z'>** name cannot be resovled to a pod, return null.  The</span>
  <span class='z'>** default implementation routes to `findFile` to look</span>
  <span class='z'>** in "lib/etc" directory.</span>
  <span class='z'>**</span>
  <span class='k'>virtual</span> File? <span id='findPodFile'>findPodFile</span><span class='b'>(</span>Str podName<span class='b'>)</span>

  <span class='z'>**</span>
  <span class='z'>** Return the list of pod names for all the pods currently installed</span>
  <span class='z'>** in this environemnt.  This method is used by `Pod.list` and for</span>
  <span class='z'>** constructing the type database.  Each of these names must be</span>
  <span class='z'>** resolvable by `findPodFile`.  The default implementation routes</span>
  <span class='z'>** to `findFile` to look in the "lib/etc" directory and assumes a</span>
  <span class='z'>** naming convention of "{name}.pod".</span>
  <span class='z'>**</span>
  <span class='k'>virtual</span> Str<span class='b'>[]</span> <span id='findAllPodNames'>findAllPodNames</span><span class='b'>()</span>

<span class='y'>//////////////////////////////////////////////////////////////////////////</span>
<span class='y'>// State</span>
<span class='y'>//////////////////////////////////////////////////////////////////////////</span>

  <span class='z'>**</span>
  <span class='z'>** Compile a script file into a pod and return the first</span>
  <span class='z'>** public type declared in the script file.  If the file</span>
  <span class='z'>** has been previously compiled and hasn't changed, then a</span>
  <span class='z'>** cached type is returned.  If the script contains errors</span>
  <span class='z'>** then the first CompilerErr found is thrown.  The options</span>
  <span class='z'>** available:</span>
  <span class='z'>**   - logLevel: the default `LogLevel` to use for logging</span>
  <span class='z'>**     the compilation process and errors</span>
  <span class='z'>**   - log: the `compiler::CompilerLog` to use for</span>
  <span class='z'>**     logging the compilation process and errors</span>
  <span class='z'>**   - logOut: an output stream to capture logging</span>
  <span class='z'>**   - force: pass 'true' to not use caching, always forces</span>
  <span class='z'>**     a recompile</span>
  <span class='z'>**</span>
  <span class='k'>virtual</span> Type <span id='compileScript'>compileScript</span><span class='b'>(</span>File f, <span class='b'>[</span>Str:Obj<span class='b'>]</span>? options := <span class='k'>null</span><span class='b'>)</span>

  <span class='z'>**</span>
  <span class='z'>** Lookup all the matching values for a pod indexed key.  If no</span>
  <span class='z'>** matches are found return the empty list.  Indexed props are</span>
  <span class='z'>** declared in your pod's build script, and coalesced into a master</span>
  <span class='z'>** index by the current environment.  See [docLang]`docLang::Env#index`</span>
  <span class='z'>** for details.</span>
  <span class='z'>**</span>
  <span class='k'>virtual</span> Str<span class='b'>[]</span> <span id='index'>index</span><span class='b'>(</span>Str key<span class='b'>)</span>

  <span class='z'>**</span>
  <span class='z'>** Return a merged key/value map of all the prop files found</span>
  <span class='z'>** using the following resolution rules:</span>
  <span class='z'>**   1. `Env.findAllFiles`: "etc/{pod}/{uri}"</span>
  <span class='z'>**   2. `Pod.files`: "/{uri}"</span>
  <span class='z'>**</span>
  <span class='z'>** The uri must be relative.</span>
  <span class='z'>**</span>
  <span class='z'>** The files are parsed using `InStream.readProps` and merged according</span>
  <span class='z'>** to their priority order.  If the file is defined as a resource in</span>
  <span class='z'>** the pod itself, then it is treated as lowest priority.  The first</span>
  <span class='z'>** file returned by 'findAllFiles' is treated as highest priority and</span>
  <span class='z'>** overwrites any key-value pairs defined at a lower priority.</span>
  <span class='z'>**</span>
  <span class='z'>** The map is cached so that subsequent calls for the same path</span>
  <span class='z'>** doesn't require accessing the file system again.  The 'maxAge'</span>
  <span class='z'>** parameter specifies the tolerance accepted before a cache</span>
  <span class='z'>** refresh is performed to check if any of the files have been</span>
  <span class='z'>** modified.</span>
  <span class='z'>**</span>
  <span class='z'>** Also see `Pod.props` and `docLang::Env`.</span>
  <span class='z'>**</span>
  <span class='k'>virtual</span> Str:Str <span id='props'>props</span><span class='b'>(</span>Pod pod, Uri uri, Duration maxAge<span class='b'>)</span>

  <span class='z'>**</span>
  <span class='z'>** Lookup a configuration property for given pod/key pair.</span>
  <span class='z'>** If not found then return 'def'.  Default implementation</span>
  <span class='z'>** routes to `props` using max age of one minute:</span>
  <span class='z'>**</span>
  <span class='z'>**   props(pod, `config.props`, 1min).get(key, def)</span>
  <span class='z'>**</span>
  <span class='z'>** Also see `Pod.config` and `docLang::Env`.</span>
  <span class='z'>**</span>
  <span class='k'>virtual</span> Str? <span id='config'>config</span><span class='b'>(</span>Pod pod, Str key, Str? def := <span class='k'>null</span><span class='b'>)</span>

  <span class='z'>**</span>
  <span class='z'>** Lookup a localized property for the specified pod/key pair.</span>
  <span class='z'>** The following rules are used for resolution:</span>
  <span class='z'>**   1. 'props(pod, `locale/{locale}.props`)'</span>
  <span class='z'>**   2. 'props(pod, `locale/{lang}.props`)'</span>
  <span class='z'>**   3. 'props(pod, `locale/en.props`)'</span>
  <span class='z'>**   4. Fallback to 'pod::key' unless 'def' specified</span>
  <span class='z'>**</span>
  <span class='z'>** Where '{locale}' is `Locale.toStr` and '{lang}' is `Locale.lang`.</span>
  <span class='z'>**</span>
  <span class='z'>** Also see `Pod.locale` and `docLang::Localization`.</span>
  <span class='z'>**</span>
  <span class='k'>virtual</span> Str? <span id='locale'>locale</span><span class='b'>(</span>Pod pod, Str key, Str? def := <span class='s'>"pod::key"</span>, Locale locale := Locale.cur<span class='b'>)</span>

<span class='b'>}</span>

<span class='z'>**************************************************************************</span>
<span class='z'>** Env Implementations</span>
<span class='z'>**************************************************************************</span>

<span class='k'>internal</span> <span class='k'>const</span> <span class='k'>class</span> BootEnv : Env <span class='b'>{}</span>
<span class='k'>internal</span> <span class='k'>const</span> <span class='k'>class</span> JarDistEnv : Env <span class='b'>{}</span> <span class='y'>// JVM only</span>

</pre>
</div>
</div>
<div class='sidebar'>
<h2>More Info</h2>
<ul class='clean'>
  <li><a href='Env.html'>View Fandoc</a></li>
</ul>
<div class='slots'>
<div class='overview'>
<h2>Slots</h2>
<ul class='clean'>
  <li style='display: block;'><a href='#arch'>arch</a></li>
  <li style='display: block;'><a href='#args'>args</a></li>
  <li style='display: block;'><a href='#compileScript'>compileScript</a></li>
  <li style='display: block;'><a href='#config'>config</a></li>
  <li style='display: block;'><a href='#cur'>cur</a></li>
  <li style='display: block;'><a href='#diagnostics'>diagnostics</a></li>
  <li style='display: block;'><a href='#err'>err</a></li>
  <li style='display: block;'><a href='#exit'>exit</a></li>
  <li style='display: block;'><a href='#findAllFiles'>findAllFiles</a></li>
  <li style='display: block;'><a href='#findAllPodNames'>findAllPodNames</a></li>
  <li style='display: block;'><a href='#findFile'>findFile</a></li>
  <li style='display: block;'><a href='#findPodFile'>findPodFile</a></li>
  <li style='display: block;'><a href='#gc'>gc</a></li>
  <li style='display: block;'><a href='#homeDir'>homeDir</a></li>
  <li style='display: block;'><a href='#host'>host</a></li>
  <li style='display: block;'><a href='#idHash'>idHash</a></li>
  <li style='display: block;'><a href='#in'>in</a></li>
  <li style='display: block;'><a href='#index'>index</a></li>
  <li style='display: block;'><a href='#locale'>locale</a></li>
  <li style='display: block;'><a href='#make'>make</a></li>
  <li style='display: block;'><a href='#os'>os</a></li>
  <li style='display: block;'><a href='#out'>out</a></li>
  <li style='display: block;'><a href='#parent'>parent</a></li>
  <li style='display: block;'><a href='#platform'>platform</a></li>
  <li style='display: block;'><a href='#props'>props</a></li>
  <li style='display: block;'><a href='#runtime'>runtime</a></li>
  <li style='display: block;'><a href='#tempDir'>tempDir</a></li>
  <li style='display: block;'><a href='#user'>user</a></li>
  <li style='display: block;'><a href='#vars'>vars</a></li>
  <li style='display: block;'><a href='#workDir'>workDir</a></li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='footer'>
<div>
<p>
sys 1.0.56
[11-Nov-2010 Thu 10:08:16AM EST]
</p>
</div>
</div>
</body>
</html>
