<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns='http://www.w3.org/1999/xhtml'>
<head>
  <title>flux PodDoc</title>
  <meta http-equiv='Content-Type' content='text/html; charset=UTF-8'/>
  <link rel='stylesheet' type='text/css' href='../doc.css'/>
  <script type='text/javascript' src='../doc.js'></script>
<!--[if lt IE 7]>
<script src='http://ie7-js.googlecode.com/svn/version/2.0(beta3)/IE7.js' type='text/javascript'></script>
<![endif]-->
</head>
<body onload='Login.check();'>
<div class='header'>
<div>
<h1><a href='/'>Fantom</a></h1>
<p id='sidewalkLogin_'>&nbsp;</p>
<form method='get' action='/sidewalk/search/'>
<p>
<input type='text' name='q' size='30' value='Search...' onfocus='if (value=="Search...") value=""' onblur='if (value=="") value="Search..."' />
</p>
</form>
<ul>
<li><a href='/'>Home</a></li>
<li class='active'><a href='../index.html'>Docs</a></li>
<li><a href='/sidewalk/blog/'>Blog</a></li>
<li><a href='/sidewalk/ticket/'>Tickets</a></li>
<li><a href='/sidewalk/topic/'>Discuss</a></li>
</ul></div>
</div>
<div class='subHeader'>
<div>
<ul>
  <li><a href='../index.html'>Doc Home</a></li>
  <li>&gt;</li>
  <li><a href='index.html'>flux</a></li>
  <li>&gt;</li>
  <li><a href='pod-doc.html'>flux PodDoc</a></li>
</ul>
</div>
</div>
<div class='content'>
<div>
<div class='fandoc'>
<div class='type'>
 <div class='overview'>
  <h2>pod</h2>
  <h1>flux</h1>
 </div>
</div>

<h1 id='overview'>Overview </h1>

<p>Flux is a framework for building general purpose desktop applications with the <a href='../fwt/pod-doc.html'>fwt</a> toolkit.  This chapter covers how to use the flux APIs for creating new applications and plugins. See <a href='../docTools/Flux.html'>docTools</a> for how to setup and use flux as an IDE.</p>

<p>Flux is based on a browser navigation model.  Users navigate Uris which are resolved to <em>resources</em>.  Users interact with resources through <em>views</em> which are used to view and edit the resources. The next sections cover <em>resources</em> and <em>views</em> in detail.</p>

<p>The Flux chrome works very much like a traditional browser.  It handles navigation, history, and view tabs.  It provides a plugin model for adding sidebars which are used independently of views.</p>

<h1 id='resources'>Resources </h1>

<p>Resources are the objects a user browses, views, and edits in a flux application.  Resources are modeled by the <code><a href='Resource.html'>flux::Resource</a></code> class. The <code>Resource</code> class typically wraps some other Fantom object to define how it is presented in the user interface such as its name, icon, the available views, and children if tree structured.</p>

<p>The most common resource is <code><a href='FileResource.html'>FileResource</a></code> which is used to wrap a <code><a href='../sys/File.html'>sys::File</a></code> instance.  FileResource uses MIME type to map files to their icon and available views.</p>

<h1 id='views'>Views </h1>

<p>Views are user interface components which subclass from <code><a href='../fwt/ContentPane.html'>fwt::ContentPane</a></code>. A view is how a user interacts with a resource for visualizing and/or editing. Views are model by the <code><a href='View.html'>flux::View</a></code> class.</p>

<h2 id='viewLifecycle'>View Lifecycle </h2>

<p>The view lifecycle typically involves these steps:</p>

<ol style='list-style-type:decimal'>
<li><strong>Construction</strong>: when your view's constructor is called you don't have access to the parent frame or resource; so typically you won't do much in your constructor.</li>

<li><strong>onLoad</strong>: the <code>onLoad</code> callback is invoked when the view should load its UI state from the resource.  At this point both <code><a href='View.html#frame'>View.frame</a></code> and <code><a href='View.html#resource'>View.resource</a></code> are available.  However your view has not been mounted into the into the widget tree yet.</li>

<li><strong>dirty</strong>: if your view is an editor, then you should set the <code><a href='View.html#dirty'>dirty</a></code> field to true when the user makes a modification to the resource.</li>

<li><strong>onSave</strong>: the framework will determine when the user wishes to save your view.  This might happen from the Save or Save All commands, or might occur from a close prompt.  The view should save the UI state back to the actual resource - for example if editing a file, then the view will rewrite the file.  Once <code>onSave</code> completes, the dirty flag is set back to false.</li>

<li><strong>onUnload</strong>: this callback is invoked when the view is being unloaded, typically because navigating to a new resource or view.</li>
</ol>

<p>In addition to the above, views receive the <code>onActive</code> and <code>onInactive</code> callbacks when the view is selected and unselected as the active tab.  The <code>onActive</code> callback is used to enable predefined view managed commands such as find and replace.</p>

<h1 id='navigation'>Navigation </h1>

<p>When a user navigates to a Uri, the flux runtime performs the following process to resolve the resource and views:</p>

<h2 id='uriResolution'>Uri Resolution </h2>

<p>The step of navigation is to resolve the Uri to a normal Fantom <code>Obj</code> using the standard <a href='../docLang/Naming.html'>naming facilities</a>.  This means that any Uri which has been mapped via a <code>UriScheme</code> is available for navigation.</p>

<h2 id='resourceResolution'>Resource Resolution </h2>

<p>Uri resolution maps the Uri to a normal Fantom object. But we really want a <code>Resource</code> instance so that we know how to display the object in our UI. If the object from uri resolution is already an instance of Resource, then we don't need to do anything special.</p>

<p>If the object from uri resolution is not a Resource, then we search the indexed props for a Resource keyed by the <code>flux.resource.{qname}</code> prop for the object's type (and we search its base classes).  The <code>FileResource</code> class is automatically registered to handle <code>sys::File</code>.  For example to map an instance of <code>AppRec</code> to <code>AppResource</code>:</p>

<pre>class AppResource : Resource
{
  new (Uri uri, AppRecord rec) { this.uri = uri; this.rec = rec }
  override Uri uri
  override Str name() { ... }
  override Image icon() { ... }
  AppRecord rec
}

// build.fan
index = ["flux.resource.myPod::AppRec": "myPod::AppResource"]</pre>

<p>If you map a Resource subclass, then you need to ensure that your <code>make</code> constructor takes Uri as its first parameter, and the mapped object as its second parameter.</p>

<h2 id='viewResolution'>View Resolution </h2>

<p>Once we've resolved the uri to a resource instance, the next step is to discover which views are available to view and edit the resource. The list of available views is deferred to the <code><a href='Resource.html#views'>Resource.views</a></code> method.  The first view in the list should be default view.</p>

<p>The default strategy for resolving views by <code>Resource.views</code> is to query index props for any <code>View</code> keyed by the <code>flux.view.{resource}</code> using the resource's type.  For example to register <code>AppView</code> on <code>AppResource</code>:</p>

<pre>class AppView : View
{
  override Void onLoad() { ... }
}

// build.fan
index = ["flux.view.myPod::AppResource": "myPod::AppView"]</pre>

<p>If working with files, then you typically register a view <code><a href='FileResource.html#views'>by MIME type</a></code>. The follow indexed prop keys are used:</p>

<pre>// register on text/*
flux.view.mime.text

// register on text/xml
flux.view.mime.text/xml
internal class MyXmlView : View

// register on multiple MIME types
flux.view.mime.text/xml
flux.view.mime.text/html</pre>

<h2 id='viewQuery'>View Query </h2>

<p>The default view used to work with a resource is the first view in the list returned by <code>Resource.views</code>.  Alternate views are selected in the Uri's query map with a <code>view</code> key and qualified view typename as the value:</p>

<pre>file:/home/file.txt?view=fluxText::TextEditor</pre>

<p>Typically the flux chrome will handle displaying the list of available views and allowing the user to choose alternate views.</p>

<h1 id='sideBars'>SideBars </h1>

<p>A <code><a href='SideBar.html'>flux::SideBar</a></code> is a plugin which exists independent of resources and views.  Sidebars are widgets which may be opened along the left, bottom, or right edges of the view pane.  SideBars are registered with the <code>flux.sideBar</code> indexed prop.  A very simple sidebar:</p>

<pre>class ExampleSideBar : SideBar
{
  new make() { content = Label {"Example SideBar" } }
}

// build.fan
index = ["flux.sideBar": "myPod::ExampleSideBar"]</pre>

<p>There is one instance of a SideBar per registered type for each Frame. The SideBar is instantiated in memory the first time the user shows it within a given frame.  After that the instance is mounted and unmounted from the frame using <code><a href='SideBar.html#show'>show</a></code> and <code><a href='SideBar.html#hide'>hide</a></code>.</p>

<p>Typically the user manages the sidebars via the View menu.  The id for each sidebar command on the View menu is that SideBar's type name, and localization is based on the type's pod.  You can setup icons and accelerators using the normal conventions via localization.</p>

<p>SideBars receive a set of callbacks to manage their lifecycle and respond to view selections:</p>

<ul>
<li><strong>onLoad</strong>: called when loaded into memory; good place to load persistent state</li>

<li><strong>onUnload</strong>: called when unloaded from memory; good place to save persistent state</li>

<li><strong>onShow</strong>: called when shown on frame</li>

<li><strong>onHide</strong>: called when hidden on frame</li>

<li><strong>onActive</strong>: called when user links to new resource or selects new tab</li>

<li><strong>onInactive</strong>: called when current view is replaced with new view or tab</li>
</ul>
</div>
<div class='sidebar'>
<h2>Contents</h2>
<ul>
<li><a href='#overview'>Overview </a></li><li><a href='#resources'>Resources </a></li><li><a href='#views'>Views </a><ul>
<li><a href='#viewLifecycle'>View Lifecycle </a></li></ul>
</li><li><a href='#navigation'>Navigation </a><ul>
<li><a href='#uriResolution'>Uri Resolution </a></li><li><a href='#resourceResolution'>Resource Resolution </a></li><li><a href='#viewResolution'>View Resolution </a></li><li><a href='#viewQuery'>View Query </a></li></ul>
</li><li><a href='#sideBars'>SideBars </a></li></ul>
</div>
</div>
</div>
<div class='footer'>
<div>
<p>
flux 1.0.56
[11-Nov-2010 Thu 10:08:27AM EST]
</p>
</div>
</div>
</body>
</html>
