<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
 "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns='http://www.w3.org/1999/xhtml'>
<head>
  <title>fwt::EventListeners</title>
  <meta http-equiv='Content-Type' content='text/html; charset=UTF-8'/>
  <link rel='stylesheet' type='text/css' href='../doc.css'/>
  <script type='text/javascript' src='../doc.js'></script>
<!--[if lt IE 7]>
<script src='http://ie7-js.googlecode.com/svn/version/2.0(beta3)/IE7.js' type='text/javascript'></script>
<![endif]-->
</head>
<body onload='Login.check();'>
<div class='header'>
<div>
<h1><a href='/'>Fantom</a></h1>
<p id='sidewalkLogin_'>&nbsp;</p>
<form method='get' action='/sidewalk/search/'>
<p>
<input type='text' name='q' size='30' value='Search...' onfocus='if (value=="Search...") value=""' onblur='if (value=="") value="Search..."' />
</p>
</form>
<ul>
<li><a href='/'>Home</a></li>
<li class='active'><a href='../index.html'>Docs</a></li>
<li><a href='/sidewalk/blog/'>Blog</a></li>
<li><a href='/sidewalk/ticket/'>Tickets</a></li>
<li><a href='/sidewalk/topic/'>Discuss</a></li>
</ul></div>
</div>
<div class='subHeader'>
<div>
<ul>
  <li><a href='../index.html'>Doc Home</a></li>
  <li>&gt;</li>
  <li><a href='index.html'>fwt</a></li>
  <li>&gt;</li>
  <li><a href='EventListeners.html'>EventListeners</a></li>
</ul>
</div>
</div>
<div class='content'>
<div>
<div class='fandoc'>
<div class='type'>
<div class='overview'>
<h2>class</h2>
<h1>fwt::EventListeners</h1>
<pre><a href='../sys/Obj.html'>sys::Obj</a>
  fwt::EventListeners</pre>
</div>
</div>
<div class='src'>
<pre>
<span class='y'>//</span>
<span class='y'>// Copyright (c) 2008, Brian Frank and Andy Frank</span>
<span class='y'>// Licensed under the Academic Free License version 3.0</span>
<span class='y'>//</span>
<span class='y'>// History:</span>
<span class='y'>//   16 Jun 08  Brian Frank  Creation</span>
<span class='y'>//</span>

<span class='k'>using</span> gfx

<span class='z'>**</span>
<span class='z'>** Event models a user input event for callbacks.</span>
<span class='z'>**</span>
@Js
<span class='k'>class</span> Event
<span class='b'>{</span>

  <span class='z'>**</span>
  <span class='z'>** Type identifier of the event.  This field is always available.</span>
  <span class='z'>**</span>
  EventId id := EventId.unknown

  <span class='z'>**</span>
  <span class='z'>** Widget which generated the event.  This will be null for model events.</span>
  <span class='z'>**</span>
  Widget? widget

  <span class='z'>**</span>
  <span class='z'>** Convenience for 'widget?.window'.</span>
  <span class='z'>**</span>
  Window? window<span class='b'>()</span> <span class='b'>{</span> <span class='k'>return</span> widget?.window <span class='b'>}</span>

  <span class='z'>**</span>
  <span class='z'>** Index for list based events. For table events this</span>
  <span class='z'>** is the row index.</span>
  <span class='z'>**</span>
  Int? index

  <span class='z'>**</span>
  <span class='z'>** Used as the zero based text offset for text</span>
  <span class='z'>** and rich text widget events.</span>
  <span class='z'>**</span>
  Int? offset

  <span class='z'>**</span>
  <span class='z'>** Number of characters for text and rich text widget events.</span>
  <span class='z'>**</span>
  Int? size

  <span class='z'>**</span>
  <span class='z'>** Mouse button number pressed</span>
  <span class='z'>**</span>
  Int? button

  <span class='z'>**</span>
  <span class='z'>** Unicode character represented by a key event.</span>
  <span class='z'>**</span>
  Int? keyChar

  <span class='z'>**</span>
  <span class='z'>** Key code and modifiers.</span>
  <span class='z'>**</span>
  Key? key

  <span class='z'>**</span>
  <span class='z'>** Coordinate of event.  For mouse events this is the mouse</span>
  <span class='z'>** coordinate relative to the widget.</span>
  <span class='z'>**</span>
  Point? pos

  <span class='z'>**</span>
  <span class='z'>** Number of mouse clicks.</span>
  <span class='z'>**</span>
  Int? count

  <span class='z'>**</span>
  <span class='z'>** Event specific user data.</span>
  <span class='z'>**</span>
  Obj? data

  <span class='z'>**</span>
  <span class='z'>** If this a popup event, then this field should be set</span>
  <span class='z'>** to the menu item to open.  Setting this field to a nonnull</span>
  <span class='z'>** value implicitly consumes the event.</span>
  <span class='z'>**</span>
  Menu? popup <span class='b'>{</span> set <span class='b'>{</span> &amp;popup = it; <span class='k'>if</span> <span class='b'>(</span>it != <span class='k'>null</span><span class='b'>)</span> consume <span class='b'>}</span> <span class='b'>}</span>

  <span class='z'>**</span>
  <span class='z'>** Has this event been "consumed"?  Once an event</span>
  <span class='z'>** is consumed it ceases to propagate or be processed.</span>
  <span class='z'>** Also see `consume`.</span>
  <span class='z'>**</span>
  Bool consumed := <span class='k'>false</span>

  <span class='z'>**</span>
  <span class='z'>** Convenience for setting `consumed` to true.</span>
  <span class='z'>**</span>
  Void consume<span class='b'>()</span> <span class='b'>{</span> consumed = <span class='k'>true</span> <span class='b'>}</span>

  <span class='k'>override</span> Str toStr<span class='b'>()</span>
  <span class='b'>{</span>
    s := StrBuf<span class='b'>()</span>
    s.add<span class='b'>(</span><span class='s'>"Event { id="</span><span class='b'>)</span>.add<span class='b'>(</span>id<span class='b'>)</span>
    <span class='k'>if</span> <span class='b'>(</span>index != <span class='k'>null</span><span class='b'>)</span>   s.join<span class='b'>(</span><span class='s'>"index="</span><span class='b'>)</span>.add<span class='b'>(</span>index<span class='b'>)</span>
    <span class='k'>if</span> <span class='b'>(</span>offset != <span class='k'>null</span><span class='b'>)</span>  s.join<span class='b'>(</span><span class='s'>"offset="</span><span class='b'>)</span>.add<span class='b'>(</span>offset<span class='b'>)</span>
    <span class='k'>if</span> <span class='b'>(</span>size != <span class='k'>null</span><span class='b'>)</span>    s.join<span class='b'>(</span><span class='s'>"size="</span><span class='b'>)</span>.add<span class='b'>(</span>size<span class='b'>)</span>
    <span class='k'>if</span> <span class='b'>(</span>button != <span class='k'>null</span><span class='b'>)</span>  s.join<span class='b'>(</span><span class='s'>"button="</span><span class='b'>)</span>.add<span class='b'>(</span>button<span class='b'>)</span>
    <span class='k'>if</span> <span class='b'>(</span>keyChar != <span class='k'>null</span><span class='b'>)</span> s.join<span class='b'>(</span><span class='s'>"keyChar="</span><span class='b'>)</span>.add<span class='b'>(</span>keyChar.toChar.toCode<span class='b'>(</span><span class='s'>'\''</span>, <span class='k'>true</span><span class='b'>))</span>
    <span class='k'>if</span> <span class='b'>(</span>key != <span class='k'>null</span><span class='b'>)</span>     s.join<span class='b'>(</span><span class='s'>"key="</span><span class='b'>)</span>.add<span class='b'>(</span>key<span class='b'>)</span>
    <span class='k'>if</span> <span class='b'>(</span>pos != <span class='k'>null</span><span class='b'>)</span>     s.join<span class='b'>(</span><span class='s'>"pos="</span><span class='b'>)</span>.add<span class='b'>(</span>pos<span class='b'>)</span>
    <span class='k'>if</span> <span class='b'>(</span>count != <span class='k'>null</span><span class='b'>)</span>   s.join<span class='b'>(</span><span class='s'>"count="</span><span class='b'>)</span>.add<span class='b'>(</span>count<span class='b'>)</span>
    <span class='k'>if</span> <span class='b'>(</span>data != <span class='k'>null</span><span class='b'>)</span>    s.join<span class='b'>(</span><span class='s'>"data="</span><span class='b'>)</span>.add<span class='b'>(</span>data<span class='b'>)</span>
    <span class='k'>if</span> <span class='b'>(</span>consumed<span class='b'>)</span>        s.join<span class='b'>(</span><span class='s'>"consumed"</span><span class='b'>)</span>
    s.add<span class='b'>(</span><span class='s'>" }"</span><span class='b'>)</span>
    <span class='k'>return</span> s.toStr
  <span class='b'>}</span>
<span class='b'>}</span>

<span class='z'>**************************************************************************</span>
<span class='z'>** EventId</span>
<span class='z'>**************************************************************************</span>

<span class='z'>**</span>
<span class='z'>** EventId identifies the type of widget `Event`.</span>
<span class='z'>**</span>
@Js
<span class='k'>enum</span> <span class='k'>class</span> EventId
<span class='b'>{</span>
  unknown,
  focus,
  blur,
  keyDown,
  keyUp,
  mouseDown,
  mouseUp,
  mouseEnter,
  mouseExit,
  mouseHover,
  mouseMove,
  mouseWheel,
  action,
  modified,
  verify,
  verifyKey,
  select,
  caret,
  hyperlink,
  popup,
  open,
  close,
  active,
  inactive,
  iconified,
  deiconified
<span class='b'>}</span>

<span class='z'>**************************************************************************</span>
<span class='z'>** EventListeners</span>
<span class='z'>**************************************************************************</span>

<span class='z'>**</span>
<span class='z'>** EventListeners manages a list of event callback functions.</span>
<span class='z'>**</span>
@Js
<span class='k'>class</span> EventListeners
<span class='b'>{</span>
  <span class='z'>** Get the list of registered callback functions.</span>
  |Event|<span class='b'>[]</span> <span id='list'>list</span><span class='b'>()</span> <span class='b'>{</span> <span class='k'>return</span> listeners.ro <span class='b'>}</span>

  <span class='z'>** Return if `size` is zero.</span>
  Bool <span id='isEmpty'>isEmpty</span><span class='b'>()</span> <span class='b'>{</span> <span class='k'>return</span> listeners.isEmpty <span class='b'>}</span>

  <span class='z'>** Return number of registered callback functions.</span>
  Int <span id='size'>size</span><span class='b'>()</span> <span class='b'>{</span> <span class='k'>return</span> listeners.size <span class='b'>}</span>

  <span class='z'>** Add a listener callback function</span>
  Void <span id='add'>add</span><span class='b'>(</span>|Event| cb<span class='b'>)</span> <span class='b'>{</span> listeners.add<span class='b'>(</span>cb<span class='b'>)</span>; modified <span class='b'>}</span>

  <span class='z'>** Remove a listener callback function</span>
  Void <span id='remove'>remove</span><span class='b'>(</span>|Event| cb<span class='b'>)</span> <span class='b'>{</span> listeners.remove<span class='b'>(</span>cb<span class='b'>)</span>; modified <span class='b'>}</span>

  <span class='z'>** Fire the event to all the listeners</span>
  Void <span id='fire'>fire</span><span class='b'>(</span>Event? event<span class='b'>)</span>
  <span class='b'>{</span>
    listeners.each | |Event| cb |
    <span class='b'>{</span>
      <span class='k'>try</span>
      <span class='b'>{</span>
        <span class='k'>if</span> <span class='b'>(</span>event == <span class='k'>null</span> || !event.consumed<span class='b'>)</span>
          cb<span class='b'>(</span>event<span class='b'>)</span>
      <span class='b'>}</span>
      <span class='k'>catch</span> <span class='b'>(</span>Err e<span class='b'>)</span>
      <span class='b'>{</span>
        echo<span class='b'>(</span><span class='s'>"event: $event"</span><span class='b'>)</span>
        e.trace
      <span class='b'>}</span>
    <span class='b'>}</span>
  <span class='b'>}</span>

  <span class='z'>** Fire internal modified event</span>
  <span class='k'>internal</span> Void <span id='modified'>modified</span><span class='b'>()</span>
  <span class='b'>{</span>
    <span class='k'>try</span>
      onModify?.call<span class='b'>(</span><span class='k'>this</span><span class='b'>)</span>
    <span class='k'>catch</span> <span class='b'>(</span>Err e<span class='b'>)</span>
      e.trace
  <span class='b'>}</span>

  <span class='z'>** List of listeners</span>
  <span class='k'>private</span> |Event|<span class='b'>[]</span> <span id='listeners'>listeners</span> := |Event|<span class='b'>[</span>,<span class='b'>]</span>

  <span class='z'>** Callback when list of listeners is modified</span>
  <span class='k'>internal</span> |EventListeners|? <span id='onModify'>onModify</span>
<span class='b'>}</span></pre>
</div>
</div>
<div class='sidebar'>
<h2>More Info</h2>
<ul class='clean'>
  <li><a href='EventListeners.html'>View Fandoc</a></li>
</ul>
<div class='slots'>
<div class='overview'>
<h2>Slots</h2>
<ul class='clean'>
  <li style='display: block;'><a href='#add'>add</a></li>
  <li style='display: block;'><a href='#fire'>fire</a></li>
  <li style='display: block;'><a href='#isEmpty'>isEmpty</a></li>
  <li style='display: block;'><a href='#list'>list</a></li>
  <li class='hidden' style='display: block;'><a href='#listeners'>listeners</a></li>
  <li class='hidden' style='display: block;'><a href='#modified'>modified</a></li>
  <li class='hidden' style='display: block;'><a href='#onModify'>onModify</a></li>
  <li style='display: block;'><a href='#remove'>remove</a></li>
  <li style='display: block;'><a href='#size'>size</a></li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class='footer'>
<div>
<p>
fwt 1.0.56
[11-Nov-2010 Thu 10:08:25AM EST]
</p>
</div>
</div>
</body>
</html>
